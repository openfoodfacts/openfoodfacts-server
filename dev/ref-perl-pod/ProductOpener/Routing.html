<html><head><title>ProductOpener::Routing</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="simple.min" type="text/css" href="../simple.min.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.43,
  using Pod::Simple::PullParser v3.43,
  under Perl v5.038002 at Tue Mar 11 17:08:50 2025 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#load_routes()'>load_routes()</a>
    <li class='indexItem indexItem2'><a href='#analyze_request_(_%24request_ref_)'>analyze_request ( $request_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24request_ref_reference_to_a_hash_that_will_contain_analyzed_parameters'>$request_ref reference to a hash that will contain analyzed parameters</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Details'>Details</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#register_route(%24routes_to_register)'>register_route($routes_to_register)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24routes_to_register'>$routes_to_register</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#match_route(%24request_ref)'>match_route($request_ref)</a>
    <li class='indexItem indexItem2'><a href='#sub_extract_tagtype_and_tag_value_pairs_from_components(%24request_ref)'>sub extract_tagtype_and_tag_value_pairs_from_components($request_ref)</a>
    <li class='indexItem indexItem2'><a href='#is_no_index_page_(%24request_ref)'>is_no_index_page ($request_ref)</a>
    <li class='indexItem indexItem2'><a href='#set_rate_limit_attributes_(%24request_ref%2C_%24ip)'>set_rate_limit_attributes ($request_ref, $ip)</a>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>ProductOpener::Routing - determines which page to display or API to call based on the URL path</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="load_routes()"
>load_routes()</a></h2>

<p>Load OFF routes</p>

<p>a route is registered with: - Pattern: - a simple string (e.g.
&#34;api&#34;) without &#39;/&#39;&#39;: when you simply want to route with the first component of the path e.g.
product/1234 -&#62; product_route No regex is involved.
It uses a hash key</p>

<pre>                - Or a pattern that capture arguments (e.g. &#34;org/[orgid]&#34;):
                        - The value of the orgid param will be stored in $request_ref-&#62;{param}{orgid}
                        - Ending the pattern with a / means that it can be followed by anything
                        ! Mind the priority of the routes, the first one that matches will be used
                
        - Handler (sub)
        - (optional) Options : {
                - name

                - regex: 1 if the pattern is a true regex, 0 by default. 
                  When you don&#39;t want to use the default limited one.
                  Use named captures to store the arguments in $request_ref-&#62;{param}

                - onlyif: a sub($request_ref) that will be called to check if the route should be used
                        Its a dynamic routing, using context of the request.
                        Results is used as a boolean to decide if the route should be used.
                }</pre>

<p>non regex routes will be matched first, then regex routes</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="analyze_request_(_$request_ref_)"
>analyze_request ( $request_ref )</a></h2>

<p>Analyze request parameters and decide which method to call.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$request_ref_reference_to_a_hash_that_will_contain_analyzed_parameters"
>$request_ref reference to a hash that will contain analyzed parameters</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Details"
>Details</a></h3>

<p>It will analyze path and parameters.</p>

<p>Some information is set in request_ref, notably - polished query_string - page number (page) - api version (e.g v3), api action (e.g product) and api method (e.g. GET or POST) - requested page (text) - some boolean for routing : search / taxonomy / mission / product / tag / points - parameters for products, mission, tags, etc.</p>

<p>It handles redirect for renamed texts or products, .well-known/change-password</p>

<p>Sometimes we modify request parameters (param) to correspond to request_ref: - parameters for response format : json, jsonp, xml, ... - code parameter</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="register_route($routes_to_register)"
>register_route($routes_to_register)</a></h2>

<p>Register routes in the routes hash and regex_routes array.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$routes_to_register"
>$routes_to_register</a></h4>

<p>Array of arrays.</p>

<p>Each array should contain 3 elements: - the pattern - the route handler (sub) - (optional) options { - route_name - regex: if present then the pattern is considered as a true regex pattern and the default and limited one won&#39;t be used }</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="match_route($request_ref)"
>match_route($request_ref)</a></h2>

<p>Match a route based on the components of the request. non regex routes are matched first, then regex routes</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="sub_extract_tagtype_and_tag_value_pairs_from_components($request_ref)"
>sub extract_tagtype_and_tag_value_pairs_from_components($request_ref)</a></h2>

<p>Extract tag type / tag value pairs and store them in an array $request_ref-&#62;{tags}</p>

<p>e.g. /categories/breakfast-cereals/labels/organic/brands/monoprix</p>

<p>Tags can be prefixed by a - to indicate that we want products without this tag</p>

<p>Tags that where not recognized are left in $request_ref-&#62;{components}</p>

<p>Note that we also handle singular tags types like &#34;brand&#34; or &#34;category&#34;, but mark them as obsolete (needs a redirect)</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="is_no_index_page_($request_ref)"
>is_no_index_page ($request_ref)</a></h2>

<p>Return 1 if the page should not be indexed by web crawlers based on analyzed request, 0 otherwise.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="set_rate_limit_attributes_($request_ref,_$ip)"
>set_rate_limit_attributes ($request_ref, $ip)</a></h2>

<p>Set attributes related to rate-limiting in the request object:</p>

<p>- rate_limiter_user_requests: the number of requests performed by the user for the current minute - rate_limiter_limit: the maximum number of requests allowed for the current minute - rate_limiter_blocking: 1 if the user has reached the rate-limit, 0 otherwise</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
