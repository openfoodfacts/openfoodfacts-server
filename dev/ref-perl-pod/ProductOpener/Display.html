<html><head><title>ProductOpener::Display</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="simple.min" type="text/css" href="../simple.min.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.43,
  using Pod::Simple::PullParser v3.43,
  under Perl v5.038002 at Wed Sep  3 12:48:57 2025 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#VARIABLES'>VARIABLES</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#%25file_timestamps'>%file_timestamps</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Synopsis'>Synopsis</a>
      <li class='indexItem indexItem3'><a href='#Configuration'>Configuration</a>
    </ul>
  </ul>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#process_template_(_%24template_filename_%2C_%24template_data_ref_%2C_%24result_content_ref%2C_%24request_ref_%3D_%7B%7D_)'>process_template ( $template_filename , $template_data_ref , $result_content_ref, $request_ref = {} )</a>
    <li class='indexItem indexItem2'><a href='#init_request_()'>init_request ()</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#(optional)_Request_object_reference_%24request_ref'>(optional) Request object reference $request_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#set_user_agent_request_ref_attributes_(%24request_ref)'>set_user_agent_request_ref_attributes ($request_ref)</a>
    <li class='indexItem indexItem2'><a href='#display_error_(_%24request_ref%2C_%24error_message%2C_%24status_code_)'>display_error ( $request_ref, $error_message, $status_code )</a>
    <li class='indexItem indexItem2'><a href='#display_error_and_exit_(_%24request_ref%2C_%24error_message%2C_%24status_code_)'>display_error_and_exit ( $request_ref, $error_message, $status_code )</a>
    <li class='indexItem indexItem2'><a href='#display_no_index_page_and_exit_()'>display_no_index_page_and_exit ()</a>
    <li class='indexItem indexItem2'><a href='#display_too_many_requests_page_and_exit_()'>display_too_many_requests_page_and_exit ()</a>
    <li class='indexItem indexItem2'><a href='#display_robots_txt_and_exit_(%24request_ref)'>display_robots_txt_and_exit ($request_ref)</a>
    <li class='indexItem indexItem2'><a href='#canonicalize_request_tags_and_redirect_to_canonical_url_(%24request_ref)'>canonicalize_request_tags_and_redirect_to_canonical_url ($request_ref)</a>
    <li class='indexItem indexItem2'><a href='#generate_title_from_request_tags_(%24tags_ref)'>generate_title_from_request_tags ($tags_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24tags_ref_Array_of_tag_filter_objects'>$tags_ref Array of tag filter objects</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#generate_description_from_display_tag_options_(%24tagtype%2C_%24tagid%2C_%24display_tag%2C_%24canon_tagid%2C_%24request_ref)'>generate_description_from_display_tag_options ($tagtype, $tagid, $display_tag, $canon_tagid, $request_ref)</a>
    <li class='indexItem indexItem2'><a href='#display_tag_(%24request_ref)'>display_tag ($request_ref)</a>
    <li class='indexItem indexItem2'><a href='#get_all_request_params_(_%24request_ref_)'>get_all_request_params ( $request_ref )</a>
    <li class='indexItem indexItem2'><a href='#display_search_results_(_%24request_ref_)'>display_search_results ( $request_ref )</a>
    <li class='indexItem indexItem2'><a href='#get_products_collection_request_parameters_(%24request_ref%2C_%24additional_parameters_ref_%3D_%7B%7D_)'>get_products_collection_request_parameters ($request_ref, $additional_parameters_ref = {} )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24request_ref_request_object'>$request_ref request object</a>
        <li class='indexItem indexItem4'><a href='#%24additional_parameters_ref'>$additional_parameters_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#add_params_and_filters_to_query_(_%24request_ref%2C_%24query_ref_)'>add_params_and_filters_to_query ( $request_ref, $query_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24request_ref_(input)'>$request_ref (input)</a>
        <li class='indexItem indexItem4'><a href='#%24query_ref_(output)'>$query_ref (output)</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#add_params_to_query_(_%24params_ref%2C_%24query_ref_)'>add_params_to_query ( $params_ref, $query_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24params_ref_(input)'>$params_ref (input)</a>
        <li class='indexItem indexItem4'><a href='#%24query_ref_(output)'>$query_ref (output)</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#search_and_display_products_(%24request_ref%2C_%24query_ref%2C_%24sort_by%2C_%24limit%2C_%24page)'>search_and_display_products ($request_ref, $query_ref, $sort_by, $limit, $page)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24request_ref'>$request_ref</a>
        <li class='indexItem indexItem4'><a href='#%24query_ref'>$query_ref</a>
        <li class='indexItem indexItem4'><a href='#%24sort_by'>$sort_by</a>
        <li class='indexItem indexItem4'><a href='#%24limit'>$limit</a>
        <li class='indexItem indexItem4'><a href='#%24page'>$page</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_pagination(_%24request_ref_%2C_%24count_%2C_%24limit_%2C_%24page_)'>display_pagination( $request_ref , $count , $limit , $page )</a>
    <li class='indexItem indexItem2'><a href='#display_scatter_plot_(%24graph_ref%2C_%24products_ref)'>display_scatter_plot ($graph_ref, $products_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24graph_ref'>$graph_ref</a>
        <li class='indexItem indexItem4'><a href='#%24products_ref'>$products_ref</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_histogram_(%24graph_ref%2C_%24products_ref%2C_%24request_ref)'>display_histogram ($graph_ref, $products_ref, $request_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24graph_ref'>$graph_ref</a>
        <li class='indexItem indexItem4'><a href='#%24products_ref'>$products_ref</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#get_packager_code_coordinates_(%24emb_code)'>get_packager_code_coordinates ($emb_code)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#parameters'>parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24emb_code_-_string'>$emb_code - string</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#returns_-_list_of_2_elements'>returns - list of 2 elements</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#map_of_products(%24products_iter%2C_%24request_ref%2C_%24graph_ref)'>map_of_products($products_iter, $request_ref, $graph_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#parameters'>parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24products_iter_-_iterator'>$products_iter - iterator</a>
        <li class='indexItem indexItem4'><a href='#%24request_ref_-_hashmap_ref'>$request_ref - hashmap ref</a>
        <li class='indexItem indexItem4'><a href='#%24graph_ref_-_hashmap_ref'>$graph_ref - hashmap ref</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#search_products_for_map(%24request_ref%2C_%24query_ref)'>search_products_for_map($request_ref, $query_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#parameters'>parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24request_ref_-_hashmap'>$request_ref - hashmap</a>
        <li class='indexItem indexItem4'><a href='#%24query_ref_-_hashmap'>$query_ref - hashmap</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#returns_-_MongoDB%3A%3ACursor_instance'>returns - MongoDB::Cursor instance</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#search_and_map_products_(%24request_ref%2C_%24query_ref%2C_%24graph_ref)'>search_and_map_products ($request_ref, $query_ref, $graph_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#parameters'>parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24request_ref_-_hashmap_ref'>$request_ref - hashmap ref</a>
        <li class='indexItem indexItem4'><a href='#%24query_ref_-_hashmap_ref'>$query_ref - hashmap ref</a>
        <li class='indexItem indexItem4'><a href='#%24graph_ref'>$graph_ref</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#search_permalink(%24request_ref)'>search_permalink($request_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#return_-_string_-_generated_HTML'>return - string - generated HTML</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_possible_improvement_description(_PRODUCT_REF%2C_TAGID_)'>display_possible_improvement_description( PRODUCT_REF, TAGID )</a>
    <li class='indexItem indexItem2'><a href='#display_nutriscore_calculation_details_2021_(_%24product_ref_)'>display_nutriscore_calculation_details_2021 ( $product_ref )</a>
    <li class='indexItem indexItem2'><a href='#data_to_display_nutrient_levels_(_%24product_ref_)'>data_to_display_nutrient_levels ( $product_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Product_reference_%24product_ref'>Product reference $product_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#data_to_display_nutriscore_(%24nutriscore_data_ref%2C_%24version_%3D_%222021%22_)'>data_to_display_nutriscore ($nutriscore_data_ref, $version = &#34;2021&#34; )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Product_reference_%24product_ref'>Product reference $product_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#compare_product_nutrition_facts_to_categories_(%24product_ref%2C_%24target_cc%2C_%24max_number_of_categories)'>compare_product_nutrition_facts_to_categories ($product_ref, $target_cc, $max_number_of_categories)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Product_reference_%24product_ref'>Product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#Target_country_code_%24target_cc'>Target country code $target_cc</a>
        <li class='indexItem indexItem4'><a href='#Max_number_of_categories_%24max_number_of_categories'>Max number of categories $max_number_of_categories</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#data_to_display_nutrition_table_(_%24product_ref%2C_%24comparisons_ref_)'>data_to_display_nutrition_table ( $product_ref, $comparisons_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Product_reference_%24product_ref'>Product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#Comparisons_reference_%24product_ref'>Comparisons reference $product_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_nutrition_table_(_%24product_ref%2C_%24comparisons_ref_)'>display_nutrition_table ( $product_ref, $comparisons_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Product_reference_%24product_ref'>Product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#Comparisons_reference_%24product_ref'>Comparisons reference $product_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_preferences_api_(_%24target_lc_)'>display_preferences_api ( $target_lc )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#request_object_reference_%24request_ref'>request object reference $request_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_attribute_groups_api_(_%24request_ref%2C_%24target_lc_)'>display_attribute_groups_api ( $request_ref, $target_lc )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#request_object_reference_%24request_ref'>request object reference $request_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_taxonomy_api_(_%24request_ref_)'>display_taxonomy_api ( $request_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#request_object_reference_%24request_ref'>request object reference $request_ref</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_product_api_(_%24request_ref_)'>display_product_api ( $request_ref )</a>
    <li class='indexItem indexItem2'><a href='#display_icon_(_%24icon_)'>display_icon ( $icon )</a>
    <li class='indexItem indexItem2'><a href='#display_nested_list_of_ingredients_(_%24ingredients_ref%2C_%24ingredients_text_ref%2C_%24ingredients_list_ref_)'>display_nested_list_of_ingredients ( $ingredients_ref, $ingredients_text_ref, $ingredients_list_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24ingredients_ref_(input)'>$ingredients_ref (input)</a>
        <li class='indexItem indexItem4'><a href='#%24ingredients_text_ref_(output)'>$ingredients_text_ref (output)</a>
        <li class='indexItem indexItem4'><a href='#%24ingredients_list_ref_(output)'>$ingredients_list_ref (output)</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_list_of_specific_ingredients_(_%24product_ref_)'>display_list_of_specific_ingredients ( $product_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24product_ref'>$product_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#data_to_display_ingredients_analysis_details_(_%24product_ref_)'>data_to_display_ingredients_analysis_details ( $product_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Product_reference_%24product_ref'>Product reference $product_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_ingredients_analysis_details_(_%24product_ref_)'>display_ingredients_analysis_details ( $product_ref )</a>
    <li class='indexItem indexItem2'><a href='#data_to_display_ingredients_analysis_(_%24product_ref_)'>data_to_display_ingredients_analysis ( $product_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Product_reference_%24product_ref'>Product reference $product_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_ingredients_analysis_(_%24product_ref_)'>display_ingredients_analysis ( $product_ref )</a>
    <li class='indexItem indexItem2'><a href='#display_environmental_score_calculation_details(_%24environmental_score_cc%2C_%24environmental_score_data_ref_)'>display_environmental_score_calculation_details( $environmental_score_cc, $environmental_score_data_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#country_code_%24environmental_score_cc'>country code $environmental_score_cc</a>
        <li class='indexItem indexItem4'><a href='#environmental_score_data_%24environmental_score_data_ref'>environmental_score data $environmental_score_data_ref</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_environmental_score_calculation_details_simple_html(_%24environmental_score_cc%2C_%24environmental_score_data_ref_)'>display_environmental_score_calculation_details_simple_html( $environmental_score_cc, $environmental_score_data_ref )</a>
    <li class='indexItem indexItem2'><a href='#search_and_analyze_recipes_(%24request_ref%2C_%24query_ref)'>search_and_analyze_recipes ($request_ref, $query_ref)</a>
    <li class='indexItem indexItem2'><a href='#display_properties_(%24request_ref)'>display_properties ($request_ref)</a>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>ProductOpener::Display - list,
create and save products</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p><code>ProductOpener::Display</code> generates the HTML code for the web site and the JSON responses for the API.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="VARIABLES"
>VARIABLES</a></h1>

<p>Exported variables that are available for other modules.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="%file_timestamps"
>%file_timestamps</a></h2>

<p>When the module is loaded (at the start of Apache with mod_perl),
we record the modification date of static files like CSS styles an JS code so that we can add a version parameter to the request in order to make sure the browser will not serve an old cached version.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Synopsis"
>Synopsis</a></h3>

<pre>    $$request_ref-&#62;{scripts} .= &#60;&#60;HTML
        &#60;script type=&#34;text/javascript&#34; src=&#34;/js/dist/product-multilingual.js?v=$file_timestamps{&#34;js/dist/product-multilingual.js&#34;}&#34;&#62;&#60;/script&#62;
    HTML
    ;</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Configuration"
>Configuration</a></h3>

<p>The files that need to be checked need to be specified in the code of Display.pm.</p>

<pre>        e.g.

    %file_timestamps = (
        &#34;css/dist/app.css&#34; =&#62; &#34;CSS file generated by the &#39;npm run build&#39; command&#34;,
        &#34;css/dist/product-multilingual.css&#34; =&#62; &#34;CSS file generated by the &#39;npm run build&#39; command&#34;,
        &#34;js/dist/product-multilingual.js&#34; =&#62; &#34;JS file generated by the &#39;npm run build&#39; command&#34;,
    );</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="process_template_(_$template_filename_,_$template_data_ref_,_$result_content_ref,_$request_ref_=_{}_)"
>process_template ( $template_filename , $template_data_ref , $result_content_ref, $request_ref = {} )</a></h2>

<p>Add some functions and variables needed by many templates and process the template with template toolkit.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="init_request_()"
>init_request ()</a></h2>

<p><code>init_request()</code> is called at the start of each new request (web page or API). It initializes a number of variables, in particular:</p>

<p>$cc : country code</p>

<p>$lc : language code</p>

<p>$knowledge_panels_options_ref: Reference to a hashmap that collect options to display knowledge panels for current request See also <a href="../ProductOpener/KnowledgePanels.html#knowledge_panels_options_ref" class="podlinkpod"
>&#34;knowledge_panels_options_ref&#34; in ProductOpener::KnowledgePanels</a> It also initializes a request object that is returned.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="(optional)_Request_object_reference_$request_ref"
>(optional) Request object reference $request_ref</a></h4>

<p>This function may be passed an existing request object reference (e.g. pre-containing some fields of the request, like a JSON body).</p>

<p>If not passed, a new request object will be created.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>Reference to request object.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="set_user_agent_request_ref_attributes_($request_ref)"
>set_user_agent_request_ref_attributes ($request_ref)</a></h2>

<p>Set two attributes to `request_ref`:</p>

<p>- `user_agent`: the request User-Agent - `is_crawl_bot`: a flag (0 or 1) that indicates whether the request comes from a known web crawler (Google, Bing,...). We only use User-Agent value to set this flag. - `is_denied_crawl_bot`: a flag (0 or 1) that indicates whether the request comes from a web crawler we want to deny access to.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_error_(_$request_ref,_$error_message,_$status_code_)"
>display_error ( $request_ref, $error_message, $status_code )</a></h2>

<p>Display an error message using the site template.</p>

<p>The request is not terminated by this function, it will continue to run.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_error_and_exit_(_$request_ref,_$error_message,_$status_code_)"
>display_error_and_exit ( $request_ref, $error_message, $status_code )</a></h2>

<p>Display an error message using the site template, and terminate the request immediately.</p>

<p>Any code after the call to display_error_and_exit() will not be executed.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_no_index_page_and_exit_()"
>display_no_index_page_and_exit ()</a></h2>

<p>Return an empty HTML page with a &#39;&#60;meta name=&#34;robots&#34; content=&#34;noindex&#34;&#62;&#39; directive in the HTML header.</p>

<p>This is useful to prevent web crawlers to overload our servers by querying webpages that require a lot of resources (especially aggregation queries).</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_too_many_requests_page_and_exit_()"
>display_too_many_requests_page_and_exit ()</a></h2>

<p>Return a page with a 429 status code and a message explaining that the user is sending too many requests.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_robots_txt_and_exit_($request_ref)"
>display_robots_txt_and_exit ($request_ref)</a></h2>

<p>Return robots.txt page and exit.</p>

<p>robots.txt is dynamically generated based on lc, it&#39;s content depends on $request_ref: - if $request_ref-&#62;{deny_all_robots_txt} is 1: a robots.txt where we deny all traffic combinations. - otherwise: the standard robots.txt. We disallow indexing of most facet pages, the exceptions can be found in ProductOpener::Config::index_tag_types</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="canonicalize_request_tags_and_redirect_to_canonical_url_($request_ref)"
>canonicalize_request_tags_and_redirect_to_canonical_url ($request_ref)</a></h2>

<p>This function goes through the tags filters from the request and canonicalizes them. If the requested tags are not canonical, we will redirect to the canonical URL.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="generate_title_from_request_tags_($tags_ref)"
>generate_title_from_request_tags ($tags_ref)</a></h2>

<p>Generate a title from the tags in the request.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$tags_ref_Array_of_tag_filter_objects"
>$tags_ref Array of tag filter objects</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>Title string.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="generate_description_from_display_tag_options_($tagtype,_$tagid,_$display_tag,_$canon_tagid,_$request_ref)"
>generate_description_from_display_tag_options ($tagtype, $tagid, $display_tag, $canon_tagid, $request_ref)</a></h2>

<p>Generate a description for some tag types, like additives, if there is a template set in the Config.pm file.</p>

<p>This feature was coded before the introduction of knowledge panels. It is in maintenance mode, and should be reimplemented as facets knowledge panels (server side, or with client side facets knowledge panels)</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_tag_($request_ref)"
>display_tag ($request_ref)</a></h2>

<p>This function is called to display either:</p>

<p>1. Products that have a specific tag: /category/cakes or that don&#39;t have a specific tag /category/-cakes or that have 2 specific tags /category/cake/brand/oreo 2. List of tags of a given type: /labels possibly for products that have a specific tag: /category/cakes/labels or more specific tags: /category/cakes/label/organic/additives</p>

<p>When displaying products for a tag, the function generates tag type specific HTML that is displayed at the top of the page: - tag parents and children - maps for tag types that have a location (e.g. packaging codes) - special properties for some tag types (e.g. additives)</p>

<p>The function then calls search_and_display_products() to display the paginated list of products.</p>

<p>When displaying a list of tags, the function calls display_list_of_tags().</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_all_request_params_(_$request_ref_)"
>get_all_request_params ( $request_ref )</a></h2>

<p>Return a reference to a hash of all request parameters (CGI params and JSON body) name and values.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_search_results_(_$request_ref_)"
>display_search_results ( $request_ref )</a></h2>

<p>This function builds the HTML returned by the /search endpoint.</p>

<p>The results can be displayed in different ways:</p>

<p>1. a paginated list of products (default) The function calls search_and_display_products() to display the paginated list of products.</p>

<p>2. results filtered and ranked on the client-side 2.1. according to user preferences that are locally saved on the client: &#38;user_preferences=1 2.2. according to preferences passed in the url: &#38;preferences=..</p>

<p>3. on a graph (histogram or scatter plot): &#38;graph=1 -- TODO: not supported yet</p>

<p>4. on a map &#38;map=1 -- TODO: not supported yet</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_products_collection_request_parameters_($request_ref,_$additional_parameters_ref_=_{}_)"
>get_products_collection_request_parameters ($request_ref, $additional_parameters_ref = {} )</a></h2>

<p>This function looks at the request object to set parameters to pass to the get_products_collection() function.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$request_ref_request_object"
>$request_ref request object</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$additional_parameters_ref"
>$additional_parameters_ref</a></h4>

<p>An optional reference to a hash of parameters that should be added to the parameters extracted from the request object.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>A reference to a parameters object that can be passed to get_products_collection()</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="add_params_and_filters_to_query_(_$request_ref,_$query_ref_)"
>add_params_and_filters_to_query ( $request_ref, $query_ref )</a></h2>

<p>This function is used to parse search query parameters that are passed to the API (/api/v?/search endpoint) or to the web site search (/search endpoint) either as query string parameters (e.g. ?labels_tags=en:organic), POST parameters, or POST JSON body parameters.</p>

<p>The function then adds the corresponding query filters in the MongoDB query.</p>

<p>It also adds the country and owner filters to the query.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$request_ref_(input)"
>$request_ref (input)</a></h4>

<p>Reference to the request object.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$query_ref_(output)"
>$query_ref (output)</a></h4>

<p>Reference to the MongoDB query object.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="add_params_to_query_(_$params_ref,_$query_ref_)"
>add_params_to_query ( $params_ref, $query_ref )</a></h2>

<p>This function is used to parse search query parameters that are passed to the API (/api/v?/search endpoint) or to the web site search (/search endpoint) either as query string parameters (e.g. ?labels_tags=en:organic), POST parameters, or POST JSON body parameters.</p>

<p>The function then adds the corresponding query filters in the MongoDB query.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$params_ref_(input)"
>$params_ref (input)</a></h4>

<p>Reference to a hash of parameters (name and value).</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$query_ref_(output)"
>$query_ref (output)</a></h4>

<p>Reference to the MongoDB query object.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="search_and_display_products_($request_ref,_$query_ref,_$sort_by,_$limit,_$page)"
>search_and_display_products ($request_ref, $query_ref, $sort_by, $limit, $page)</a></h2>

<p>Search products and return an HTML snippet that should be included in the webpage.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$request_ref"
>$request_ref</a></h4>

<p>Reference to the internal request object.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$query_ref"
>$query_ref</a></h4>

<p>Reference to the MongoDB query object.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$sort_by"
>$sort_by</a></h4>

<p>A string indicating how to sort results (created_t, popularity,...), or a sorting subroutine.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$limit"
>$limit</a></h4>

<p>Limit of the number of products to return.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$page"
>$page</a></h4>

<p>Requested page (first page starts at 1).</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_pagination(_$request_ref_,_$count_,_$limit_,_$page_)"
>display_pagination( $request_ref , $count , $limit , $page )</a></h2>

<p>This function is used for page navigation and gets called when there is more than one page of products. The URL can be different, either page=&#60;number&#62; , or /&#60;number&#62; . page=&#60;number&#62; is used for search queries. /&#60;number&#62; is used for facets.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_scatter_plot_($graph_ref,_$products_ref)"
>display_scatter_plot ($graph_ref, $products_ref)</a></h2>

<p>Called by search_and_graph_products() to display a scatter plot of products on 2 axis</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$graph_ref"
>$graph_ref</a></h4>

<p>Options for the graph, set by /cgi/search.pl</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$products_ref"
>$products_ref</a></h4>

<p>List of search results from search_and_graph_products()</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_histogram_($graph_ref,_$products_ref,_$request_ref)"
>display_histogram ($graph_ref, $products_ref, $request_ref)</a></h2>

<p>Called by search_and_graph_products() to display an histogram of products on 1 axis</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$graph_ref"
>$graph_ref</a></h4>

<p>Options for the graph, set by /cgi/search.pl</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$products_ref"
>$products_ref</a></h4>

<p>List of search results from search_and_graph_products()</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_packager_code_coordinates_($emb_code)"
>get_packager_code_coordinates ($emb_code)</a></h2>

<p>Transform a traceability code (emb code) into a latitude / longitude pair.</p>

<p>We try using packagers_codes taxonomy, or fsa_rating or geocode for uk, or city.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="parameters"
>parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$emb_code_-_string"
>$emb_code - string</a></h4>

<p>The traceability code</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="returns_-_list_of_2_elements"
>returns - list of 2 elements</a></h3>

<p>(latitude, longitude) if found, or (undef, undef) otherwise</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="map_of_products($products_iter,_$request_ref,_$graph_ref)"
>map_of_products($products_iter, $request_ref, $graph_ref)</a></h2>

<p>Build the HTML to display a map of products</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="parameters"
>parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$products_iter_-_iterator"
>$products_iter - iterator</a></h4>

<p>Must return a reference to a function that on each call return a product, or undef to end iteration</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$request_ref_-_hashmap_ref"
>$request_ref - hashmap ref</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$graph_ref_-_hashmap_ref"
>$graph_ref - hashmap ref</a></h4>

<p>Specifications for the graph</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="search_products_for_map($request_ref,_$query_ref)"
>search_products_for_map($request_ref, $query_ref)</a></h2>

<p>Build the MongoDB query corresponding to a search to display a map</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="parameters"
>parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$request_ref_-_hashmap"
>$request_ref - hashmap</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$query_ref_-_hashmap"
>$query_ref - hashmap</a></h4>

<p>Base query that will be modified to be able to build the map</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="returns_-_MongoDB::Cursor_instance"
>returns - MongoDB::Cursor instance</a></h3>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="search_and_map_products_($request_ref,_$query_ref,_$graph_ref)"
>search_and_map_products ($request_ref, $query_ref, $graph_ref)</a></h2>

<p>Trigger a search and build a map</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="parameters"
>parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$request_ref_-_hashmap_ref"
>$request_ref - hashmap ref</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$query_ref_-_hashmap_ref"
>$query_ref - hashmap ref</a></h4>

<p>Base query for this search</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$graph_ref"
>$graph_ref</a></h4>

<p>Specification of the graph</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="search_permalink($request_ref)"
>search_permalink($request_ref)</a></h2>

<p>add a permalink to a search result page</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="return_-_string_-_generated_HTML"
>return - string - generated HTML</a></h3>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_possible_improvement_description(_PRODUCT_REF,_TAGID_)"
>display_possible_improvement_description( PRODUCT_REF, TAGID )</a></h2>

<p>Display an explanation of the possible improvement, using the improvement data stored in $product_ref-&#62;{improvements_data}</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_nutriscore_calculation_details_2021_(_$product_ref_)"
>display_nutriscore_calculation_details_2021 ( $product_ref )</a></h2>

<p>Warning: This function only works with Nutri-Score 2021.</p>

<p>Generates HTML code with information on how the Nutri-Score was computed for a particular product.</p>

<p>For each component of the Nutri-Score (energy, sugars etc.) it shows the input value, the rounded value according to the Nutri-Score rules, and the corresponding points.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="data_to_display_nutrient_levels_(_$product_ref_)"
>data_to_display_nutrient_levels ( $product_ref )</a></h2>

<p>Generates a data structure to display the nutrient levels (food traffic lights).</p>

<p>The resulting data structure can be passed to a template to generate HTML or the JSON data for a knowledge panel.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Product_reference_$product_ref"
>Product reference $product_ref</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Reference to a data structure with needed data to display.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="data_to_display_nutriscore_($nutriscore_data_ref,_$version_=_&#34;2021&#34;_)"
>data_to_display_nutriscore ($nutriscore_data_ref, $version = &#34;2021&#34; )</a></h2>

<p>Generates a data structure to display the Nutri-Score.</p>

<p>The resulting data structure can be passed to a template to generate HTML or the JSON data for a knowledge panel.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Product_reference_$product_ref"
>Product reference $product_ref</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Reference to a data structure with needed data to display.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compare_product_nutrition_facts_to_categories_($product_ref,_$target_cc,_$max_number_of_categories)"
>compare_product_nutrition_facts_to_categories ($product_ref, $target_cc, $max_number_of_categories)</a></h2>

<p>Compares a product nutrition facts to average nutrition facts of each of its categories.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Product_reference_$product_ref"
>Product reference $product_ref</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Target_country_code_$target_cc"
>Target country code $target_cc</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Max_number_of_categories_$max_number_of_categories"
>Max number of categories $max_number_of_categories</a></h4>

<p>If defined, we will limit the number of categories returned, and keep the most specific categories.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Reference to a comparisons data structure that can be passed to the data_to_display_nutrition_table() function.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="data_to_display_nutrition_table_(_$product_ref,_$comparisons_ref_)"
>data_to_display_nutrition_table ( $product_ref, $comparisons_ref )</a></h2>

<p>Generates a data structure to display a nutrition table.</p>

<p>The nutrition table can be the nutrition table of a product, or of a category (stats for the categories).</p>

<p>In the case of a product, extra columns can be added to compare the product nutrition facts to the average for its categories.</p>

<p>The resulting data structure can be passed to a template to generate HTML or the JSON data for a knowledge panel.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Product_reference_$product_ref"
>Product reference $product_ref</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Comparisons_reference_$product_ref"
>Comparisons reference $product_ref</a></h4>

<p>Reference to an array with nutrition facts for 1 or more categories.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Reference to a data structure with needed data to display.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_nutrition_table_(_$product_ref,_$comparisons_ref_)"
>display_nutrition_table ( $product_ref, $comparisons_ref )</a></h2>

<p>Generates HTML to display a nutrition table.</p>

<p>Use data produced by data_to_display_nutrition_table</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Product_reference_$product_ref"
>Product reference $product_ref</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Comparisons_reference_$product_ref"
>Comparisons reference $product_ref</a></h4>

<p>Reference to an array with nutrition facts for 1 or more categories.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>HTML for the nutrition table.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_preferences_api_(_$target_lc_)"
>display_preferences_api ( $target_lc )</a></h2>

<p>Return a JSON structure with all available preference values for attributes.</p>

<p>This is used by clients that ask for user preferences to personalize filtering and ranking based on product attributes.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="request_object_reference_$request_ref"
>request object reference $request_ref</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Sets the desired language for the user facing strings.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_attribute_groups_api_(_$request_ref,_$target_lc_)"
>display_attribute_groups_api ( $request_ref, $target_lc )</a></h2>

<p>Return a JSON structure with all available attribute groups and attributes, with strings (names, descriptions etc.) in a specific language, and return them in an array of attribute groups.</p>

<p>This is used in particular for clients of the API to know which preferences they can ask users for, and then use for personalized filtering and ranking.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="request_object_reference_$request_ref"
>request object reference $request_ref</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users. This parameter sets the desired language for the user facing strings.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_taxonomy_api_(_$request_ref_)"
>display_taxonomy_api ( $request_ref )</a></h2>

<p>Generate an extract of a taxonomy for specific tags, fields and languages, and return it as a JSON object.</p>

<p>Accessed through the /api/v2/taxonomy API</p>

<p>e.g. https://world.openfoodfacts.org/api/v2/taxonomy?type=labels&#38;tags=en:organic,en:fair-trade&#38;fields=name,description,children&#38;include_children=1&#38;lc=en,fr</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="request_object_reference_$request_ref"
>request object reference $request_ref</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_product_api_(_$request_ref_)"
>display_product_api ( $request_ref )</a></h2>

<p>Return product data in JSON format.</p>

<p>This function is used only for api v0, v1 and v2. API v3 + uses APIProductRead.pm</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_icon_(_$icon_)"
>display_icon ( $icon )</a></h2>

<p>Displays icons (e.g., the camera icon &#34;Picture with barcode&#34;, the graph and maps button, etc)</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_nested_list_of_ingredients_(_$ingredients_ref,_$ingredients_text_ref,_$ingredients_list_ref_)"
>display_nested_list_of_ingredients ( $ingredients_ref, $ingredients_text_ref, $ingredients_list_ref )</a></h2>

<p>Recursive function to display how the ingredients were analyzed. This function calls itself to display sub-ingredients of ingredients.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$ingredients_ref_(input)"
>$ingredients_ref (input)</a></h4>

<p>Reference to the product&#39;s ingredients array or the ingredients array of an ingredient.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$ingredients_text_ref_(output)"
>$ingredients_text_ref (output)</a></h4>

<p>Reference to a list of ingredients in text format that we will reconstruct from the ingredients array.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$ingredients_list_ref_(output)"
>$ingredients_list_ref (output)</a></h4>

<p>Reference to an HTML list of ingredients in ordered nested list format that corresponds to the ingredients array.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_list_of_specific_ingredients_(_$product_ref_)"
>display_list_of_specific_ingredients ( $product_ref )</a></h2>

<p>Generate HTML to display how the specific ingredients (e.g. mentions like &#34;Total milk content: 90%&#34;) were analyzed.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$product_ref"
>$product_ref</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>Empty string if no specific ingredients were detected, or HTML describing the specific ingredients.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="data_to_display_ingredients_analysis_details_(_$product_ref_)"
>data_to_display_ingredients_analysis_details ( $product_ref )</a></h2>

<p>Generates a data structure to display the details of ingredients analysis.</p>

<p>The resulting data structure can be passed to a template to generate HTML or the JSON data for a knowledge panel.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Product_reference_$product_ref"
>Product reference $product_ref</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Reference to a data structure with needed data to display.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_ingredients_analysis_details_(_$product_ref_)"
>display_ingredients_analysis_details ( $product_ref )</a></h2>

<p>Generates HTML code with information on how the ingredient list was parsed and mapped to the ingredients taxonomy.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="data_to_display_ingredients_analysis_(_$product_ref_)"
>data_to_display_ingredients_analysis ( $product_ref )</a></h2>

<p>Generates a data structure to display the results of ingredients analysis.</p>

<p>The resulting data structure can be passed to a template to generate HTML or the JSON data for a knowledge panel.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Product_reference_$product_ref"
>Product reference $product_ref</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Reference to a data structure with needed data to display.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_ingredients_analysis_(_$product_ref_)"
>display_ingredients_analysis ( $product_ref )</a></h2>

<p>Generates HTML code with icons that show if the product is vegetarian, vegan and without palm oil.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_environmental_score_calculation_details(_$environmental_score_cc,_$environmental_score_data_ref_)"
>display_environmental_score_calculation_details( $environmental_score_cc, $environmental_score_data_ref )</a></h2>

<p>Generates HTML code with information on how the Eco-score was computed for a particular product.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="country_code_$environmental_score_cc"
>country code $environmental_score_cc</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="environmental_score_data_$environmental_score_data_ref"
>environmental_score data $environmental_score_data_ref</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_environmental_score_calculation_details_simple_html(_$environmental_score_cc,_$environmental_score_data_ref_)"
>display_environmental_score_calculation_details_simple_html( $environmental_score_cc, $environmental_score_data_ref )</a></h2>

<p>Generates simple HTML code (to display in a mobile app) with information on how the Eco-score was computed for a particular product.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="search_and_analyze_recipes_($request_ref,_$query_ref)"
>search_and_analyze_recipes ($request_ref, $query_ref)</a></h2>

<p>Analyze the distribution of selected parent ingredients in the searched products</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_properties_($request_ref)"
>display_properties ($request_ref)</a></h2>

<p>Load the Folksonomy Engine properties script</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
