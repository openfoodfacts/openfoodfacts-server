<html><head><title>ProductOpener::Stats</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="simple.min" type="text/css" href="../simple.min.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.43,
  using Pod::Simple::PullParser v3.43,
  under Perl v5.038002 at Wed Feb 25 17:52:01 2026 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#add_product_value_to_stats_(%24values_ref%2C_%24key%2C_%24value)'>add_product_value_to_stats ($values_ref, $key, $value)</a>
    <li class='indexItem indexItem2'><a href='#compute_stats_for_products_(%24stats_ref%2C_%24values_ref%2C_%24count%2C_%24n%2C_%24min_products%2C_%24id)'>compute_stats_for_products ($stats_ref, $values_ref, $count, $n, $min_products, $id)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Stats_reference_%24stats_ref'>Stats reference $stats_ref</a>
        <li class='indexItem indexItem4'><a href='#Values_reference_%24values_ref'>Values reference $values_ref</a>
        <li class='indexItem indexItem4'><a href='#Total_number_of_products_%24count'>Total number of products $count</a>
        <li class='indexItem indexItem4'><a href='#Number_of_products_with_defined_values_for_specified_nutrients_%24n'>Number of products with defined values for specified nutrients $n</a>
        <li class='indexItem indexItem4'><a href='#Minimum_number_of_products_needed_to_compute_stats_%24min_products'>Minimum number of products needed to compute stats $min_products</a>
        <li class='indexItem indexItem4'><a href='#ID_%24id'>ID $id</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#load_categories_stats_per_country_(%24force_reload_%3D_0)'>load_categories_stats_per_country ($force_reload = 0)</a>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>ProductOpener::Stats - Compute stats for categories (nutrients,
etc.)</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This module provides functions to compute and load stats for categories (nutrients,
etc.)</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="add_product_value_to_stats_($values_ref,_$key,_$value)"
>add_product_value_to_stats ($values_ref,
$key,
$value)</a></h2>

<p>This build a collection (<code>$value_ref</code>) were for each nutrients (or other numeric attribute),
<code>$key</code>,
we store the accumulate values for that nutrient (<code>s</code>),
number of instances &#60;n&#62; and each values <code>array</code>).</p>

<p>We will then pass <code>$values_ref</code> to <code>compute_stats_for_products</code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_stats_for_products_($stats_ref,_$values_ref,_$count,_$n,_$min_products,_$id)"
>compute_stats_for_products ($stats_ref,
$values_ref,
$count,
$n,
$min_products,
$id)</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Stats_reference_$stats_ref"
>Stats reference $stats_ref</a></h4>

<p>Where we will store the stats.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Values_reference_$values_ref"
>Values reference $values_ref</a></h4>

<p>Values for some nutrients (or other numeric values),
with accumulated values and number of products considered (it is different from <code>$n</code> as some products might not have a value).
See <code>add_product_value_to_stats</code></p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Total_number_of_products_$count"
>Total number of products $count</a></h4>

<p>Including products that have no values for the nutrients we are interested in.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Number_of_products_with_defined_values_for_specified_nutrients_$n"
>Number of products with defined values for specified nutrients $n</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Minimum_number_of_products_needed_to_compute_stats_$min_products"
>Minimum number of products needed to compute stats $min_products</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="ID_$id"
>ID $id</a></h4>

<p>E.g.
category ID.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="load_categories_stats_per_country_($force_reload_=_0)"
>load_categories_stats_per_country ($force_reload = 0)</a></h2>

<p>Loads nutrient stats for all categories and countries.
If the data is already loaded,
it does not reload it unless $force_reload is true.</p>

<p>The stats are displayed on category pages and used in product pages,
as well as in data quality checks and improvement opportunity detection.</p>

<p>In integration tests,
there are no stats in the data directory,
and it is difficult to generate them on the fly as we need to stop and start Apache after to load them,
which is complex in the test framework with Docker.</p>

<p>So instead we load them from the test data directory.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
