<html><head><title>ProductOpener::PackagingStats</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="simple.min" type="text/css" href="../simple.min.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.42,
  using Pod::Simple::PullParser v3.42,
  under Perl v5.034000 at Tue Dec  5 17:13:54 2023 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#add_product_components_to_stats(%24name%2C_%24packagings_stats_ref%2C_%24product_ref)'>add_product_components_to_stats($name, $packagings_stats_ref, $product_ref)</a>
    <li class='indexItem indexItem2'><a href='#compute_stats_for_all_weights_(%24packagings_stats_ref)'>compute_stats_for_all_weights ($packagings_stats_ref)</a>
    <li class='indexItem indexItem2'><a href='#compute_stats_for_values_(%24values_ref)'>compute_stats_for_values ($values_ref)</a>
    <li class='indexItem indexItem2'><a href='#remove_unpopular_categories_shapes_and_materials_(%24packagings_stats_ref%2C_%24min_products)'>remove_unpopular_categories_shapes_and_materials ($packagings_stats_ref, $min_products)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24packagings_stats_ref'>$packagings_stats_ref</a>
        <li class='indexItem indexItem4'><a href='#%24min_products'>$min_products</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#remove_packagings_materials_stats_for_unpopular_categories_(%24packagings_materials_stats_ref%2C_%24min_products)'>remove_packagings_materials_stats_for_unpopular_categories ($packagings_materials_stats_ref, $min_products)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24packagings_materials_stats_ref'>$packagings_materials_stats_ref</a>
        <li class='indexItem indexItem4'><a href='#%24min_products'>$min_products</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#store_stats(%24name%2C_%24packagings_stats_ref%2C_%24packagings_materials_stats_ref)'>store_stats($name, $packagings_stats_ref, $packagings_materials_stats_ref)</a>
    <li class='indexItem indexItem2'><a href='#init_products_packaging_components_csv(%24name)'>init_products_packaging_components_csv($name)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24filehandle'>$filehandle</a>
        <li class='indexItem indexItem4'><a href='#%24csv'>$csv</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#export_product_packaging_components_to_csv(%24csv%2C_%24filehandle%2C_%24product_ref)'>export_product_packaging_components_to_csv($csv, $filehandle, $product_ref)</a>
    <li class='indexItem indexItem2'><a href='#add_product_materials_to_stats(%24name%2C_%24packagings_stats_ref%2C_%24product_ref)'>add_product_materials_to_stats($name, $packagings_stats_ref, $product_ref)</a>
    <li class='indexItem indexItem2'><a href='#compute_stats_for_all_materials_(%24packagings_materials_stats_ref)'>compute_stats_for_all_materials ($packagings_materials_stats_ref)</a>
    <li class='indexItem indexItem2'><a href='#generate_packaging_stats_for_query(%24name%2C_%24query_ref)'>generate_packaging_stats_for_query($name, $query_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#name_%24name'>name $name</a>
        <li class='indexItem indexItem4'><a href='#query_reference_%24query_ref'>query reference $query_ref</a>
      </ul>
    </ul>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>ProductOpener::PackagingStats</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>Generates aggregated data about the packaging components of products for a specific category in a specific country</p>

<p>Aggregation counts are stored in a structure of the form:</p>

<p>{ countries =&#62; { &#34;en:world&#34; =&#62; ..
&#34;en:france&#34; =&#62; { categories =&#62; { &#34;all&#34; =&#62; ..
# stats for all categories &#34;en:yogourts&#34; =&#62; { shapes =&#62; { &#34;en:unknown&#34; =&#62; ..
&#34;all&#34; =&#62; ..
# stats for all shapes &#34;en:bottle&#34; =&#62; { materials_parents =&#62; ..
# stats for parents materials (e.g.
PET will also count for plastic) materials =&#62; { &#34;all&#34; =&#62; ..
&#34;en:plastic&#34; =&#62; 12,
# number of products sold in France that are yogurts and that have a plastic bottle packaging component } },
..
} },
..
} },
..
} }</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="add_product_components_to_stats($name,_$packagings_stats_ref,_$product_ref)"
>add_product_components_to_stats($name,
$packagings_stats_ref,
$product_ref)</a></h2>

<p>Add data from all packagings of a product to stats for all its countries and categories combinations.</p>

<p>When $name is &#34;packagings-with-weights&#34;,
we store stats for weights,
otherwise,
we store only the number of products.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_stats_for_all_weights_($packagings_stats_ref)"
>compute_stats_for_all_weights ($packagings_stats_ref)</a></h2>

<p>Compute stats (means etc.) for packaging components,
aggregated at the countries,
categories,
shapes and materials levels</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_stats_for_values_($values_ref)"
>compute_stats_for_values ($values_ref)</a></h2>

<p>Compute stats for values (e.g.
weights or percent) passed in $values_ref-&#62;{values} in comma delimited format The values are converted to an array.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="remove_unpopular_categories_shapes_and_materials_($packagings_stats_ref,_$min_products)"
>remove_unpopular_categories_shapes_and_materials ($packagings_stats_ref,
$min_products)</a></h2>

<p>Remove stats for categories,
shapes,
and materials that have less than the required amount of product.</p>

<p>This is necessary to generate a smaller dataset that can be used to generate autocomplete suggestions for packaging shapes and materials,
given a country and a list of categories of the product.</p>

<p>Also remove shapes_parents and materials_parents</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$packagings_stats_ref"
>$packagings_stats_ref</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$min_products"
>$min_products</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="remove_packagings_materials_stats_for_unpopular_categories_($packagings_materials_stats_ref,_$min_products)"
>remove_packagings_materials_stats_for_unpopular_categories ($packagings_materials_stats_ref,
$min_products)</a></h2>

<p>Remove packaging materials stats for categories that have less than the required amount of product.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$packagings_materials_stats_ref"
>$packagings_materials_stats_ref</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$min_products"
>$min_products</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="store_stats($name,_$packagings_stats_ref,_$packagings_materials_stats_ref)"
>store_stats($name,
$packagings_stats_ref,
$packagings_materials_stats_ref)</a></h2>

<p>Store the stats in JSON format for internal use in Product Opener and store a copy in the static web directory</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="init_products_packaging_components_csv($name)"
>init_products_packaging_components_csv($name)</a></h2>

<p>Open a file,
initialize a Text::CSV object,
and output the CSV header for packaging components.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$filehandle"
>$filehandle</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$csv"
>$csv</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="export_product_packaging_components_to_csv($csv,_$filehandle,_$product_ref)"
>export_product_packaging_components_to_csv($csv,
$filehandle,
$product_ref)</a></h2>

<p>Export each packaging component of the product as one line in the CSV file.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="add_product_materials_to_stats($name,_$packagings_stats_ref,_$product_ref)"
>add_product_materials_to_stats($name,
$packagings_stats_ref,
$product_ref)</a></h2>

<p>Add aggregated (by parent materials) data for all packagings of a product to stats for all its countries and categories combinations.</p>

<p>For each material,
we record values for those fields: - contain: the product contains the material - main: the product has the material as its main material - weight: weight of the material,
even if the product does not contain it (0 otherwise) - weight_contain: weight of the material,
if the product contains it - weight_main: weight of the material,
if the product has it as its main material</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_stats_for_all_materials_($packagings_materials_stats_ref)"
>compute_stats_for_all_materials ($packagings_materials_stats_ref)</a></h2>

<p>Compute stats (means etc.) for packaging materials,
aggregated at the countries,
categories and materials levels</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="generate_packaging_stats_for_query($name,_$query_ref)"
>generate_packaging_stats_for_query($name,
$query_ref)</a></h2>

<p>Generate packaging stats for products matching a specific query.</p>

<p>Stats are saved in .json format in $BASE_DIRS{PRIVATE_DATA}/categories_stats/ and in JSON format in $BASE_DIRS{PUBLIC_DATA}/categories_stats/</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="name_$name"
>name $name</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="query_reference_$query_ref"
>query reference $query_ref</a></h4>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
