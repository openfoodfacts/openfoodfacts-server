<html><head><title>ProductOpener::ProductSchemaChanges</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="simple.min" type="text/css" href="../simple.min.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.43,
  using Pod::Simple::PullParser v3.43,
  under Perl v5.038002 at Wed Feb 18 15:20:35 2026 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Schema_version_numbering'>Schema version numbering</a>
    <li class='indexItem indexItem2'><a href='#Schema_conversion_functions'>Schema conversion functions</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#convert_product_schema_(%24product_ref%2C_%24to_version)'>convert_product_schema ($product_ref, $to_version)</a>
    <li class='indexItem indexItem2'><a href='#998_to_999_-_Change_in_barcode_normalization'>998 to 999 - Change in barcode normalization</a>
    <li class='indexItem indexItem2'><a href='#999_to_1000_-_Rename_ecoscore_fields_to_environmental_score_fields_-_API_v3.1'>999 to 1000 - Rename ecoscore fields to environmental_score fields - API v3.1</a>
    <li class='indexItem indexItem2'><a href='#1000_to_1001_-_Remove_the_ingredients_hierarchy_field_-_API_v3.2'>1000 to 1001 - Remove the ingredients_hierarchy field - API v3.2</a>
    <li class='indexItem indexItem2'><a href='#1001_to_1002_-_Refactor_the_images_object'>1001 to 1002 - Refactor the images object</a>
    <li class='indexItem indexItem2'><a href='#1002_to_1003_-_Refactor_the_product_nutrition_schema_-_API_v3.5'>1002 to 1003 - Refactor the product nutrition schema - API v3.5</a>
    <li class='indexItem indexItem2'><a href='#set_per_unit'>set_per_unit</a>
    <li class='indexItem indexItem2'><a href='#1003_to_1002_-_Refactor_the_product_nutrition_schema_-_API_v3.5'>1003 to 1002 - Refactor the product nutrition schema - API v3.5</a>
    <li class='indexItem indexItem2'><a href='#_has_nutrition_data_for_product_type_(%24product_ref%2C_%24nutrition_product_type)'>_has_nutrition_data_for_product_type ($product_ref, $nutrition_product_type)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24product_ref_-_ref_to_the_product'>$product_ref - ref to the product</a>
        <li class='indexItem indexItem4'><a href='#%24nutrition_product_type_-_string%2C_either_%22%22_or_%22_prepared%22'>$nutrition_product_type - string, either &#34;&#34; or &#34;_prepared&#34;</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#0_or_1'>0 or 1</a>
        <li class='indexItem indexItem4'><a href='#0_if_the_product_does_not_have_nutrition_data_for_the_given_type'>0 if the product does not have nutrition data for the given type</a>
        <li class='indexItem indexItem4'><a href='#1_if_the_product_has_nutrition_data_for_the_given_type'>1 if the product has nutrition data for the given type</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#_compute_nutrition_data_per_100g_and_per_serving_for_old_nutrition_schema_(%24product_ref)'>_compute_nutrition_data_per_100g_and_per_serving_for_old_nutrition_schema ($product_ref)</a>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>ProductOpener::ProductSchemaChanges - convert product data between different schema versions</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p><code>ProductOpener::ProductSchemaChanges</code> is used to convert product data between different schema versions.</p>

<p>It can convert older product data (e.g.
from old revisions of products) to the current schema version.</p>

<p>And for API backward compatibility,
it can also convert the current product data to older schema versions.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Schema_version_numbering"
>Schema version numbering</a></h2>

<p>Starting from March 2024,
we will now include a new field in the product data called &#34;schema_version&#34;,
which will be an integer,
starting at 1001.</p>

<p>The schema version will be incremented by 1 each time we make a change to the product data schema.</p>

<p>Products without a schema_version field will be considered to be at a schema version under 1000</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Schema_conversion_functions"
>Schema conversion functions</a></h2>

<p>We will keep a list of functions that can convert product data between different schema versions.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="convert_product_schema_($product_ref,_$to_version)"
>convert_product_schema ($product_ref,
$to_version)</a></h2>

<p>Convert product data between different schema versions.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="998_to_999_-_Change_in_barcode_normalization"
>998 to 999 - Change in barcode normalization</a></h2>

<p>Change in normalization of leading 0s.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="999_to_1000_-_Rename_ecoscore_fields_to_environmental_score_fields_-_API_v3.1"
>999 to 1000 - Rename ecoscore fields to environmental_score fields - API v3.1</a></h2>

<p>2024/12/12 -</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="1000_to_1001_-_Remove_the_ingredients_hierarchy_field_-_API_v3.2"
>1000 to 1001 - Remove the ingredients_hierarchy field - API v3.2</a></h2>

<p>2012/03/14</p>

<p>- Remove the ingredients_hierarchy field,
which was a duplicate of the ingredients_tags field - Taxonomize brands</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="1001_to_1002_-_Refactor_the_images_object"
>1001 to 1002 - Refactor the images object</a></h2>

<p>The images object is restructured to separate uploaded images from selected images</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="1002_to_1003_-_Refactor_the_product_nutrition_schema_-_API_v3.5"
>1002 to 1003 - Refactor the product nutrition schema - API v3.5</a></h2>

<p>The nutrition schema is updated to allow storing several nutrition sets</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="set_per_unit"
>set_per_unit</a></h2>

<p>Set the per unit depending on the given product quantity unit,
the serving quantity unit and on the fact that the created set is per 100g or per serving</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="1003_to_1002_-_Refactor_the_product_nutrition_schema_-_API_v3.5"
>1003 to 1002 - Refactor the product nutrition schema - API v3.5</a></h2>

<p>The nutrition schema is updated to allow storing several nutrition input sets.
To downgrade,
we use only the aggregated set to generate the nutriments field.</p>

<p>This means that for some products,
we will return less information in the downgraded version,
as we will return only as sold data or prepared data,
but not both as was possible in the 1002 version.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_has_nutrition_data_for_product_type_($product_ref,_$nutrition_product_type)"
>_has_nutrition_data_for_product_type ($product_ref,
$nutrition_product_type)</a></h2>

<p>NOTE: this function used to be in Food.pm and it was used for the old nutrition data schema in the &#34;nutriments&#34; field.</p>

<p>It has been moved to this module as it is now needed only for schema upggrades.</p>

<p>--</p>

<p>Check if the product has nutrition data for the given type (&#34;&#34; or &#34;_prepared&#34;).</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$product_ref_-_ref_to_the_product"
>$product_ref - ref to the product</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$nutrition_product_type_-_string,_either_&#34;&#34;_or_&#34;_prepared&#34;"
>$nutrition_product_type - string,
either &#34;&#34; or &#34;_prepared&#34;</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="0_or_1"
>0 or 1</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="0_if_the_product_does_not_have_nutrition_data_for_the_given_type"
>0 if the product does not have nutrition data for the given type</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="1_if_the_product_has_nutrition_data_for_the_given_type"
>1 if the product has nutrition data for the given type</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_compute_nutrition_data_per_100g_and_per_serving_for_old_nutrition_schema_($product_ref)"
>_compute_nutrition_data_per_100g_and_per_serving_for_old_nutrition_schema ($product_ref)</a></h2>

<p>NOTE: this function used to be in Food.pm and it was used for the old nutrition data schema in the &#34;nutriments&#34; field.</p>

<p>It has been moved to this module as it is now needed only for schema downgrades.</p>

<p>--</p>

<p>Input nutrition data is indicated per 100g or per serving.
This function computes the nutrition data for the other quantity (per serving or per 100g) if we know the serving quantity.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
