<html><head><title>ProductOpener::Test</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="simple.min" type="text/css" href="../simple.min.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.43,
  using Pod::Simple::PullParser v3.43,
  under Perl v5.038002 at Tue Sep  9 09:40:01 2025 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#read_gzip_file(%24filepath)'>read_gzip_file($filepath)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#String_%24filepath'>String $filepath</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#check_ocr_result(%24ocr_result)'>check_ocr_result($ocr_result)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#String_%24ocr_result'>String $ocr_result</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#init_expected_results(%24filepath)'>init_expected_results($filepath)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#String_%24filepath'>String $filepath</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#return_list'>return list</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#check_not_production_()'>check_not_production ()</a>
    <li class='indexItem indexItem2'><a href='#remove_all_products_()'>remove_all_products ()</a>
    <li class='indexItem indexItem2'><a href='#remove_all_users_()'>remove_all_users ()</a>
    <li class='indexItem indexItem2'><a href='#remove_all_orgs_()'>remove_all_orgs ()</a>
    <li class='indexItem indexItem2'><a href='#capture_ouputs_(%24meth)'>capture_ouputs ($meth)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Example_usage'>Example usage</a>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24meth_-_pointer_to_a_sub'>$meth - pointer to a sub</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#compare_to_expected_results(%24object_ref%2C_%24expected_results_file%2C_%24update_expected_results%2C_%24test_ref_%3D_undef)_%7B'>compare_to_expected_results($object_ref, $expected_results_file, $update_expected_results, $test_ref = undef) {</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24object_ref_-_reference_to_an_object_(e.g._%24product_ref)'>$object_ref - reference to an object (e.g. $product_ref)</a>
        <li class='indexItem indexItem4'><a href='#%24expected_results_file_-_path_to_the_file_with_stored_results'>$expected_results_file - path to the file with stored results</a>
        <li class='indexItem indexItem4'><a href='#%24update_expected_results_-_flag_to_indicate_to_save_test_results_as_expected_results'>$update_expected_results - flag to indicate to save test results as expected results</a>
        <li class='indexItem indexItem4'><a href='#%24test_ref_-_an_optional_reference_to_an_object_describing_the_test_case'>$test_ref - an optional reference to an object describing the test case</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#compare_file_to_expected_results(%24content_str%2C_%24expected_results_file%2C_%24update_expected_results%2C_%24test_ref_%3D_undef)_%7B'>compare_file_to_expected_results($content_str, $expected_results_file, $update_expected_results, $test_ref = undef) {</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24content_str_-_the_reference_string'>$content_str - the reference string</a>
        <li class='indexItem indexItem4'><a href='#%24expected_results_file_-_path_to_the_file_with_stored_results'>$expected_results_file - path to the file with stored results</a>
        <li class='indexItem indexItem4'><a href='#%24update_expected_results_-_flag_to_indicate_to_save_test_results_as_expected_results'>$update_expected_results - flag to indicate to save test results as expected results</a>
        <li class='indexItem indexItem4'><a href='#%24test_ref_-_an_optional_reference_to_an_object_describing_the_test_case'>$test_ref - an optional reference to an object describing the test case</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#compare_csv_file_to_expected_results(%24csv_file%2C_%24expected_results_dir%2C_%24update_expected_results)'>compare_csv_file_to_expected_results($csv_file, $expected_results_dir, $update_expected_results)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24csv_file_-_CSV_file_to_compare'>$csv_file - CSV file to compare</a>
        <li class='indexItem indexItem4'><a href='#%24expected_results_dir_-_directory_containing_the_individual_JSON_files'>$expected_results_dir - directory containing the individual JSON files</a>
        <li class='indexItem indexItem4'><a href='#%24update_expected_results_-_flag_to_indicate_to_save_test_results_as_expected_results'>$update_expected_results - flag to indicate to save test results as expected results</a>
        <li class='indexItem indexItem4'><a href='#%24test_name_-_name_of_test_for_failure_display'>$test_name - name of test for failure display</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#compare_array_to_expected_results(%24array_ref%2C_%24expected_results_dir%2C_%24update_expected_results)'>compare_array_to_expected_results($array_ref, $expected_results_dir, $update_expected_results)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24array_ref_-_reference_to_array_of_elements_to_compare'>$array_ref - reference to array of elements to compare</a>
        <li class='indexItem indexItem4'><a href='#%24expected_results_dir_-_directory_containing_the_individual_JSON_files'>$expected_results_dir - directory containing the individual JSON files</a>
        <li class='indexItem indexItem4'><a href='#%24update_expected_results_-_flag_to_indicate_to_save_test_results_as_expected_results'>$update_expected_results - flag to indicate to save test results as expected results</a>
        <li class='indexItem indexItem4'><a href='#%24test_name_-_name_of_the_test_for_outputs'>$test_name - name of the test for outputs</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#create_sto_from_json(json_path%2C_sto_path)'>create_sto_from_json(json_path, sto_path)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#json_path'>json_path</a>
        <li class='indexItem indexItem4'><a href='#sto_path'>sto_path</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#normalize_object_for_test_comparison(%24object_ref%2C_%24specification_ref)'>normalize_object_for_test_comparison($object_ref, $specification_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24object_ref_-_Hash_ref_containing_information'>$object_ref - Hash ref containing information</a>
        <li class='indexItem indexItem4'><a href='#%24specification_ref_-_Hash_ref_of_specification_of_transforms'>$specification_ref - Hash ref of specification of transforms</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#normalize_product_for_test_comparison(%24product_ref)'>normalize_product_for_test_comparison($product_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#product_ref_-_Hash_ref_containing_product_information'>product_ref - Hash ref containing product information</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#normalize_products_for_test_comparison(array_ref)'>normalize_products_for_test_comparison(array_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#array_ref'>array_ref</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#sort_products_for_test_comparison(%24array_ref%2C_%24sort_field)'>sort_products_for_test_comparison($array_ref, $sort_field)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#array_ref'>array_ref</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#normalize_user_for_test_comparison(%24user_ref)'>normalize_user_for_test_comparison($user_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#user_ref_-_Hash_ref_containing_user_information'>user_ref - Hash ref containing user information</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#normalize_org_for_test_comparison(%24org_ref)'>normalize_org_for_test_comparison($org_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#org_ref_-_Hash_ref_containing_org_information'>org_ref - Hash ref containing org information</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#normalize_html_for_test_comparison_(%24html_ref)'>normalize_html_for_test_comparison ($html_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#product_ref_-_Hash_ref_containing_product_information'>product_ref - Hash ref containing product information</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#wait_for(%24code%2C_%24timeout%3D3%2C_%24poll_time%3D1)'>wait_for($code, $timeout=3, $poll_time=1)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#parameters'>parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24code_-_sub'>$code - sub</a>
        <li class='indexItem indexItem4'><a href='#%24timeout_-_float'>$timeout - float</a>
        <li class='indexItem indexItem4'><a href='#%24poll_time_-_float'>$poll_time - float</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#get_base64_image_data_from_file_(%24path)'>get_base64_image_data_from_file ($path)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24path_-_String'>$path - String</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#get_users_from_keycloak()'>get_users_from_keycloak()</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#_delete_user_from_keycloak(%24keycloak_user)'>_delete_user_from_keycloak($keycloak_user)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#parameters'>parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24user_-_sub'>$user - sub</a>
      </ul>
    </ul>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>ProductOpener::Test - utility functions used by unit and integration tests</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="read_gzip_file($filepath)"
>read_gzip_file($filepath)</a></h2>

<p>Read gzipped file and return binary content</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="String_$filepath"
>String $filepath</a></h4>

<p>The path of the gzipped file.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="check_ocr_result($ocr_result)"
>check_ocr_result($ocr_result)</a></h2>

<p>Check that OCR result returned by Google Cloud Vision is as expected: - a single [response] object in `responses` field - `created_at` integer field</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="String_$ocr_result"
>String $ocr_result</a></h4>

<p>String of OCR result JSON as returned by Google Cloud Vision.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="init_expected_results($filepath)"
>init_expected_results($filepath)</a></h2>

<p>Handles test options around expected_results initialization</p>

<p>For many tests,
we compare results from the API,
with expected results.
It enables quick updates on changes,
while still getting control.</p>

<p>There are two modes: one to update expected results,
and one to test against them.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="String_$filepath"
>String $filepath</a></h4>

<p>The path of the file containing the test.
Generally should be &#60;pre&#62;__FILE__&#60;/pre&#62; within the test.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="return_list"
>return list</a></h3>

<p>A list of $test_id,
$test_dir,
$expected_result_dir,
$update_expected_results</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="check_not_production_()"
>check_not_production ()</a></h2>

<p>Fail unless we have less than 10000 products in database.</p>

<p>This is a simple heuristic to ensure we are not in a production database</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="remove_all_products_()"
>remove_all_products ()</a></h2>

<p>For integration tests,
we need to start from an empty database,
so that the results of the tests are not affected by previously existing content.</p>

<p>This function should only be called by tests,
and never on production environments.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="remove_all_users_()"
>remove_all_users ()</a></h2>

<p>For integration tests,
we need to start from an empty user base</p>

<p>This function should only be called by tests,
and never on production environments.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="remove_all_orgs_()"
>remove_all_orgs ()</a></h2>

<p>For integration tests,
we need to start from an empty organizations base</p>

<p>This function should only be called by tests,
and never on production environments.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="capture_ouputs_($meth)"
>capture_ouputs ($meth)</a></h2>

<p>Capturing out / err with Stdout/Stderr::Extended while following Capture::Tiny style</p>

<p>This function can help you verify a command did not output errors,
or verify something is present in its input / output</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Example_usage"
>Example usage</a></h3>

<pre>    my ($out, $err, $csv_result) = capture_ouputs (sub {
        return scalar load_csv_or_excel_file($my_excel);
    });</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$meth_-_pointer_to_a_sub"
>$meth - pointer to a sub</a></h4>

<p>Method to run while capturing outputs - it should not take any parameter.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>Returns an array with std output, std error, result of the method as array.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compare_to_expected_results($object_ref,_$expected_results_file,_$update_expected_results,_$test_ref_=_undef)_{"
>compare_to_expected_results($object_ref, $expected_results_file, $update_expected_results, $test_ref = undef) {</a></h2>

<p>Compare an object (e.g. product data or an API result) to expected results.</p>

<p>The expected result is stored as a JSON file.</p>

<p>This is so that we can easily see diffs with git diffs.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$object_ref_-_reference_to_an_object_(e.g._$product_ref)"
>$object_ref - reference to an object (e.g. $product_ref)</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$expected_results_file_-_path_to_the_file_with_stored_results"
>$expected_results_file - path to the file with stored results</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$update_expected_results_-_flag_to_indicate_to_save_test_results_as_expected_results"
>$update_expected_results - flag to indicate to save test results as expected results</a></h4>

<p>Tests will always pass when this flag is passed, and the new expected results can be diffed / committed in GitHub.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$test_ref_-_an_optional_reference_to_an_object_describing_the_test_case"
>$test_ref - an optional reference to an object describing the test case</a></h4>

<p>If the test fail, the test reference will be output in the <code>diag</code></p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compare_file_to_expected_results($content_str,_$expected_results_file,_$update_expected_results,_$test_ref_=_undef)_{"
>compare_file_to_expected_results($content_str, $expected_results_file, $update_expected_results, $test_ref = undef) {</a></h2>

<p>Compare a file (e.g. text or HTML file) to expected results.</p>

<p>The expected result is stored as a plain text file.</p>

<p>This is so that we can easily see diffs with git diffs.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$content_str_-_the_reference_string"
>$content_str - the reference string</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$expected_results_file_-_path_to_the_file_with_stored_results"
>$expected_results_file - path to the file with stored results</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$update_expected_results_-_flag_to_indicate_to_save_test_results_as_expected_results"
>$update_expected_results - flag to indicate to save test results as expected results</a></h4>

<p>Tests will always pass when this flag is passed, and the new expected results can be diffed / committed in GitHub.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$test_ref_-_an_optional_reference_to_an_object_describing_the_test_case"
>$test_ref - an optional reference to an object describing the test case</a></h4>

<p>If the test fail, the test reference will be output in the <code>diag</code></p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compare_csv_file_to_expected_results($csv_file,_$expected_results_dir,_$update_expected_results)"
>compare_csv_file_to_expected_results($csv_file, $expected_results_dir, $update_expected_results)</a></h2>

<p>Compare a CSV file containing product data (e.g. the result of a CSV export) to expected results.</p>

<p>The expected results are stored as individual JSON files for each of the product, in files named [barcode].json, with a flat key/value pairs structure corresponding to the CSV columns.</p>

<p>This is so that we can easily see diffs with git diffs: - we know how many products are affected - we see individual diffs with the field name</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$csv_file_-_CSV_file_to_compare"
>$csv_file - CSV file to compare</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$expected_results_dir_-_directory_containing_the_individual_JSON_files"
>$expected_results_dir - directory containing the individual JSON files</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$update_expected_results_-_flag_to_indicate_to_save_test_results_as_expected_results"
>$update_expected_results - flag to indicate to save test results as expected results</a></h4>

<p>Tests will pass when this flag is passed, and the new expected results can be diffed / committed in GitHub.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$test_name_-_name_of_test_for_failure_display"
>$test_name - name of test for failure display</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compare_array_to_expected_results($array_ref,_$expected_results_dir,_$update_expected_results)"
>compare_array_to_expected_results($array_ref, $expected_results_dir, $update_expected_results)</a></h2>

<p>Compare an array containing product data (e.g. the result of a CSV export) to expected results.</p>

<p>The expected results are stored as individual JSON files for each of the product, in files named [barcode].json, with a flat key/value pairs structure corresponding to the CSV columns.</p>

<p>We normalize some fields like creation dates that change for each test run.</p>

<p>This is so that we can easily see diffs with git diffs: - we know how many products are affected - we see individual diffs with the field name</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$array_ref_-_reference_to_array_of_elements_to_compare"
>$array_ref - reference to array of elements to compare</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$expected_results_dir_-_directory_containing_the_individual_JSON_files"
>$expected_results_dir - directory containing the individual JSON files</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$update_expected_results_-_flag_to_indicate_to_save_test_results_as_expected_results"
>$update_expected_results - flag to indicate to save test results as expected results</a></h4>

<p>Tests will always pass when this flag is passed, and the new expected results can be diffed / committed in GitHub.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$test_name_-_name_of_the_test_for_outputs"
>$test_name - name of the test for outputs</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="create_sto_from_json(json_path,_sto_path)"
>create_sto_from_json(json_path, sto_path)</a></h2>

<p>Create a sto file from a json structure</p>

<p>This might be handy to store data for a test in a readable mode whereas you need it as a sto for your test.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="json_path"
>json_path</a></h4>

<p>Path of source json file</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="sto_path"
>sto_path</a></h4>

<p>Path of target sto file</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="normalize_object_for_test_comparison($object_ref,_$specification_ref)"
>normalize_object_for_test_comparison($object_ref, $specification_ref)</a></h2>

<p>Normalize an object to be able to compare them across tests runs.</p>

<p>We remove some fields and sort some lists.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$object_ref_-_Hash_ref_containing_information"
>$object_ref - Hash ref containing information</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$specification_ref_-_Hash_ref_of_specification_of_transforms"
>$specification_ref - Hash ref of specification of transforms</a></h4>

<p>fields_ignore_content - array of fields which content should be ignored because they vary from test to test. Stars means there is a table of elements and we want to run through all (hash not supported yet)</p>

<p>fields_sort - array of fields which content needs to be sorted to have predictable results</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="normalize_product_for_test_comparison($product_ref)"
>normalize_product_for_test_comparison($product_ref)</a></h2>

<p>Normalize a product to be able to compare them across tests runs.</p>

<p>We remove time dependent fields and sort some lists.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_ref_-_Hash_ref_containing_product_information"
>product_ref - Hash ref containing product information</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="normalize_products_for_test_comparison(array_ref)"
>normalize_products_for_test_comparison(array_ref)</a></h2>

<p>Like normalize_product_for_test_comparison for a list of products</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="array_ref"
>array_ref</a></h4>

<p>Array of products</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="sort_products_for_test_comparison($array_ref,_$sort_field)"
>sort_products_for_test_comparison($array_ref, $sort_field)</a></h2>

<p>Sort products so that they are always in the same order</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="array_ref"
>array_ref</a></h4>

<p>Array of products</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="normalize_user_for_test_comparison($user_ref)"
>normalize_user_for_test_comparison($user_ref)</a></h2>

<p>Normalize a user to be able to compare them across tests runs.</p>

<p>We remove time dependent fields, password (which encryption use salt) and sort some lists.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="user_ref_-_Hash_ref_containing_user_information"
>user_ref - Hash ref containing user information</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="normalize_org_for_test_comparison($org_ref)"
>normalize_org_for_test_comparison($org_ref)</a></h2>

<p>Normalize a org to be able to compare them across tests runs.</p>

<p>We remove time dependent fields, password (which encryption use salt) and sort some lists.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="org_ref_-_Hash_ref_containing_org_information"
>org_ref - Hash ref containing org information</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="normalize_html_for_test_comparison_($html_ref)"
>normalize_html_for_test_comparison ($html_ref)</a></h2>

<p>Normalize the HTML of a web page to be able to compare them across tests runs.</p>

<p>We remove time dependent fields.</p>

<p>We also normalize URLS to avoid the scheme prefix (so that we avoid false positives in CodeQL)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_ref_-_Hash_ref_containing_product_information"
>product_ref - Hash ref containing product information</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="wait_for($code,_$timeout=3,_$poll_time=1)"
>wait_for($code, $timeout=3, $poll_time=1)</a></h2>

<p>Wait for an event to happen, up to a certain amount of time</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="parameters"
>parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$code_-_sub"
>$code - sub</a></h4>

<p>This must be the code that check for the event and return a true value if it succeed, false otherwise</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$timeout_-_float"
>$timeout - float</a></h4>

<p>how many seconds to wait (default 3s)</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$poll_time_-_float"
>$poll_time - float</a></h4>

<p>how much time to wait between checks</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_base64_image_data_from_file_($path)"
>get_base64_image_data_from_file ($path)</a></h2>

<p>Get the base64 encoded image data from a file.</p>

<p>Used for API v3 image upload, where we pass the image data as base64 encoded string.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$path_-_String"
>$path - String</a></h4>

<p>The path of the image file.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>Returns the base64 encoded image data as a string.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_users_from_keycloak()"
>get_users_from_keycloak()</a></h2>

<p>Get a list of users registered in our Keycloak realm</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Returns an array of users in Keycloak.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_delete_user_from_keycloak($keycloak_user)"
>_delete_user_from_keycloak($keycloak_user)</a></h2>

<p>Removes the given users from our Keycloak realm</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="parameters"
>parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$user_-_sub"
>$user - sub</a></h4>

<p>The user that will be deleted from Keycloak</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
