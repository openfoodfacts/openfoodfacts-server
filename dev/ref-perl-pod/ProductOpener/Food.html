<html><head><title>ProductOpener::Food</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="simple.min" type="text/css" href="../simple.min.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.43,
  using Pod::Simple::PullParser v3.43,
  under Perl v5.038002 at Fri Feb 27 16:07:37 2026 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#%25nutrients_tables'>%nutrients_tables</a>
    <li class='indexItem indexItem2'><a href='#is_beverage_for_nutrition_score_2021_(_%24product_ref_)'>is_beverage_for_nutrition_score_2021 ( $product_ref )</a>
    <li class='indexItem indexItem2'><a href='#is_beverage_for_nutrition_score_2023_(_%24product_ref_)'>is_beverage_for_nutrition_score_2023 ( $product_ref )</a>
    <li class='indexItem indexItem2'><a href='#is_water_for_nutrition_score(_%24product_ref_)'>is_water_for_nutrition_score( $product_ref )</a>
    <li class='indexItem indexItem2'><a href='#is_cheese_for_nutrition_score(_%24product_ref_)'>is_cheese_for_nutrition_score( $product_ref )</a>
    <li class='indexItem indexItem2'><a href='#is_fat_for_nutrition_score(_%24product_ref_)'>is_fat_for_nutrition_score( $product_ref )</a>
    <li class='indexItem indexItem2'><a href='#is_fat_oil_nuts_seeds_for_nutrition_score(_%24product_ref_)'>is_fat_oil_nuts_seeds_for_nutrition_score( $product_ref )</a>
    <li class='indexItem indexItem2'><a href='#is_red_meat_for_nutrition_score_(_%24product_ref_)'>is_red_meat_for_nutrition_score ( $product_ref )</a>
    <li class='indexItem indexItem2'><a href='#compute_nutriscore_2021_fruits_vegetables_nuts_colza_walnut_olive_oil(%24product_ref)'>compute_nutriscore_2021_fruits_vegetables_nuts_colza_walnut_olive_oil($product_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#return'>return</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#compute_nutriscore_2023_fruits_vegetables_legumes(%24product_ref)'>compute_nutriscore_2023_fruits_vegetables_legumes($product_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24product_ref_-_ref_to_the_product'>$product_ref - ref to the product</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#saturated_fat_ratio(_%24nutrition_ref_)'>saturated_fat_ratio( $nutrition_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24nutrition_ref_-_ref_to_the_nutrition_of_a_product'>$nutrition_ref - ref to the nutrition of a product</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#saturated_fat_0_because_of_fat_0_(%24nutrition_ref)'>saturated_fat_0_because_of_fat_0 ($nutrition_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24nutrition_ref_-_ref_to_the_nutrition_of_a_product'>$nutrition_ref - ref to the nutrition of a product</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#sugar_0_because_of_carbohydrates_0_(%24nutrition_ref)'>sugar_0_because_of_carbohydrates_0 ($nutrition_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24nutrition_ref_-_ref_to_the_nutrition_of_a_product'>$nutrition_ref - ref to the nutrition of a product</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#compute_nutriscore_data(_%24products_ref%2C_%24preparation%2C_%24version_)'>compute_nutriscore_data( $products_ref, $preparation, $version )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24product_ref_-_ref_to_the_product'>$product_ref - ref to the product</a>
        <li class='indexItem indexItem4'><a href='#%24preparation_-_%22as_sold%22_or_%22prepared%22'>$preparation - &#34;as_sold&#34; or &#34;prepared&#34;</a>
        <li class='indexItem indexItem4'><a href='#%24version_-_version_of_nutriscore_to_compute_data_for._Either_%222021%22_or_%222023%22._Default_is_%222021%22'>$version - version of nutriscore to compute data for. Either &#34;2021&#34; or &#34;2023&#34;. Default is &#34;2021&#34;</a>
        <li class='indexItem indexItem4'><a href='#_'></a>
      </ul>
      <li class='indexItem indexItem3'><a href='#return'>return</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#remove_nutriscore_fields_(_%24product_ref_)'>remove_nutriscore_fields ( $product_ref )</a>
    <li class='indexItem indexItem2'><a href='#is_nutriscore_applicable_to_the_product_categories(%24product_ref)'>is_nutriscore_applicable_to_the_product_categories($product_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24category_available_-_0_or_1'>$category_available - 0 or 1</a>
        <li class='indexItem indexItem4'><a href='#%24nutriscore_applicable_-_0_or_1'>$nutriscore_applicable - 0 or 1</a>
        <li class='indexItem indexItem4'><a href='#%24not_applicable_category_-_undef_or_category_id'>$not_applicable_category - undef or category id</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#has_category_that_should_have_prepared_nutrition_data(%24product_ref)'>has_category_that_should_have_prepared_nutrition_data($product_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24product_ref_-_ref_to_the_product'>$product_ref - ref to the product</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24category_tag_-_undef_or_category_tag'>$category_tag - undef or category tag</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#check_availability_of_nutrients_needed_for_nutriscore_(%24product_ref)'>check_availability_of_nutrients_needed_for_nutriscore ($product_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24product_ref_-_ref_to_the_product'>$product_ref - ref to the product</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24nutrients_available_0_or_1'>$nutrients_available 0 or 1</a>
        <li class='indexItem indexItem4'><a href='#%24preparation%3A_%22as_sold%22_or_%22prepared%22'>$preparation: &#34;as_sold&#34; or &#34;prepared&#34;</a>
        <li class='indexItem indexItem4'><a href='#%24estimated%3A_0_or_1'>$estimated: 0 or 1</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#set_fields_for_current_version_of_nutriscore(%24product_ref%2C_%24current_version%2C_%24nutriscore_score%2C_%24nutriscore_grade)'>set_fields_for_current_version_of_nutriscore($product_ref, $current_version, $nutriscore_score, $nutriscore_grade)</a>
    <li class='indexItem indexItem2'><a href='#set_fields_comparing_nutriscore_versions(%24product_ref%2C_%24version1%2C_%24version2)'>set_fields_comparing_nutriscore_versions($product_ref, $version1, $version2)</a>
    <li class='indexItem indexItem2'><a href='#compute_nutriscore(_%24product_ref%2C_%24current_version_%3D_%222023%22_)'>compute_nutriscore( $product_ref, $current_version = &#34;2023&#34; )</a>
    <li class='indexItem indexItem2'><a href='#compute_nutrient_levels_(%24product_ref)'>compute_nutrient_levels ($product_ref)</a>
    <li class='indexItem indexItem2'><a href='#create_nutrients_level_taxonomy_()'>create_nutrients_level_taxonomy ()</a>
    <li class='indexItem indexItem2'><a href='#compute_units_of_alcohol_(%24product_ref%2C_%24serving_size_in_ml)'>compute_units_of_alcohol ($product_ref, $serving_size_in_ml)</a>
    <li class='indexItem indexItem2'><a href='#compare_nutrients_(%24a_ref%2C_%24b_ref)'>compare_nutrients ($a_ref, $b_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24a_ref_-_ref_to_a_product%2C_a_category%2C_ajr_etc.'>$a_ref - ref to a product, a category, ajr etc.</a>
        <li class='indexItem indexItem4'><a href='#%24b_ref_-_ref_to_a_structure_with_nutrient_values_to_compare_to'>$b_ref - ref to a structure with nutrient values to compare to</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#assign_categories_properties_to_product_(_PRODUCT_REF_)'>assign_categories_properties_to_product ( PRODUCT_REF )</a>
    <li class='indexItem indexItem2'><a href='#get_nutrient_unit_(_%24nid%2C_%24cc_)'>get_nutrient_unit ( $nid, $cc )</a>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>ProductOpener::Food - functions related to food products and nutrition</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p><code>ProductOpener::Food</code> contains functions specific to food products,
in particular related to nutrition facts.
This module provides functions It does not contain functions related to ingredients which are in the <code>ProductOpener::Ingredients</code> module.</p>

<p>..</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="%nutrients_tables"
>%nutrients_tables</a></h2>

<p>An array that condition how nutrients are displayed.</p>

<p>It is a list of nutrients names with eventual prefixes and suffixes:</p>

<dl>
<dt><a name="#nutrient_a_leading_#_indicates_a_comment_and_will_be_ignored"
><code>#nutrient</code> a leading <code>#</code> indicates a comment and will be ignored</a></dt>

<dd>
<dt><a name="!nutrient_a_leading_!_indicates_an_important_nutrient,_they_should_always_be_shown"
><code>!nutrient</code> a leading <code>!</code> indicates an important nutrient,
they should always be shown</a></dt>

<dd>
<dt><a name="The_level_of_each_nutrient_is_indicated_by_leading_dashes_before_its_id:"
>The level of each nutrient is indicated by leading dashes before its id:</a></dt>

<dd>
<dl>
<dt><a name="nutrient_-_no_dash_for_top_nutrients"
><code>nutrient</code> - no dash for top nutrients</a></dt>

<dd>
<dt><a name="-sub-nutrient_-_for_level_2"
><code>-sub-nutrient</code> - for level 2</a></dt>

<dd>
<dt><a name="--sub-sub-nutrient_-_for_level_3,_etc."
><code>--sub-sub-nutrient</code> - for level 3,
etc.</a></dt>
</dl>

<dt><a name="nutrient-_a_-_at_the_end_indicates_that_the_nutrient_should_be_hidden_and_only_shown_if_explicitly_added."
><code>nutrient-</code> a <code>-</code> at the end indicates that the nutrient should be hidden and only shown if explicitly added.</a></dt>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="is_beverage_for_nutrition_score_2021_(_$product_ref_)"
>is_beverage_for_nutrition_score_2021 ( $product_ref )</a></h2>

<p>Determines if a product should be considered as a beverage for Nutri-Score computations,
based on the product categories.</p>

<p>2021 Nutri-Score: Dairy drinks are not considered as beverages if they have at least 80% of milk.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="is_beverage_for_nutrition_score_2023_(_$product_ref_)"
>is_beverage_for_nutrition_score_2023 ( $product_ref )</a></h2>

<p>Determines if a product should be considered as a beverage for Nutri-Score computations,
based on the product categories.</p>

<p>2023 Nutri-Score: Milk and dairy drinks are considered beverages.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="is_water_for_nutrition_score(_$product_ref_)"
>is_water_for_nutrition_score( $product_ref )</a></h2>

<p>Determines if a product should be considered as water for Nutri-Score computations,
based on the product categories.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="is_cheese_for_nutrition_score(_$product_ref_)"
>is_cheese_for_nutrition_score( $product_ref )</a></h2>

<p>Determines if a product should be considered as cheese for Nutri-Score computations,
based on the product categories.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="is_fat_for_nutrition_score(_$product_ref_)"
>is_fat_for_nutrition_score( $product_ref )</a></h2>

<p>Determines if a product should be considered as fat for Nutri-Score (2021 version) computations,
based on the product categories.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="is_fat_oil_nuts_seeds_for_nutrition_score(_$product_ref_)"
>is_fat_oil_nuts_seeds_for_nutrition_score( $product_ref )</a></h2>

<p>Determines if a product should be considered as fats / oils / nuts / seeds for Nutri-Score (2023 version) computations,
based on the product categories.</p>

<p>From the 2022 main algorithm report update FINAL:</p>

<p>&#34;This category includes fats and oils from plant or animal sources,
including cream,
margarines,
butters and oils (as the current situation).</p>

<p>Additionally,
the following products are included in this category,
using the Harmonized System Nomenclature1 codes: - Nuts: 0801 0802 - Processed nuts: 200811 200819 - Ground nuts: 1202 - Seeds: 1204 (linseed) 1206 (sunflower)1207 (other seeds)</p>

<p>Of note chestnuts are excluded from the category.&#34;</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="is_red_meat_for_nutrition_score_(_$product_ref_)"
>is_red_meat_for_nutrition_score ( $product_ref )</a></h2>

<p>Determines if a product should be considered as red meat for Nutri-Score (2023 version) computations,
based on the product categories and/or ingredients.</p>

<p>From the 2022 main algorithm report update FINAL:</p>

<p>&#34;Regarding the Codex Alimentarius classifications,
the entire group 08.0 (Meat and meat products,
including poultry and game and all its subgroups) is concerned,
though not all food items in the individual sub-groups are concerned,
only those containing red meat (see above).
In the Harmonized System Classification,
the codes correspond to the following:</p>

<p>Beef: o 0201 Meat of bovine animals,
fresh or chilled o 0202 Meat of bovine animals,
frozen Pork o 0203 Meat of swine,
fresh,
chilled or frozen Lamb: o 0204 Meat of sheep or goats,
fresh,
chilled or frozen Horse o 0205 Horse and equine meat Game and venison o 0208903000 Of game,
other than of rabbits or hares o 02089060 Fresh,
chilled or frozen reindeer meat and edible offal thereof Offals and processed meat (as red meat) o 0206 Edible offal of bovine animals,
swine,
sheep,
goats,
horses,
asses,
mules or hinnies,
fresh,
chilled or frozen o 0210 Meat and edible offal,
salted,
in brine,
dried or smoked; edible flours and meals of meat or meat offal o 1601 sausages o 1602 Prepared or preserved meat,
meat offal,
blood or insects (excl.
sausages and similar products,
and meat extracts and juices) &#9642; All those from swine,
lamb or beef even as mixtures&#34;</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_nutriscore_2021_fruits_vegetables_nuts_colza_walnut_olive_oil($product_ref)"
>compute_nutriscore_2021_fruits_vegetables_nuts_colza_walnut_olive_oil($product_ref)</a></h2>

<p>Compute the fruit % according to the Nutri-Score rules</p>

<p>&#60;b&#62;Warning&#60;/b&#62; Also modifies product_ref-&#62;{misc_tags}</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="return"
>return</a></h3>

<p>The fruit ratio</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_nutriscore_2023_fruits_vegetables_legumes($product_ref)"
>compute_nutriscore_2023_fruits_vegetables_legumes($product_ref)</a></h2>

<p>Compute the % of fruits,
vegetables and legumes for the Nutri-Score 2023 algorithm.</p>

<p>Differences with the 2021 version: - we use only the estimate from the ingredients or a conservative estimate from the product category - we do not use values estimated by users from ingredients list: too difficult to know what should be included or not</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$product_ref_-_ref_to_the_product"
>$product_ref - ref to the product</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Return undef if no value could be computed or estimated.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="saturated_fat_ratio(_$nutrition_ref_)"
>saturated_fat_ratio( $nutrition_ref )</a></h2>

<p>Compute saturated_fat_ratio as needed for nutriscore</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$nutrition_ref_-_ref_to_the_nutrition_of_a_product"
>$nutrition_ref - ref to the nutrition of a product</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="saturated_fat_0_because_of_fat_0_($nutrition_ref)"
>saturated_fat_0_because_of_fat_0 ($nutrition_ref)</a></h2>

<p>Detect if we are in the special case where we can detect saturated fat is 0 because fat is 0</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$nutrition_ref_-_ref_to_the_nutrition_of_a_product"
>$nutrition_ref - ref to the nutrition of a product</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="sugar_0_because_of_carbohydrates_0_($nutrition_ref)"
>sugar_0_because_of_carbohydrates_0 ($nutrition_ref)</a></h2>

<p>Detect if we are in the special case where we can detect sugars are 0 because carbohydrates are 0</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$nutrition_ref_-_ref_to_the_nutrition_of_a_product"
>$nutrition_ref - ref to the nutrition of a product</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_nutriscore_data(_$products_ref,_$preparation,_$version_)"
>compute_nutriscore_data( $products_ref,
$preparation,
$version )</a></h2>

<p>Compute data for nutriscore computation.</p>

<p>&#60;b&#62;Warning:&#60;/b&#62; it also modifies $product_ref</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$product_ref_-_ref_to_the_product"
>$product_ref - ref to the product</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$preparation_-_&#34;as_sold&#34;_or_&#34;prepared&#34;"
>$preparation - &#34;as_sold&#34; or &#34;prepared&#34;</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$version_-_version_of_nutriscore_to_compute_data_for._Either_&#34;2021&#34;_or_&#34;2023&#34;._Default_is_&#34;2021&#34;"
>$version - version of nutriscore to compute data for.
Either &#34;2021&#34; or &#34;2023&#34;.
Default is &#34;2021&#34;</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="_"
></a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="return"
>return</a></h3>

<p>Ref to a mapping suitable to call compute_nutriscore_score_and_grade</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="remove_nutriscore_fields_(_$product_ref_)"
>remove_nutriscore_fields ( $product_ref )</a></h2>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="is_nutriscore_applicable_to_the_product_categories($product_ref)"
>is_nutriscore_applicable_to_the_product_categories($product_ref)</a></h2>

<p>Check that the product has a category,
that we know if it is a beverage or not,
and that it is not in a category for which the Nutri-Score should not be computed (e.g.
food for babies)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$category_available_-_0_or_1"
>$category_available - 0 or 1</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$nutriscore_applicable_-_0_or_1"
>$nutriscore_applicable - 0 or 1</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$not_applicable_category_-_undef_or_category_id"
>$not_applicable_category - undef or category id</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="has_category_that_should_have_prepared_nutrition_data($product_ref)"
>has_category_that_should_have_prepared_nutrition_data($product_ref)</a></h2>

<p>Check if the product should have prepared nutrition data,
based on its categories.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$product_ref_-_ref_to_the_product"
>$product_ref - ref to the product</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$category_tag_-_undef_or_category_tag"
>$category_tag - undef or category tag</a></h4>

<p>Return the product category tag that should have prepared nutrition data,
or undef if none.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="check_availability_of_nutrients_needed_for_nutriscore_($product_ref)"
>check_availability_of_nutrients_needed_for_nutriscore ($product_ref)</a></h2>

<p>Check that we know or can estimate the nutrients needed to compute the Nutri-Score of the product.</p>

<p>To compute the Nutri-Score,
we use the nutrition.aggregated_set</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$product_ref_-_ref_to_the_product"
>$product_ref - ref to the product</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$nutrients_available_0_or_1"
>$nutrients_available 0 or 1</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$preparation:_&#34;as_sold&#34;_or_&#34;prepared&#34;"
>$preparation: &#34;as_sold&#34; or &#34;prepared&#34;</a></h4>

<p>Indicates if the Nutri-Score should be computed on as sold or prepared values</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$estimated:_0_or_1"
>$estimated: 0 or 1</a></h4>

<p>Indicates if some of the nutrients needed were estimated</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="set_fields_for_current_version_of_nutriscore($product_ref,_$current_version,_$nutriscore_score,_$nutriscore_grade)"
>set_fields_for_current_version_of_nutriscore($product_ref,
$current_version,
$nutriscore_score,
$nutriscore_grade)</a></h2>

<p>We may compute several versions of the Nutri-Score grade and score.
One version is considered &#34;current&#34;.
This function sets the product fields for the current version.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="set_fields_comparing_nutriscore_versions($product_ref,_$version1,_$version2)"
>set_fields_comparing_nutriscore_versions($product_ref,
$version1,
$version2)</a></h2>

<p>When we are migrating from one version of the Nutri-Score to another (e.g.
2021 vs 2023),
we may compute both version for a time.
This function sets temporary fields to ease the comparison of both versions.</p>

<p>Once the migration is complete,
those fields will no longer be computed.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_nutriscore(_$product_ref,_$current_version_=_&#34;2023&#34;_)"
>compute_nutriscore( $product_ref,
$current_version = &#34;2023&#34; )</a></h2>

<p>Determines if we have enough data to compute the Nutri-Score (category + nutrition facts),
and if the Nutri-Score is applicable to the product the category.</p>

<p>Populates the data structure needed to compute the Nutri-Score and computes it.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_nutrient_levels_($product_ref)"
>compute_nutrient_levels ($product_ref)</a></h2>

<p>Computes nutrient levels (low,
moderate,
high) for fat,
saturated fat,
sugars,
salt/sodium and alcohol.
The nutrient levels are also known as nutrition traffic lights.</p>

<p>We use the aggregated set to compute the levels.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="create_nutrients_level_taxonomy_()"
>create_nutrients_level_taxonomy ()</a></h2>

<p><code>create_nutrients_level_taxonomy()</code> creates the source file for the nutrients level taxonomy: /taxonomies/nutrient_levels.txt</p>

<p>It creates entries such as &#34;High in saturated fat&#34; in all languages.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_units_of_alcohol_($product_ref,_$serving_size_in_ml)"
>compute_units_of_alcohol ($product_ref,
$serving_size_in_ml)</a></h2>

<p>calculate the number of units of alcohol in one serving of an alcoholic beverage.
(https://en.wikipedia.org/wiki/Unit_of_alcohol)</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compare_nutrients_($a_ref,_$b_ref)"
>compare_nutrients ($a_ref,
$b_ref)</a></h2>

<p>For each comparable nutrient in both $a_ref and $b_ref,
compute what percent the $a_ref value differs from the $b_ref value</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$a_ref_-_ref_to_a_product,_a_category,_ajr_etc."
>$a_ref - ref to a product,
a category,
ajr etc.</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$b_ref_-_ref_to_a_structure_with_nutrient_values_to_compare_to"
>$b_ref - ref to a structure with nutrient values to compare to</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'

>$nutrients_ref - ref to a hash with the nutrient values from $b_ref and the percent difference between $a_ref and $b_ref values</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="assign_categories_properties_to_product_(_PRODUCT_REF_)"
>assign_categories_properties_to_product ( PRODUCT_REF )</a></h2>

<p>Go through the categories of a product to apply category properties at the product level.
The most specific categories are checked first.
If the category has a value for the property,
it is assigned to the product and the processing stop.</p>

<p>This function was first designed to assign a CIQUAL category to products,
based on the mapping of the Open Food Facts categories to the French CIQUAL categories.</p>

<p>It may be used for other properties in the future.</p>

<p>agribalyse_food_code:en:42501 agribalyse_proxy_food_code:en:43244</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_nutrient_unit_(_$nid,_$cc_)"
>get_nutrient_unit ( $nid,
$cc )</a></h2>

<p>Returns the unit of the nutrient.</p>

<p>We may have a unit specific to the country (e.g.
US nutrition facts table using the International Unit for this nutrient,
and Europe using mg)</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
