<html><head><title>ProductOpener::Nutriscore</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="simple.min" type="text/css" href="../simple.min.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.43,
  using Pod::Simple::PullParser v3.43,
  under Perl v5.038002 at Wed Aug 20 15:09:13 2025 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#compute_nutriscore_score_and_grade_2021(_%24nutriscore_data_ref_)'>compute_nutriscore_score_and_grade_2021( $nutriscore_data_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments%3A_%24nutriscore_data_ref'>Arguments: $nutriscore_data_ref</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Input_keys%3A_data_to_compute_Nutri-Score'>Input keys: data to compute Nutri-Score</a>
        <li class='indexItem indexItem4'><a href='#Output_keys%3A_details_of_the_Nutri-Score_computation'>Output keys: details of the Nutri-Score computation</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#get_value_with_one_less_negative_point_2021_(_%24nutriscore_data_ref%2C_%24nutrient_)'>get_value_with_one_less_negative_point_2021 ( $nutriscore_data_ref, $nutrient )</a>
    <li class='indexItem indexItem2'><a href='#get_value_with_one_more_positive_point_2021_(_%24nutriscore_data_ref%2C_%24nutrient_)'>get_value_with_one_more_positive_point_2021 ( $nutriscore_data_ref, $nutrient )</a>
    <li class='indexItem indexItem2'><a href='#compute_nutriscore_score_and_grade_2023(_%24nutriscore_data_ref_)'>compute_nutriscore_score_and_grade_2023( $nutriscore_data_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments%3A_%24nutriscore_data_ref'>Arguments: $nutriscore_data_ref</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Input_keys%3A_data_to_compute_Nutri-Score'>Input keys: data to compute Nutri-Score</a>
        <li class='indexItem indexItem4'><a href='#Output_keys%3A_details_of_the_Nutri-Score_computation'>Output keys: details of the Nutri-Score computation</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#get_value_with_one_less_negative_point_2023_(%24is_beverage%2C_%24nutrient%2C_%24current_value)'>get_value_with_one_less_negative_point_2023 ($is_beverage, $nutrient, $current_value)</a>
    <li class='indexItem indexItem2'><a href='#get_value_with_one_more_positive_point_2023_(%24is_beverage%2C_%24nutrient%2C_%24current_value)'>get_value_with_one_more_positive_point_2023 ($is_beverage, $nutrient, $current_value)</a>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>ProductOpener::Nutriscore - compute the Nutriscore grade of a food product</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p><code>ProductOpener::Nutriscore</code> is used to compute the Nutriscore score and grade of a food product.</p>

<pre>    use ProductOpener::Nutriscore qw/:all/;

        my $nutriscore_data_ref = {
                # Nutrients
                energy =&#62;  518, # in kJ
                sugars =&#62; 3,
                saturated_fat =&#62; 0.7,
                saturated_fat_ratio =&#62; 0.7 / 3 * 100,
                sodium =&#62; 0.61 / 2.5 * 1000,    # in mg, sodium = salt divided by 2.5
                fruits_vegetables_nuts_colza_walnut_olive_oils =&#62; 20,   # in %
                fiber =&#62; 2.2,
                proteins =&#62; 6.7,

                # The Nutri-Score computation is different for beverages, waters, cheeses and fats
                is_beverage =&#62; 1,
                is_water =&#62; 0,
                is_cheese =&#62; 0,
                is_fat =&#62; 1, # for 2021 version
                is_fat_oil_nuts_seed =&#62; 1, # for 2023 version
        };

        my ($nutriscore_score, $nutriscore_grade) = compute_nutriscore_score_and_grade(
                $nutriscore_data_ref
        );

        print &#34;Rounded value for sugars: &#34; . $nutriscore_data_ref-&#62;{sugars_value} . &#34;\n&#34;;
        print &#34;Points for sugars: &#34; . $nutriscore_data_ref-&#62;{sugars_points}. &#34;\n&#34;;</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The modules implements the Nutri-Score computation as defined by Sant&#233; publique France.</p>

<p>Input values for nutrients are rounded according to the Nutri-Score definition and added to the hash passed in parameter with the corresponding amount of positive or negative points.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<p>Note: a significantly different Nutri-Score algorithm has been published in 2022 and 2023 (respectively for foods and beverages).</p>

<p>The functions related to the previous algorithm are suffixed with _2021, and functions for the new algorithm are suffixed with _2023.</p>

<p>We will keep both algorithms for a transition period, and we will be able to remove the 2021 algorithm and related functions after.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_nutriscore_score_and_grade_2021(_$nutriscore_data_ref_)"
>compute_nutriscore_score_and_grade_2021( $nutriscore_data_ref )</a></h2>

<p>Computes the Nutri-Score score and grade of a food product, and also returns the details of the points for each nutrient.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments:_$nutriscore_data_ref"
>Arguments: $nutriscore_data_ref</a></h3>

<p>Hash reference used for both input and output:</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Input_keys:_data_to_compute_Nutri-Score"
>Input keys: data to compute Nutri-Score</a></h4>

<p>The hash must contain values for the following keys:</p>

<p>- energy -&#62; energy in kJ / 100g or 100ml - sugars -&#62; sugars in g / 100g or 100ml - saturated_fat -&#62; saturated fats in g / 100g or 100ml - saturated_fat_ratio -&#62; saturated fat divided by fat * 100 (in %) - sodium -&#62; sodium in mg / 100g or 100ml (if sodium is computed from salt, it needs to use a sodium = salt / 2.5 conversion factor) - fruits_vegetables_nuts_colza_walnut_olive_oils -&#62; % of fruits, vegetables, nuts, and colza / walnut / olive oils - fiber -&#62; fiber in g / 100g or 100ml - proteins -&#62; proteins in g / 100g or 100ml</p>

<p>The values will be rounded according to the Nutri-Score rules, they do not need to be rounded before being passed as arguments.</p>

<p>If the product is a beverage, water, cheese, or fat, it must contain a positive value for the corresponding keys: - is_beverage - is_water - is_cheese - is_fat</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Output_keys:_details_of_the_Nutri-Score_computation"
>Output keys: details of the Nutri-Score computation</a></h4>

<p>Returned values:</p>

<p>- [nutrient]_value -&#62; rounded values for each nutrient according to the Nutri-Score rules - [nutrient]_points -&#62; points for each nutrient - negative_points -&#62; sum of negative nutrients points - positive_points -&#62; sum of positive nutrients points</p>

<p>The nutrients that are counted for the negative and positive points depend on the product type (if it is a beverage, cheese or fat) and on the values for some of the nutrients.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>The function returns a list of 2 values:</p>

<p>- Nutri-Score score from -15 to 40 - Corresponding Nutri-Score letter grade from a to e (in lowercase)</p>

<p>The letter grade depends on the score and on whether the product is a beverage, or is a water.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_value_with_one_less_negative_point_2021_(_$nutriscore_data_ref,_$nutrient_)"
>get_value_with_one_less_negative_point_2021 ( $nutriscore_data_ref, $nutrient )</a></h2>

<p>For a given Nutri-Score nutrient value, return the highest smaller value that would result in less negative points. e.g. for a sugars value of 15 (which gives 3 points), return 13.5 (which gives 2 points).</p>

<p>The value corresponds to the highest smaller threshold.</p>

<p>Return undef is the input nutrient value already gives the minimum amount of points (0).</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_value_with_one_more_positive_point_2021_(_$nutriscore_data_ref,_$nutrient_)"
>get_value_with_one_more_positive_point_2021 ( $nutriscore_data_ref, $nutrient )</a></h2>

<p>For a given Nutri-Score nutrient value, return the smallest higher value that would result in more positive points. e.g. for a proteins value of 2.0 (which gives 1 point), return 3.3 (which gives 2 points)</p>

<p>The value corresponds to the smallest higher threshold + 1 increment so that it strictly greater than the threshold.</p>

<p>Return undef is the input nutrient value already gives the maximum amount of points.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_nutriscore_score_and_grade_2023(_$nutriscore_data_ref_)"
>compute_nutriscore_score_and_grade_2023( $nutriscore_data_ref )</a></h2>

<p>Computes the Nutri-Score score and grade of a food product, and also returns the details of the points for each nutrient.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments:_$nutriscore_data_ref"
>Arguments: $nutriscore_data_ref</a></h3>

<p>Hash reference used for both input and output:</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Input_keys:_data_to_compute_Nutri-Score"
>Input keys: data to compute Nutri-Score</a></h4>

<p>The hash must contain values for the following keys:</p>

<p>- energy -&#62; energy in kJ / 100g or 100ml - sugars -&#62; sugars in g / 100g or 100ml - saturated_fat -&#62; saturated fats in g / 100g or 100ml - saturated_fat_ratio -&#62; saturated fat divided by fat * 100 (in %) - salt -&#62; ??? - sodium -&#62; sodium in mg / 100g or 100ml (if sodium is computed from salt, it needs to use a sodium = salt / 2.5 conversion factor - fruits_vegetables_legumes -&#62; % of fruits, vegetables, nuts, and colza / walnut / olive oils - fiber -&#62; fiber in g / 100g or 100ml - proteins -&#62; proteins in g / 100g or 100ml</p>

<p>The values will be rounded according to the Nutri-Score rules, they do not need to be rounded before being passed as arguments.</p>

<p>If the product is a beverage, water, cheese, or fat, it must contain a positive value for the corresponding keys: - is_beverage - is_water - is_cheese - is_fat_oil_nuts_seeds - is_red_meat_product</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Output_keys:_details_of_the_Nutri-Score_computation"
>Output keys: details of the Nutri-Score computation</a></h4>

<p>Returned values:</p>

<p>- [nutrient]_value -&#62; rounded values for each nutrient according to the Nutri-Score rules - [nutrient]_points -&#62; points for each nutrient - [nutrient]_points_max -&#62; maximum number of points that can be allocated for each specific nutrient - negative_nutrients -&#62; list of nutrients that are counted in negative points - negative_points -&#62; sum of negative nutrients points - positive_nutrients -&#62; list of nutrients that are counted in positive points - positive_points -&#62; sum of positive nutrients points - count_proteins -&#62; indicates if proteins are counted in the positive points - count_proteins_reason -&#62; indicates why proteins are counted</p>

<p>The nutrients that are counted for the negative and positive points depend on the product type (if it is a beverage, cheese or fat) and on the values for some of the nutrients.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>The function returns a list of 2 values:</p>

<p>- Nutri-Score score from -15 to 40 - Corresponding Nutri-Score letter grade from a to e (in lowercase)</p>

<p>The letter grade depends on the score and on whether the product is a beverage, or is a water.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_value_with_one_less_negative_point_2023_($is_beverage,_$nutrient,_$current_value)"
>get_value_with_one_less_negative_point_2023 ($is_beverage, $nutrient, $current_value)</a></h2>

<p>For a given Nutri-Score nutrient value, return the highest smaller value that would result in less negative points. e.g. for a sugars value of 15 (which gives 3 points), return 13.5 (which gives 2 points).</p>

<p>The value corresponds to the highest smaller threshold.</p>

<p>Return undef if the input nutrient value already gives the minimum amount of points (0).</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_value_with_one_more_positive_point_2023_($is_beverage,_$nutrient,_$current_value)"
>get_value_with_one_more_positive_point_2023 ($is_beverage, $nutrient, $current_value)</a></h2>

<p>For a given Nutri-Score nutrient value, return the smallest higher value that would result in more positive points. e.g. for a proteins value of 2.0 (which gives 1 point), return 3.3 (which gives 2 points)</p>

<p>The value corresponds to the smallest higher threshold + 1 increment so that it strictly greater than the threshold.</p>

<p>Return undef if the input nutrient value already gives the maximum amount of points.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
