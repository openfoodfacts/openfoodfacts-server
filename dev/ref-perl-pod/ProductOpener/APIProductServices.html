<html><head><title>ProductOpener::APIProductServices</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="simple.min" type="text/css" href="../simple.min.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.43,
  using Pod::Simple::PullParser v3.43,
  under Perl v5.038002 at Wed Aug 20 08:48:04 2025 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#INTERFACE'>INTERFACE</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Request'>Request</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#services'>services</a>
        <li class='indexItem indexItem4'><a href='#product'>product</a>
        <li class='indexItem indexItem4'><a href='#fields'>fields</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Response'>Response</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#add_product_data_from_external_service_(%24request_ref%2C_%24product_ref%2C_%24url%2C_%24services_ref)'>add_product_data_from_external_service ($request_ref, $product_ref, $url, $services_ref)</a>
    <li class='indexItem indexItem2'><a href='#echo_service_(%24product_ref%2C_%24updated_product_fields_ref%2C_%24errors_ref)'>echo_service ($product_ref, $updated_product_fields_ref, $errors_ref)</a>
    <li class='indexItem indexItem2'><a href='#Service_function_handlers'>Service function handlers</a>
    <li class='indexItem indexItem2'><a href='#product_services_api(%24request_ref)'>product_services_api($request_ref)</a>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>ProductOpener::APIProductServices - Microservices to enrich a product object</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This module implements a microservice API for operations done on an product object.</p>

<p>Applications can send product data (for instance a nested list of ingredients),
ask for one or more services to be executed on the input product data (for instance computing the min,
max and estimated percentages of each ingredient),
and get back resulting product data (possibly filtered to get only specific fields back).</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="INTERFACE"
>INTERFACE</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Request"
>Request</a></h3>

<p>The Routing.pm and API.pm module offer an HTTP interface of this form: POST /api/v3/product_services</p>

<p>The POST body is a JSON object with those fields:</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="services"
>services</a></h4>

<p>An array list of services to perform.</p>

<p>Currently implemented services:</p>

<p>- echo : does nothing,
mostly for testing - parse_ingredients_text : parse the ingredients text list and return an ingredients object - extend_ingredients : extend the ingredients object with additional information - estimate_ingredients_percent : compute percent_min,
percent_max,
percent_estimate for each ingredient in the ingredients object - analyze_ingredients : analyze the ingredients object and return a summary object - estimate_environmental_cost_ingredients : estimate the environmental cost of a given product (see Ecobalyse)</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product"
>product</a></h4>

<p>A product object</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="fields"
>fields</a></h4>

<p>An array list of fields to return.
If empty,
only fields that can be created or updated by the service are returned.
e.g.
a service to parse the ingredients text list will return the &#34;ingredients&#34; object.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Response"
>Response</a></h3>

<p>The response is in the JSON API v3 response format,
with a resulting product object.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="add_product_data_from_external_service_($request_ref,_$product_ref,_$url,_$services_ref)"
>add_product_data_from_external_service ($request_ref,
$product_ref,
$url,
$services_ref)</a></h2>

<p>Make a request to execute services on product on an external server using the product services API.</p>

<p>The resulting fields are added to the product object.</p>

<p>e.g.
this function is used to run the percent estimation service on the recipe-estimator server.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="echo_service_($product_ref,_$updated_product_fields_ref,_$errors_ref)"
>echo_service ($product_ref,
$updated_product_fields_ref,
$errors_ref)</a></h2>

<p>Echo service that returns the input product unchanged.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Service_function_handlers"
>Service function handlers</a></h2>

<p>They will be called with the input product object,
a reference to the updated fields hash,
and a reference to the errors array.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="product_services_api($request_ref)"
>product_services_api($request_ref)</a></h2>

<p>Process API v3 product services requests.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
