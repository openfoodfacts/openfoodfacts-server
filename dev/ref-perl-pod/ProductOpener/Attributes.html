<html><head><title>ProductOpener::Attributes</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="simple.min" type="text/css" href="../simple.min.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.43,
  using Pod::Simple::PullParser v3.43,
  under Perl v5.038002 at Sun Oct  5 14:13:37 2025 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#CONFIGURATION'>CONFIGURATION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Attribute_groups_and_attributes'>Attribute groups and attributes</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#list_attributes_(_%24target_lc_)'>list_attributes ( $target_lc )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#attribute_groups_reference_%24attribute_groups_ref'>attribute groups reference $attribute_groups_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Caching'>Caching</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#initialize_attribute_group_(_%24group_id%2C_%24target_lc_)'>initialize_attribute_group ( $group_id, $target_lc )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#attribute_group_id_%24group_id'>attribute group id $group_id</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
      <li class='indexItem indexItem3'><a href='#Initialized_fields'>Initialized fields</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#initialize_attribute_(_%24attribute_id%2C_%24target_lc_)'>initialize_attribute ( $attribute_id, $target_lc )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#attribute_id_%24attribute_id'>attribute id $attribute_id</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
      <li class='indexItem indexItem3'><a href='#Initialized_fields'>Initialized fields</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#override_general_value_(_%24attribute_ref%2C_%24field%2C_%24stringid_)'>override_general_value ( $attribute_ref, $field, $stringid )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#attribute_reference_%24attribute_ref'>attribute reference $attribute_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
        <li class='indexItem indexItem4'><a href='#field_%24field'>field $field</a>
        <li class='indexItem indexItem4'><a href='#string_id_%24string'>string id $string</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#compute_attribute_nutriscore_(_%24product_ref%2C_%24target_lc%2C_%24target_cc_)'>compute_attribute_nutriscore ( $product_ref, $target_lc, $target_cc )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#product_reference_%24product_ref'>product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
        <li class='indexItem indexItem4'><a href='#country_code_%24target_cc'>country code $target_cc</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%25_Match'>% Match</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#compute_attribute_environmental_score_(_%24product_ref%2C_%24target_lc%2C_%24target_cc_)'>compute_attribute_environmental_score ( $product_ref, $target_lc, $target_cc )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#product_reference_%24product_ref'>product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
        <li class='indexItem indexItem4'><a href='#country_code_%24target_cc'>country code $target_cc</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%25_Match'>% Match</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#compute_attribute_forest_footprint_(_%24product_ref%2C_%24target_lc_)'>compute_attribute_forest_footprint ( $product_ref, $target_lc )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#product_reference_%24product_ref'>product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%25_Match'>% Match</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#compute_attribute_nova_(_%24product_ref%2C_%24target_lc_)'>compute_attribute_nova ( $product_ref, $target_lc )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#product_reference_%24product_ref'>product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%25_Match'>% Match</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#compute_attribute_additives_(_%24product_ref%2C_%24target_lc_)'>compute_attribute_additives ( $product_ref, $target_lc )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#product_reference_%24product_ref'>product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%25_Match'>% Match</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#compute_attribute_has_tag_(_%24product_ref%2C_%24target_lc%2C_%24tagtype%2C_%24tagid_)'>compute_attribute_has_tag ( $product_ref, $target_lc, $tagtype, $tagid )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#product_reference_%24product_ref'>product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
        <li class='indexItem indexItem4'><a href='#tag_type_%24tagtype'>tag type $tagtype</a>
        <li class='indexItem indexItem4'><a href='#tag_id_%24tagid'>tag id $tagid</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%25_Match'>% Match</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#compute_attribute_nutrient_level(%24product_ref%2C_%24target_lc%2C_%24level%2C_%24nid)%3B'>compute_attribute_nutrient_level($product_ref, $target_lc, $level, $nid);</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#product_reference_%24product_ref'>product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
        <li class='indexItem indexItem4'><a href='#level_%24level'>level $level</a>
        <li class='indexItem indexItem4'><a href='#nutrient_id_%24nid'>nutrient id $nid</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%25_Match'>% Match</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#compute_attribute_allergen(%24product_ref%2C_%24target_lc%2C_%24allergen_id)%3B'>compute_attribute_allergen($product_ref, $target_lc, $allergen_id);</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#product_reference_%24product_ref'>product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
        <li class='indexItem indexItem4'><a href='#attribute_allergen_id_%24attribute_allergen_id'>attribute_allergen_id $attribute_allergen_id</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%25_Match'>% Match</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#compute_attribute_ingredients_analysis(%24product_ref%2C_%24target_lc%2C_%24analysis)%3B'>compute_attribute_ingredients_analysis($product_ref, $target_lc, $analysis);</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#product_reference_%24product_ref'>product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
        <li class='indexItem indexItem4'><a href='#analysis_%24analysis'>analysis $analysis</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%25_Match'>% Match</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#add_attribute_to_group_(_%24product_ref%2C_%24target_lc%2C_%24group_id%2C_%24attribute_ref_)'>add_attribute_to_group ( $product_ref, $target_lc, $group_id, $attribute_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#product_reference_%24product_ref'>product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
        <li class='indexItem indexItem4'><a href='#group_id_%24group_id'>group id $group_id</a>
        <li class='indexItem indexItem4'><a href='#attribute_reference_%24attribute_ref'>attribute reference $attribute_ref</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#compute_attributes_(_%24product_ref%2C_%24target_lc%2C_%24target_cc%2C_%24options_ref_)'>compute_attributes ( $product_ref, $target_lc, $target_cc, $options_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#product_reference_%24product_ref'>product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc_(or_%22data%22)'>language code $target_lc (or &#34;data&#34;)</a>
        <li class='indexItem indexItem4'><a href='#country_code_%24target_cc'>country code $target_cc</a>
        <li class='indexItem indexItem4'><a href='#options_%24options_ref'>options $options_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#compute_attribute_repairability_index_france_(_%24product_ref%2C_%24target_lc%2C_%24target_cc_)'>compute_attribute_repairability_index_france ( $product_ref, $target_lc, $target_cc )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#product_reference_%24product_ref'>product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
        <li class='indexItem indexItem4'><a href='#country_code_%24target_cc'>country code $target_cc</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%25_Match'>% Match</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#compute_attribute_unwanted_ingredients(%24product_ref%2C_%24target_lc%2C_%24unwanted_ingredients_ref)'>compute_attribute_unwanted_ingredients($product_ref, $target_lc, $unwanted_ingredients_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#product_reference_%24product_ref'>product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
        <li class='indexItem indexItem4'><a href='#unwanted_ingredients_array_reference_%24unwanted_ingredients_ref'>unwanted ingredients array reference $unwanted_ingredients_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%25_Match'>% Match</a>
      </ul>
    </ul>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>ProductOpener::Attributes - Generate product attributes that can be requested through the API</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p>Apps can request through the API product attributes that are returned in the same structured format for all attributes.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>See https://wiki.openfoodfacts.org/Product_Attributes</p>

<p>If new attributes are added,
make sure *to update the list of fields* fetched from MongoDB in Display.pm (in search_and_display_products subroutine).</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CONFIGURATION"
>CONFIGURATION</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Attribute_groups_and_attributes"
>Attribute groups and attributes</a></h2>

<p>The list of attribute groups ids and the attribute ids they contained is defined in the Config.pm file</p>

<p>e.g.</p>

<p>$options{attribute_groups} = [ [ &#34;nutritional_quality&#34;,
[&#34;nutriscore&#34;] ],
[ &#34;processing&#34;,
[&#34;nova&#34;,&#34;additives&#34;] ],
[..]</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="list_attributes_(_$target_lc_)"
>list_attributes ( $target_lc )</a></h2>

<p>List all available attribute groups and attributes,
with strings (names,
descriptions etc.) in a specific language,
and return them in an array of attribute groups.</p>

<p>This is used in particular for clients of the API to know which preferences they can ask users for,
and then use for personalized filtering and ranking.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="attribute_groups_reference_$attribute_groups_ref"
>attribute groups reference $attribute_groups_ref</a></h4>

<p>The return value is a reference to an array of attribute groups that contains individual attributes.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Caching"
>Caching</a></h3>

<p>The return value is cached for each language in the %localized_attribute_groups hash.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="initialize_attribute_group_(_$group_id,_$target_lc_)"
>initialize_attribute_group ( $group_id,
$target_lc )</a></h2>

<p>Create a new attribute group and initialize some fields (e.g.
strings like description,
description_short etc.)</p>

<p>The initialization values for the fields are not dependent on a specific product.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="attribute_group_id_$group_id"
>attribute group id $group_id</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<p>If $target_lc is equal to &#34;data&#34;,
no strings are returned.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>A reference to the created attribute group object.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Initialized_fields"
>Initialized fields</a></h3>

<p>- Name - e.g.
&#34;Allergens&#34; - Warning - Short description - Description</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="initialize_attribute_(_$attribute_id,_$target_lc_)"
>initialize_attribute ( $attribute_id,
$target_lc )</a></h2>

<p>Create a new attribute and initialize attributes fields (e.g.
strings like description,
description_short etc.) for a specific attribute if the corresponding values are defined in the .po translation files.</p>

<p>The initialization values for the fields are not dependent on a specific product.</p>

<p>Some of them may be overridden later (e.g.
the title and description) based on how the attribute matches for the specific product.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="attribute_id_$attribute_id"
>attribute id $attribute_id</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<p>If $target_lc is equal to &#34;data&#34;,
no strings are returned.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>A reference to the created attribute object.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Initialized_fields"
>Initialized fields</a></h3>

<p>- name: e.g.
&#34;Nutri-Score&#34; - setting_name: e.g.
&#34;Good nutritional quality (Nutri-Score)&#34; - icon_url - panel_id: Linked knowledge panel (optional)</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="override_general_value_(_$attribute_ref,_$field,_$stringid_)"
>override_general_value ( $attribute_ref,
$field,
$stringid )</a></h2>

<p>Attributes fields (e.g.
strings like description,
description_short etc.) can be defined in the .po translation files for a given attribute regardless of the attribute value,
or can be specific to a particular value.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="attribute_reference_$attribute_ref"
>attribute reference $attribute_ref</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="field_$field"
>field $field</a></h4>

<p>e.g.
description,
description_short</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="string_id_$string"
>string id $string</a></h4>

<p>String id from the msgctxt field in the .po files e.g.
&#34;attribute_labels_fair_trade_yes_description_short&#34;</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_attribute_nutriscore_(_$product_ref,_$target_lc,_$target_cc_)"
>compute_attribute_nutriscore ( $product_ref,
$target_lc,
$target_cc )</a></h2>

<p>Computes a nutritional quality attribute based on the Nutri-Score.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_reference_$product_ref"
>product reference $product_ref</a></h4>

<p>#11872 Find and replace Storable with JSON</p>

<p>Loaded from the MongoDB database,
Storable files,
or the OFF API.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="country_code_$target_cc"
>country code $target_cc</a></h4>

<p>Different countries can have different versions of the Nutri-Score at a given time.
e.g.
in early 2024,
France did not use the new Nutri-Score 2023 yet,
while other countries did.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>The return value is a reference to the resulting attribute data structure.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="%_Match"
>% Match</a></h4>

<p>To differentiate products more finely,
the match is based on the Nutri-Score score that is used to define the Nutri-Score grade from A to E.</p>

<p>- Nutri-Score A: 80 to 100% - Nutri-Score B: 61 to 80%</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_attribute_environmental_score_(_$product_ref,_$target_lc,_$target_cc_)"
>compute_attribute_environmental_score ( $product_ref,
$target_lc,
$target_cc )</a></h2>

<p>Computes an environmental impact attribute based on the Environmental-Score.</p>

<p>Note: before 2025,
the Environmental-Score was called the Eco-Score,
as the id of the attribute is stored inside clients,
we keep the id &#34;ecoscore&#34; for the attribute.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_reference_$product_ref"
>product reference $product_ref</a></h4>

<p>Loaded from the MongoDB database,
Storable files,
or the OFF API.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="country_code_$target_cc"
>country code $target_cc</a></h4>

<p>The Environmental-Score depends on the country of the consumer (as the transport bonus/malus depends on it)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>The return value is a reference to the resulting attribute data structure.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="%_Match"
>% Match</a></h4>

<p>To differentiate products more finely,
the match is based on the Environmental-Score score that is used to define the Environmental-Score grade from A+ to F.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_attribute_forest_footprint_(_$product_ref,_$target_lc_)"
>compute_attribute_forest_footprint ( $product_ref,
$target_lc )</a></h2>

<p>Computes an environmental impact attribute based on the Forest Footprint.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_reference_$product_ref"
>product reference $product_ref</a></h4>

<p>Loaded from the MongoDB database,
Storable files,
or the OFF API.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>The return value is a reference to the resulting attribute data structure.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="%_Match"
>% Match</a></h4>

<p>The match is based on the forest footprint that is used to define the forest footprint grade from A to E.</p>

<p>- Forest footprint A: &#60; 0.5 m&#178; / kg of food - Forest footprint B: &#60; 1 m&#178; / kg of food - Forest footprint C: &#60; 1.5 m&#178; / kg of food - Forest footprint D: &#60; 2 m&#178; / kg of food - Forest footprint E: &#62;= 2 m&#178; / kg of food</p>

<p>If the forest footprint is not computed,
we mark it as non-computed and make the match 100%.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_attribute_nova_(_$product_ref,_$target_lc_)"
>compute_attribute_nova ( $product_ref,
$target_lc )</a></h2>

<p>Computes a processing attribute based on the Nova group.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_reference_$product_ref"
>product reference $product_ref</a></h4>

<p>Loaded from the MongoDB database,
Storable files,
or the OFF API.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>The return value is a reference to the resulting attribute data structure.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="%_Match"
>% Match</a></h4>

<p>- NOVA 1: 100% - NOVA 2: 100% - NOVA 3: 75% - NOVA 4: 0%</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_attribute_additives_(_$product_ref,_$target_lc_)"
>compute_attribute_additives ( $product_ref,
$target_lc )</a></h2>

<p>Computes a processing attribute based on the number of additives.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_reference_$product_ref"
>product reference $product_ref</a></h4>

<p>Loaded from the MongoDB database,
Storable files,
or the OFF API.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>The return value is a reference to the resulting attribute data structure.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="%_Match"
>% Match</a></h4>

<p>- 0 additive: 100% - 1 to 4 additives: 80% to 20% - 5 or more additives: 0%</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_attribute_has_tag_(_$product_ref,_$target_lc,_$tagtype,_$tagid_)"
>compute_attribute_has_tag ( $product_ref,
$target_lc,
$tagtype,
$tagid )</a></h2>

<p>Checks if the product has a specific tag (e.g.
a label)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_reference_$product_ref"
>product reference $product_ref</a></h4>

<p>Loaded from the MongoDB database,
Storable files,
or the OFF API.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="tag_type_$tagtype"
>tag type $tagtype</a></h4>

<p>e.g.
labels,
categories,
origins</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="tag_id_$tagid"
>tag id $tagid</a></h4>

<p>e.g.
en:organic</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>The return value is a reference to the resulting attribute data structure.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="%_Match"
>% Match</a></h4>

<p>- 100% if the product has the requested tag - 0% if the product does not have the requested tag</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_attribute_nutrient_level($product_ref,_$target_lc,_$level,_$nid);"
>compute_attribute_nutrient_level($product_ref,
$target_lc,
$level,
$nid);</a></h2>

<p>Checks if the product has a nutrient in a low or high quantity.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_reference_$product_ref"
>product reference $product_ref</a></h4>

<p>Loaded from the MongoDB database,
Storable files,
or the OFF API.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="level_$level"
>level $level</a></h4>

<p>&#34;low&#34; or &#34;high&#34;</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="nutrient_id_$nid"
>nutrient id $nid</a></h4>

<p>e.g.
&#34;salt&#34;,
&#34;sugars&#34;,
&#34;fat&#34;,
&#34;saturated-fat&#34;</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>The return value is a reference to the resulting attribute data structure.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="%_Match"
>% Match</a></h4>

<p>For &#34;low&#34; levels:</p>

<p>- 100% if the nutrient quantity is 0% - 80% if the nutrient quantity is the upper threshold for the low traffic light - 20% if the nutrient quantity is the lower threshold for the high traffic light - 0% if the nutrient quantity is twice the lower threshold for the high traffic light</p>

<p>Traffic lights levels are defined in Food.pm:</p>

<p>@nutrient_levels = ( [&#39;fat&#39;,
3,
20 ],
[&#39;saturated-fat&#39;,
1.5,
5],
[&#39;sugars&#39;,
5,
12.5],
[&#39;salt&#39;,
0.3,
1.5],
);</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_attribute_allergen($product_ref,_$target_lc,_$allergen_id);"
>compute_attribute_allergen($product_ref,
$target_lc,
$allergen_id);</a></h2>

<p>Checks if the product contains or may contain traces of an allergen.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_reference_$product_ref"
>product reference $product_ref</a></h4>

<p>Loaded from the MongoDB database,
Storable files,
or the OFF API.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="attribute_allergen_id_$attribute_allergen_id"
>attribute_allergen_id $attribute_allergen_id</a></h4>

<p>&#34;en:gluten&#34;,
&#34;en:sulphur-dioxide-and-sulphites&#34; : allergen ids from the allergens taxonomy</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>The return value is a reference to the resulting attribute data structure.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="%_Match"
>% Match</a></h4>

<p>100: no indication of the allergen or trace of the allergen 20: may contain the allergen as a trace 0: contains allergen</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_attribute_ingredients_analysis($product_ref,_$target_lc,_$analysis);"
>compute_attribute_ingredients_analysis($product_ref,
$target_lc,
$analysis);</a></h2>

<p>Checks properties derived from ingredients analysis (e.g.
vegetarian,
vegan,
palm oil free)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_reference_$product_ref"
>product reference $product_ref</a></h4>

<p>Loaded from the MongoDB database,
Storable files,
or the OFF API.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="analysis_$analysis"
>analysis $analysis</a></h4>

<p>There are currently 2 types of ingredients analysis:</p>

<p>- if $analysis contains &#34;-free&#34; at the end (e.g.
palm-oil-free),
ingredients_analysis_tags contains values like: contains-palm-oil,
may-contain-palm-oil,
palm-oil-free and palm-oil-content-unknown</p>

<p>- otherwise,
for values like vegan and vegetarian,
it contains values like: vegan,
non-vegan,
maybe-vegan,
vegan-status-unknown</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>The return value is a reference to the resulting attribute data structure.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="%_Match"
>% Match</a></h4>

<p>For &#34;low&#34; levels:</p>

<p>- 100% if the property matches - 20% if the property may match - 0% if the property does not match</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="add_attribute_to_group_(_$product_ref,_$target_lc,_$group_id,_$attribute_ref_)"
>add_attribute_to_group ( $product_ref,
$target_lc,
$group_id,
$attribute_ref )</a></h2>

<p>Add an attribute to a given attribute group,
if the attribute is defined.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_reference_$product_ref"
>product reference $product_ref</a></h4>

<p>Loaded from the MongoDB database,
Storable files,
or the OFF API.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="group_id_$group_id"
>group id $group_id</a></h4>

<p>e.g.
nutritional_quality,
allergens,
labels</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="attribute_reference_$attribute_ref"
>attribute reference $attribute_ref</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_attributes_(_$product_ref,_$target_lc,_$target_cc,_$options_ref_)"
>compute_attributes ( $product_ref,
$target_lc,
$target_cc,
$options_ref )</a></h2>

<p>Compute all attributes for a product,
with strings (descriptions,
recommendations etc.) in a specific language,
and return them in an array of attribute groups.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_reference_$product_ref"
>product reference $product_ref</a></h4>

<p>Loaded from the MongoDB database,
Storable files,
or the OFF API.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc_(or_&#34;data&#34;)"
>language code $target_lc (or &#34;data&#34;)</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<p>If $target_lc is equal to &#34;data&#34;,
no strings are returned.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="country_code_$target_cc"
>country code $target_cc</a></h4>

<p>Needed for some country specific attributes like the Environmental-Score.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="options_$options_ref"
>options $options_ref</a></h4>

<p>Defines how some attributes should be computed (or not computed)</p>

<p>- skip_[attribute_id] : do not compute a specific attribute - attribute_unwanted_ingredients_tags : a comma separated list of unwanted ingredients (e.g.
&#34;palm oil,
titanium dioxide&#34;) to compute the unwanted ingredients attribute</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Attributes are returned in the &#34;attribute_groups_[$target_lc]&#34; array of the product reference passed as input.</p>

<p>The array contains attribute groups,
and each attribute group contains individual attributes.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_attribute_repairability_index_france_(_$product_ref,_$target_lc,_$target_cc_)"
>compute_attribute_repairability_index_france ( $product_ref,
$target_lc,
$target_cc )</a></h2>

<p>Compute the repairability index attribute for France.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_reference_$product_ref"
>product reference $product_ref</a></h4>

<p>Loaded from the MongoDB database,
Storable files,
or the OFF API.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="country_code_$target_cc"
>country code $target_cc</a></h4>

<p>The repairability index is specific to France.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>The return value is a reference to the resulting attribute data structure.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="%_Match"
>% Match</a></h4>

<p>- 10x the repairability index value (from 0 to 10) - 0% if the product does not have a repairability index value</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compute_attribute_unwanted_ingredients($product_ref,_$target_lc,_$unwanted_ingredients_ref)"
>compute_attribute_unwanted_ingredients($product_ref,
$target_lc,
$unwanted_ingredients_ref)</a></h2>

<p>Checks if the product contains any unwanted ingredients specified by the user.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_reference_$product_ref"
>product reference $product_ref</a></h4>

<p>Loaded from the MongoDB database,
Storable files,
or the OFF API.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="unwanted_ingredients_array_reference_$unwanted_ingredients_ref"
>unwanted ingredients array reference $unwanted_ingredients_ref</a></h4>

<p>Array reference containing ingredient tags to avoid (e.g.
[&#34;en:garlic&#34;,
&#34;en:mango&#34;]).</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>The return value is a reference to the resulting attribute data structure.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="%_Match"
>% Match</a></h4>

<p>- 100: none of the unwanted ingredients are present - 0: at least one unwanted ingredient is present</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
