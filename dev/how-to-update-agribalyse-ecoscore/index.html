
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://openfoodfacts.github.io/openfoodfacts-server/dev/how-to-update-agribalyse-ecoscore/">
      
      
        <link rel="prev" href="../how-to-quick-start-guide/">
      
      
        <link rel="next" href="../how-to-use-direnv/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.41">
    
    
      
        <title>How to update Agribalyse (Ecoscore) - Product Opener (Open Food Facts Server)</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-update-agribalyse-ecoscore" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Product Opener (Open Food Facts Server)" class="md-header__button md-logo" aria-label="Product Opener (Open Food Facts Server)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Product Opener (Open Food Facts Server)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              How to update Agribalyse (Ecoscore)
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/openfoodfacts/openfoodfacts-server" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Product Opener (Open Food Facts Server)" class="md-nav__button md-logo" aria-label="Product Opener (Open Food Facts Server)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Product Opener (Open Food Facts Server)
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/openfoodfacts/openfoodfacts-server" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Product Opener (Open Food Facts web server) documentation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Api
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Api
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to Open Food Facts API documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/intro-robotoff/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to the Robotoff Project
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tutorial-dev-journey/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial dev journey
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tutorial-off-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial on using the Open Food Facts API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tutorial-uploading-photo-to-a-product/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial on uploading images to the Open Food Facts API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/how-to-download-images/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to download product images
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/explain-knowledge-panels/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explanation on Knowledge panels
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/ref-barcode-normalization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference: Barcode Normalization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/ref-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference: API CheatSheet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/ref-v2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference OpenAPI documentation for v2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/ref-v3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference OpenAPI documentation for v3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/aws-images-dataset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Open Food Facts AWS images dataset
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/leveraging-links-to-wikidata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Leveraging links to wikidata
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Dev
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Dev
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to Product Opener developer documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-deploy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to deploy to Prod environment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-develop-producer-platform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to develop on the producers platform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-develop-using-docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to use Docker to Develop - a guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-learn-perl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How can I learn the Perl programming language?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-quick-start-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to setup the Dev environment (quick start guide)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    How to update Agribalyse (Ecoscore)
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    How to update Agribalyse (Ecoscore)
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#obtain-and-convert-the-agribalyse-spreadsheet" class="md-nav__link">
    <span class="md-ellipsis">
      Obtain and Convert the AGRIBALYSE Spreadsheet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#review-and-fix-any-changed-categories" class="md-nav__link">
    <span class="md-ellipsis">
      Review and fix any changed Categories
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#link-existing-categories-to-new-agribalyse-codes" class="md-nav__link">
    <span class="md-ellipsis">
      Link existing Categories to new AGRIBALYSE codes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-new-categories-for-new-agribalyse-codes" class="md-nav__link">
    <span class="md-ellipsis">
      Add new Categories for new AGRIBALYSE codes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-use-direnv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to use direnv
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-use-gitpod/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to use Gitpod for Remote Development
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-use-pages-from-openfoodfacts-web/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to use pages from openfoodfacts-web
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-use-repl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to use Perl REPL (re.pl)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-use-vscode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to use VSCode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-write-and-run-tests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to write and run tests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../explain-nutrition-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explain nutrition data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../explain-packaging-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explanation on packaging data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../explain-personal-search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explain personal search
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../explain-pro-dev-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explanation on Docker Setup of pro platform for development
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../explain-taxonomy-build-cache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explanation on Taxonomy Build Cache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ref-docker-commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference Docker / Makefile commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ref-perl-pod/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Perl reference documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ref-perl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference Perl code documentation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Api tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Api tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api-tutorials/adding-missing-products/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adding missing products
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api-tutorials/comparing-sodas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Comparing sodas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api-tutorials/creating-a-local-cache-of-open-food-facts-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating a local cache of open food facts data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api-tutorials/finding-healthy-cereals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Finding healthy cereals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api-tutorials/folksonomy-engine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Folksonomy engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api-tutorials/get-in-touch-with-openfoodfacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get in touch with openfoodfacts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api-tutorials/get-ingredient-related-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get ingredient related analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api-tutorials/get-the-ecoscore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get the ecoscore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api-tutorials/get-the-nutriscore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get the nutriscore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api-tutorials/how-to-create-data-quality-controls-in-your-app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to create data quality controls in your app
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api-tutorials/license-be-on-the-legal-side/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License be on the legal side
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api-tutorials/product-prices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Product prices
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api-tutorials/reporting-issues-with-nutripatrol/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reporting issues with nutripatrol
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api-tutorials/scanning-cosmetics-pet-food-and-other-products/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scanning cosmetics pet food and other products
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api-tutorials/working-with-facets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Providing knowledge panels for a particular Open Food Facts facet (category, brand, etc...)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#obtain-and-convert-the-agribalyse-spreadsheet" class="md-nav__link">
    <span class="md-ellipsis">
      Obtain and Convert the AGRIBALYSE Spreadsheet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#review-and-fix-any-changed-categories" class="md-nav__link">
    <span class="md-ellipsis">
      Review and fix any changed Categories
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#link-existing-categories-to-new-agribalyse-codes" class="md-nav__link">
    <span class="md-ellipsis">
      Link existing Categories to new AGRIBALYSE codes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#add-new-categories-for-new-agribalyse-codes" class="md-nav__link">
    <span class="md-ellipsis">
      Add new Categories for new AGRIBALYSE codes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="how-to-update-agribalyse-ecoscore">How to update Agribalyse (Ecoscore)<a class="headerlink" href="#how-to-update-agribalyse-ecoscore" title="Permanent link">#</a></h1>
<p>Open Food Facts calculates the Ecoscore of a product from the Categories taxonomy where this has been linked to an AGRIBALYSE food code or proxy.</p>
<p>New versions of the AGRIBALYSE database are released from time to time and this document explains how to apply updates. The high-level steps are as follows:</p>
<h2 id="obtain-and-convert-the-agribalyse-spreadsheet">Obtain and Convert the AGRIBALYSE Spreadsheet<a class="headerlink" href="#obtain-and-convert-the-agribalyse-spreadsheet" title="Permanent link">#</a></h2>
<p>Download the AGRIBALYSE food spreadsheet from the <a href="https://doc.agribalyse.fr/documentation/acces-donnees">AGRIBALYSE</a> web site (use the French site rather than English as updates on the English site may be delayed), and save it as AGRIBALYSE_vf.xlsm" in the ecoscore/agribalyse folder.</p>
<p>In a backend shell run the ssconvert.sh script. This will re-generate the CSV files, including the AGRIBALYSE_version and AGRIBALYSE_summary files. The AGRIBALYSE_summary file is sorted to make for easier comparison with the previous version.</p>
<p>The Ecoscore calculation just uses the data from the "Detail etape" tab, which is converted to AGRIBALYSE_vf.csv.2 by ssconvert. The Ecoscore.pm module skips the first three lines of this file to ignore headers. This should be checked for each update as the number of header lines has previously changed. Also check that none of the column headings have changed.</p>
<h2 id="review-and-fix-any-changed-categories">Review and fix any changed Categories<a class="headerlink" href="#review-and-fix-any-changed-categories" title="Permanent link">#</a></h2>
<p>Review the changes to AGRIBALYSE_summary to determine if any codes have been removed or significantly edited and update the Categories taxonomy accordingly.</p>
<p>Once the Categories have been updated you will need to build the taxonomies. You can then update unit test results with the update_tests_results.sh script to see if any have been affected.</p>
<p>It is also worth checking the impact the update has had on the main product database. This can be downloaded locally and the differences determined by running the update_all_products script.</p>
<p>The previous values of the Ecoscore are stored in the previous_data section under ecoscore_data. Before applying an update you will need to delete this section with the following MongoDB script:</p>
<div class="highlight"><pre><span></span><code><span class="nx">db</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">update</span><span class="p">({},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$unset</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;ecoscore_data.previous_data&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>
<p>You can then use the following script from a backend bash shell to update products:</p>
<div class="highlight"><pre><span></span><code>./update_all_products.pl --fields categories --compute-ecoscore
</code></pre></div>
<p>The process will set the <code>en:ecoscore_grade_changed</code> and <code>en:ecoscore_changed</code> misc_tags, which can be queried to analyse the results. For example, the following script generates a CSV file that summaries all the categories where the grade has changed:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">products</span>
<span class="w">  </span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nx">$match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">misc_tags</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;en:ecoscore-grade-changed&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nx">$group</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">en</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$ecoscore_data.agribalyse.name_en&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">fr</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$ecoscore_data.agribalyse.name_fr&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">code_before</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$ecoscore_data.previous_data.agribalyse.code&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">code_after</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$ecoscore_data.agribalyse.code&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">before</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$ecoscore_data.previous_data.grade&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nx">after</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$ecoscore_data.grade&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$sum</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">])</span>
<span class="w">  </span><span class="p">.</span><span class="nx">toArray</span><span class="p">();</span>
<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;en.Name,fr.Name,Code Before,Code After,Grade Before,Grade After,Count&quot;</span><span class="p">);</span>
<span class="nx">results</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// eslint-disable-next-line no-underscore-dangle</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">_id</span><span class="p">;</span>
<span class="w">  </span><span class="nx">print</span><span class="p">(</span>
<span class="w">    </span><span class="s1">&#39;&quot;&#39;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="p">(</span><span class="nx">id</span><span class="p">.</span><span class="nx">en</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&quot;/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s1">&#39;&quot;,&quot;&#39;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="p">(</span><span class="nx">id</span><span class="p">.</span><span class="nx">fr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&quot;/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s1">&#39;&quot;,&#39;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">id</span><span class="p">.</span><span class="nx">code_before</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">id</span><span class="p">.</span><span class="nx">code_after</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">id</span><span class="p">.</span><span class="nx">before</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">id</span><span class="p">.</span><span class="nx">after</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">result</span><span class="p">.</span><span class="nx">count</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>The following script fetches the specific products that have changed:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">products</span>
<span class="w">  </span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nx">misc_tags</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;en:ecoscore-grade-changed&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecoscore_data.agribalyse.name_en&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecoscore_data.agribalyse.name_fr&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecoscore_data_main.agribalyse.code&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecoscore_data.previous_data.agribalyse.code&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecoscore_data.agribalyse.code&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecoscore_data_main.grade&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecoscore_data.previous_data.grade&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecoscore_data.grade&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecoscore_data_main.score&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecoscore_data.previous_data.score&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecoscore_data.score&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecoscore_data_main.agribalyse.ef_total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecoscore_data.previous_data.agribalyse.ef_total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;ecoscore_data.agribalyse.ef_total&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">      </span><span class="nx">categories_tags</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="nx">toArray</span><span class="p">();</span>

<span class="nx">print</span><span class="p">(</span>
<span class="w">  </span><span class="s2">&quot;_id,en.Name,fr.Name,Code Before Main,Code Before Change,Code After,Grade Before Main,Grade Before Change,Grade After,Score Before Main,Score Before Change,Score After,ef_total Before Main,ef_total Before Change,ef_total After,Categories Tags&quot;</span>
<span class="p">);</span>
<span class="nx">products</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">ecoscore_data_main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">ecoscore_data_main</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{};</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">ecoscore_data_main_agribalyse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ecoscore_data_main</span><span class="p">.</span><span class="nx">agribalyse</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{};</span>
<span class="w">  </span><span class="c1">// eslint-disable-next-line no-underscore-dangle</span>
<span class="w">  </span><span class="nx">print</span><span class="p">(</span>
<span class="w">    </span><span class="nx">result</span><span class="p">.</span><span class="nx">_id</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s1">&#39;,&quot;&#39;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">ecoscore_data</span><span class="p">.</span><span class="nx">agribalyse</span><span class="p">.</span><span class="nx">name_en</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&quot;/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s1">&#39;&quot;,&quot;&#39;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">ecoscore_data</span><span class="p">.</span><span class="nx">agribalyse</span><span class="p">.</span><span class="nx">name_fr</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&quot;/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s1">&#39;&quot;,&#39;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">ecoscore_data_main_agribalyse</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">result</span><span class="p">.</span><span class="nx">ecoscore_data</span><span class="p">.</span><span class="nx">previous_data</span><span class="p">.</span><span class="nx">agribalyse</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">result</span><span class="p">.</span><span class="nx">ecoscore_data</span><span class="p">.</span><span class="nx">agribalyse</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">ecoscore_data_main</span><span class="p">.</span><span class="nx">grade</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">result</span><span class="p">.</span><span class="nx">ecoscore_data</span><span class="p">.</span><span class="nx">previous_data</span><span class="p">.</span><span class="nx">grade</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">result</span><span class="p">.</span><span class="nx">ecoscore_data</span><span class="p">.</span><span class="nx">grade</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">ecoscore_data_main</span><span class="p">.</span><span class="nx">score</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">result</span><span class="p">.</span><span class="nx">ecoscore_data</span><span class="p">.</span><span class="nx">previous_data</span><span class="p">.</span><span class="nx">score</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">result</span><span class="p">.</span><span class="nx">ecoscore_data</span><span class="p">.</span><span class="nx">score</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">ecoscore_data_main_agribalyse</span><span class="p">.</span><span class="nx">ef_total</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">result</span><span class="p">.</span><span class="nx">ecoscore_data</span><span class="p">.</span><span class="nx">previous_data</span><span class="p">.</span><span class="nx">agribalyse</span><span class="p">.</span><span class="nx">ef_total</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s2">&quot;,&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">result</span><span class="p">.</span><span class="nx">ecoscore_data</span><span class="p">.</span><span class="nx">agribalyse</span><span class="p">.</span><span class="nx">ef_total</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s1">&#39;,&quot;&#39;</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="nx">result</span><span class="p">.</span><span class="nx">categories_tags</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">      </span><span class="s1">&#39;&quot;&#39;</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<h2 id="link-existing-categories-to-new-agribalyse-codes">Link existing Categories to new AGRIBALYSE codes<a class="headerlink" href="#link-existing-categories-to-new-agribalyse-codes" title="Permanent link">#</a></h2>
<p>If a new AGRIBALYSE category matches an existing OFF Category then the two can be linked by adding an <code>agribalyse_food_code:en</code> tag. If there is no precise match then add an <code>agribalyse_proxy_food_code:en</code> tag along with the <code>agribalyse_proxy_food_name:en</code> and <code>agribalyse_proxy_food_name:fr</code> tags.</p>
<p>Re-run the <code>update_all_products</code> script after doing this to assess how many products now have an Ecoscore when they did not previously. Use the above scripts to analyse the MongoDB, the new categories will have previous values of <code>undefined</code>.</p>
<h2 id="add-new-categories-for-new-agribalyse-codes">Add new Categories for new AGRIBALYSE codes<a class="headerlink" href="#add-new-categories-for-new-agribalyse-codes" title="Permanent link">#</a></h2>
<p>For any new categories, review the AGRIBALYSE category descriptions to ensure they are concise and unambiguous such that an OFF user is most likely to get a match on a type-ahead search. Give notice of the change on the taxonomies channel in Slack so that additional translations can be added for the new categories.</p>
<p>It is not necessary to add a category for every single AGRIBALYSE entry. For example, AGRIBALYSE has over 80 codes for different mineral waters but these all have almost exactly the same environmental impact. In cases like this it is acceptable to pick a single representative AGRIBALYSE code as a proxy for the Category in general.</p>
<p>It may be worth doing a final check to see how many category combinations still do not have a match in AGRIBALYSE:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">missing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">products</span>
<span class="w">  </span><span class="p">.</span><span class="nx">aggregate</span><span class="p">([</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nx">$match</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s2">&quot;ecoscore_data.grade&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nx">$group</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$categories_tags&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$sum</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">},</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">])</span>
<span class="w">  </span><span class="p">.</span><span class="nx">toArray</span><span class="p">();</span>
<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;Category,Count&quot;</span><span class="p">);</span>
<span class="nx">missing</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// eslint-disable-next-line no-underscore-dangle</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">_id</span><span class="p">;</span>
<span class="w">  </span><span class="nx">print</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">id</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&quot;/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;&quot;,&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>