name: Pull Requests

on:
  pull_request:
    branches: [ main ]

jobs:

  js_checks:
    name: JS lint & build
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: 1
    - uses: actions/setup-node@v3
      with:
        node-version: '12.x'
    - name: gulp build
      run: make front_build
    - name: lint
      run: make front_lint

  test:
    name: Perl unit tests and checks
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: 50
    - name: check perl
      run: make check_perl
    - name: rebuild taxonomies
      run: make build_taxonomies
    - name: test
      run: make test
    - name: test make dev
      run: |
        make dev
        make status
    - name: test all is runing
      run: make livecheck
    - name: test clean
      run: make hdown
