<!-- start templates/[% template.name %] -->
<div class="tag">
    <div class="row">
        <div class="large-12 column">
[% IF not groupby_tagtype.defined %]
    <div class="tag_navigation">
        <a href="[% tagtype_path %]">[% tagtype_name.ucfirst %]</a>
        [% sep %]:
        <a href="[% tagid_path %]">[% tag_name %]</a>

        [% IF tagid2.defined %]
            <br>
            <a href="[% tagtype2_path %]">[% tagtype2_name.ucfirst %]</a>
            [% sep %]:
            <a href="[% tagid2_path %]">[% tag2_name %]</a>
        [% END %]

    </div>

    [% IF tag_logo %]
        <div class="tag_logo">
            [% tag_logo %]
        </div>
    [% END %]

    [% IF canon_url %]
        <div class="share_button right" style="float:right;margin-top:-10px;margin-left:10px;display:none;">
            <a href="[% canon_url %]" class="button small" title="[% title %]">
                [% display_icon('share') %]
                <span class="show-for-large-up"> [% lang('share') %]</span>
            </a>
        </div>
    [% END %]
    
    
    [% IF weblinks %]
        <div class="weblinks">
            [% weblinks %]
        </div>
    [% END %]

    [% IF parents_and_children %]
        <div class="parents_and_children">
            [% parents_and_children %]
        </div>
    [% END %]

    [% IF description %]
        <div class="description">
            [% description %]
        </div>
    [% END %]
    <!-- injecting facet-knowledge-panel -->
    <div id="facet-knowledge-panel">
        <h2 id="title"></h2>
        <P id="facet-panels"></P>
    </div>
[% END %]

[% IF country != 'en:world' %]
    <p>[% lang('countries_s').ucfirst %][% sep %]: [% display_taxonomy_tag("countries", country) %]
        - <a href="[% world_link_url %]">[% world_link %]</a>
    </p>
[% END %]


[% IF products_title %]
    <h2 class="products_title">[% products_title %]</h2>
[% END %]
        </div>
    </div>
</div>
    
</div>

<!-- Fetching facet knowledge panel -->
<script>
    fetch("https://facets-kp.openfoodfacts.net/render-to-html?facet_tag=[% tagtype_name.ucfirst %]&value_tag=[% tag_name %]")
    .then((response) => {
        if (response.ok) {
            return response.text();}
        else {
            throw new Error("NETWORK RESPONSE ERROR");
            
      }
    })
    .then(data => {
        let title = document.getElementById("title");
        title.innerHTML = "Facet knowledge panel";
        let knowledgepanel = document.getElementById("facet-panels");
        knowledgepanel.innerHTML = data;
      
    })
    .catch((error) => console.error("FETCH ERROR:", error));
</script>

<!-- end templates/[% template.name %] -->
