<!-- start templates/[% template.name %] -->
<div class="tag">
    <div class="row">
        <div class="large-12 column">
[% IF not groupby_tagtype.defined %]
    <div class="tag_navigation">
        <a href="[% tagtype_path %]">[% tagtype_name.ucfirst %]</a>
        [% sep %]:
        <a href="[% tagid_path %]">[% tag_name %]</a>

        [% IF tagid2.defined %]
            <br>
            <a href="[% tagtype2_path %]">[% tagtype2_name.ucfirst %]</a>
            [% sep %]:
            <a href="[% tagid2_path %]">[% tag2_name %]</a>
        [% END %]

    </div>

    [% IF tag_logo %]
        <div class="tag_logo">
            [% tag_logo %]
        </div>
    [% END %]

    [% IF canon_url %]
        <div class="share_button right" style="float:right;margin-top:-10px;margin-left:10px;display:none;">
            <a href="[% canon_url %]" class="button small" title="[% title %]">
                [% display_icon('share') %]
                <span class="show-for-large-up"> [% lang('share') %]</span>
            </a>
        </div>
    [% END %]
    
    
    [% IF weblinks %]
        <div class="weblinks">
            [% weblinks %]
        </div>
    [% END %]

    [% IF parents_and_children %]
        <div class="parents_and_children">
            [% parents_and_children %]
        </div>
    [% END %]

    [% IF description %]
        <div class="description">
            [% description %]
        </div>
    [% END %]
    [% IF tagid.defined  %]
        <!-- injecting facet-knowledge-panel -->
        <div id="facet-knowledge-panel">
            <h2 id="title"></h2>
            <P id="facet-panels"></P>
        </div>
        <!-- Fetching facet knowledge panel -->
        <script>
            let facet_kp_url = "https://facets-kp.openfoodfacts.net/render-to-html?";
            let params = "facet_tag=[% tagtype_name %]&value_tag=[% tagid %]&sec_facet_tag=[% tagtype2_name %]&sec_value_tag=[% tagid2 %]";
            // checking if data is filtered on country 
            if ("[% country_code %]" !== "world"){
                // Adding language code to get transalted data from facet-knowledge-panel API
                // Removing langcode from county name l.e, "en:france" to "france"
                country_name = "[% country %]".slice(3);
                params += "&lang_code=[% country_code %]&country=" + country_name;
            }
            fetch( fecet_kp_url + params )
            .then((response) => {
                if (response.ok) {
                    return response.text();}
                else {
                    throw new Error("NETWORK RESPONSE ERROR");
                    
            }
            })
            .then(data => {
                let title = document.getElementById("title");
                title.innerHTML = "Facet knowledge panel";
                let knowledgepanel = document.getElementById("facet-panels");
                knowledgepanel.innerHTML = data;
            
            })
        </script>
    [% END %]

[% END %]

[% IF country != 'en:world' %]
    <p>[% lang('countries_s').ucfirst %][% sep %]: [% display_taxonomy_tag("countries", country) %]
        - <a href="[% world_link_url %]">[% world_link %]</a>
    </p>
[% END %]


[% IF products_title %]
    <h2 class="products_title">[% products_title %]</h2>
[% END %]
        </div>
    </div>
</div>
    
</div>
<!-- end templates/[% template.name %] -->
