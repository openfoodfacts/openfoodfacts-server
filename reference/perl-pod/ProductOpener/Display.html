<html><head><title>ProductOpener::Display</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="simple.min" type="text/css" href="../simple.min.css" media="all" >

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.35,
  using Pod::Simple::PullParser v3.35,
  under Perl v5.030000 at Tue Oct 11 08:47:05 2022 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#VARIABLES'>VARIABLES</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#%25file_timestamps'>%file_timestamps</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Synopsis'>Synopsis</a>
      <li class='indexItem indexItem3'><a href='#Configuration'>Configuration</a>
    </ul>
  </ul>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#url_for_text_(_%24textid_)'>url_for_text ( $textid )</a>
    <li class='indexItem indexItem2'><a href='#process_template_(_%24template_filename_%2C_%24template_data_ref_%2C_%24result_content_ref_)'>process_template ( $template_filename , $template_data_ref , $result_content_ref )</a>
    <li class='indexItem indexItem2'><a href='#redirect_to_url(%24request_ref%2C_%24status_code%2C_%24redirect_url)'>redirect_to_url($request_ref, $status_code, $redirect_url)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Request_object_%24request_ref'>Request object $request_ref</a>
        <li class='indexItem indexItem4'><a href='#Status_code_%24status_code'>Status code $status_code</a>
        <li class='indexItem indexItem4'><a href='#Redirect_url_%24redirect_url'>Redirect url $redirect_url</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#single_param_(%24param_name)'>single_param ($param_name)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#CGI_parameter_name_%24param_name'>CGI parameter name $param_name</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#init_request_()'>init_request ()</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#analyze_request_(_%24request_ref_)'>analyze_request ( $request_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24request_ref_reference_to_a_hash_that_will_contain_analyzed_parameters'>$request_ref reference to a hash that will contain analyzed parameters</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Details'>Details</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_error_(_%24error_message%2C_%24status_)'>display_error ( $error_message, $status )</a>
    <li class='indexItem indexItem2'><a href='#display_error_and_exit_(_%24error_message%2C_%24status_)'>display_error_and_exit ( $error_message, $status )</a>
    <li class='indexItem indexItem2'><a href='#display_tag_(_%24request_ref_)'>display_tag ( $request_ref )</a>
    <li class='indexItem indexItem2'><a href='#display_search_results_(_%24request_ref_)'>display_search_results ( $request_ref )</a>
    <li class='indexItem indexItem2'><a href='#add_params_to_query_(_%24request_ref%2C_%24query_ref_)'>add_params_to_query ( $request_ref, $query_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24request_ref_(output)'>$request_ref (output)</a>
        <li class='indexItem indexItem4'><a href='#%24query_ref_(output)'>$query_ref (output)</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#initialize_knowledge_panels_options(_%24knowledge_panels_options_ref_)'>initialize_knowledge_panels_options( $knowledge_panels_options_ref )</a>
    <li class='indexItem indexItem2'><a href='#customize_response_for_product_(_%24request_ref%2C_%24product_ref_)'>customize_response_for_product ( $request_ref, $product_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24request_ref_(input)'>$request_ref (input)</a>
        <li class='indexItem indexItem4'><a href='#%24product_ref_(input)'>$product_ref (input)</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_pagination(_%24request_ref_%2C_%24count_%2C_%24limit_%2C_%24page_)'>display_pagination( $request_ref , $count , $limit , $page )</a>
    <li class='indexItem indexItem2'><a href='#display_possible_improvement_description(_PRODUCT_REF%2C_TAGID_)'>display_possible_improvement_description( PRODUCT_REF, TAGID )</a>
    <li class='indexItem indexItem2'><a href='#display_nutriscore_calculation_details(_%24nutriscore_data_ref_)'>display_nutriscore_calculation_details( $nutriscore_data_ref )</a>
    <li class='indexItem indexItem2'><a href='#data_to_display_nutrient_levels_(_%24product_ref_)'>data_to_display_nutrient_levels ( $product_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Product_reference_%24product_ref'>Product reference $product_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#data_to_display_nutriscore_(_%24product_ref_)'>data_to_display_nutriscore ( $product_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Product_reference_%24product_ref'>Product reference $product_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#compare_product_nutrition_facts_to_categories_(%24product_ref%2C_%24target_cc%2C_%24max_number_of_categories)'>compare_product_nutrition_facts_to_categories ($product_ref, $target_cc, $max_number_of_categories)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Product_reference_%24product_ref'>Product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#Target_country_code_%24target_cc'>Target country code $target_cc</a>
        <li class='indexItem indexItem4'><a href='#Max_number_of_categories_%24max_number_of_categories'>Max number of categories $max_number_of_categories</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#data_to_display_nutrition_table_(_%24product_ref%2C_%24comparisons_ref_)'>data_to_display_nutrition_table ( $product_ref, $comparisons_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Product_reference_%24product_ref'>Product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#Comparisons_reference_%24product_ref'>Comparisons reference $product_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_nutrition_table_(_%24product_ref%2C_%24comparisons_ref_)'>display_nutrition_table ( $product_ref, $comparisons_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Product_reference_%24product_ref'>Product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#Comparisons_reference_%24product_ref'>Comparisons reference $product_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_preferences_api_(_%24target_lc_)'>display_preferences_api ( $target_lc )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#request_object_reference_%24request_ref'>request object reference $request_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_attribute_groups_api_(_%24request_ref%2C_%24target_lc_)'>display_attribute_groups_api ( $request_ref, $target_lc )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#request_object_reference_%24request_ref'>request object reference $request_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_taxonomy_api_(_%24request_ref_)'>display_taxonomy_api ( $request_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#request_object_reference_%24request_ref'>request object reference $request_ref</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_icon_(_%24icon_)'>display_icon ( $icon )</a>
    <li class='indexItem indexItem2'><a href='#display_nested_list_of_ingredients_(_%24ingredients_ref%2C_%24ingredients_text_ref%2C_%24ingredients_list_ref_)'>display_nested_list_of_ingredients ( $ingredients_ref, $ingredients_text_ref, $ingredients_list_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24ingredients_ref_(input)'>$ingredients_ref (input)</a>
        <li class='indexItem indexItem4'><a href='#%24ingredients_text_ref_(output)'>$ingredients_text_ref (output)</a>
        <li class='indexItem indexItem4'><a href='#%24ingredients_list_ref_(output)'>$ingredients_list_ref (output)</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_list_of_specific_ingredients_(_%24product_ref_)'>display_list_of_specific_ingredients ( $product_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24product_ref'>$product_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#data_to_display_ingredients_analysis_details_(_%24product_ref_)'>data_to_display_ingredients_analysis_details ( $product_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Product_reference_%24product_ref'>Product reference $product_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_ingredients_analysis_details_(_%24product_ref_)'>display_ingredients_analysis_details ( $product_ref )</a>
    <li class='indexItem indexItem2'><a href='#data_to_display_ingredients_analysis_(_%24product_ref_)'>data_to_display_ingredients_analysis ( $product_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Product_reference_%24product_ref'>Product reference $product_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_ingredients_analysis_(_%24product_ref_)'>display_ingredients_analysis ( $product_ref )</a>
    <li class='indexItem indexItem2'><a href='#display_ecoscore_calculation_details(_%24cc%2C_%24ecoscore_data_ref_)'>display_ecoscore_calculation_details( $cc, $ecoscore_data_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#country_code_%24cc'>country code $cc</a>
        <li class='indexItem indexItem4'><a href='#ecoscore_data_%24ecoscore_data_ref'>ecoscore data $ecoscore_data_ref</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#display_ecoscore_calculation_details_simple_html(_%24ecoscore_cc%2C_%24ecoscore_data_ref_)'>display_ecoscore_calculation_details_simple_html( $ecoscore_cc, $ecoscore_data_ref )</a>
    <li class='indexItem indexItem2'><a href='#search_and_analyze_recipes_(%24request_ref%2C_%24query_ref)'>search_and_analyze_recipes ($request_ref, $query_ref)</a>
    <li class='indexItem indexItem2'><a href='#display_properties(_%24cc%2C_%24ecoscore_data_ref_)'>display_properties( $cc, $ecoscore_data_ref )</a>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>ProductOpener::Display - list,
create and save products</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p><code>ProductOpener::Display</code> generates the HTML code for the web site and the JSON responses for the API.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="VARIABLES"
>VARIABLES</a></h1>

<p>Exported variables that are available for other modules.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="%file_timestamps"
>%file_timestamps</a></h2>

<p>When the module is loaded (at the start of Apache with mod_perl),
we record the modification date of static files like CSS styles an JS code so that we can add a version parameter to the request in order to make sure the browser will not serve an old cached version.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Synopsis"
>Synopsis</a></h3>

<pre>    $scripts .= &#60;&#60;HTML
        &#60;script type=&#34;text/javascript&#34; src=&#34;/js/dist/product-multilingual.js?v=$file_timestamps{&#34;js/dist/product-multilingual.js&#34;}&#34;&#62;&#60;/script&#62;
    HTML
    ;</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Configuration"
>Configuration</a></h3>

<p>The files that need to be checked need to be specified in the code of Display.pm.</p>

<pre>        e.g.

    %file_timestamps = (
        &#34;css/dist/app.css&#34; =&#62; &#34;CSS file generated by the &#39;npm run build&#39; command&#34;,
        &#34;css/dist/product-multilingual.css&#34; =&#62; &#34;CSS file generated by the &#39;npm run build&#39; command&#34;,
        &#34;js/dist/product-multilingual.js&#34; =&#62; &#34;JS file generated by the &#39;npm run build&#39; command&#34;,
    );</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="url_for_text_(_$textid_)"
>url_for_text ( $textid )</a></h2>

<p>Return the localized URL for a text. (e.g. &#34;data&#34; points to /data in English and /donnees in French) Note: This currently only has ecoscore</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="process_template_(_$template_filename_,_$template_data_ref_,_$result_content_ref_)"
>process_template ( $template_filename , $template_data_ref , $result_content_ref )</a></h2>

<p>Add some functions and variables needed by many templates and process the template with template toolkit.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="redirect_to_url($request_ref,_$status_code,_$redirect_url)"
>redirect_to_url($request_ref, $status_code, $redirect_url)</a></h2>

<p>This function instructs mod_perl to print redirect HTTP header (Location) and to terminate the request immediately. The mod_perl process is not terminated and will continue to serve future requests.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Request_object_$request_ref"
>Request object $request_ref</a></h4>

<p>The request object may contain a cookie.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Status_code_$status_code"
>Status code $status_code</a></h4>

<p>e.g. 302 for a temporary redirect</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Redirect_url_$redirect_url"
>Redirect url $redirect_url</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="single_param_($param_name)"
>single_param ($param_name)</a></h2>

<p>CGI.pm param() function returns a list when called in a list context (e.g. when param() is an argument of a function, or the value of a field in a hash). This causes issues for function signatures that expect a scalar, and that may get passed an empty list if the parameter is not set.</p>

<p>So instead of calling CGI.pm param() directly, we call single_param() to prefix it with scalar.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="CGI_parameter_name_$param_name"
>CGI parameter name $param_name</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>A scalar value for the parameter, or undef if the parameter is not defined.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="init_request_()"
>init_request ()</a></h2>

<p><code>init_request()</code> is called at the start of each new request (web page or API). It initializes a number of variables, in particular:</p>

<p>$cc : country code $lc : language code</p>

<p>It also initializes a request object that is returned.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>Reference to request object.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="analyze_request_(_$request_ref_)"
>analyze_request ( $request_ref )</a></h2>

<p>Analyze request parameters and decide which method to call.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$request_ref_reference_to_a_hash_that_will_contain_analyzed_parameters"
>$request_ref reference to a hash that will contain analyzed parameters</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Details"
>Details</a></h3>

<p>It will analyze path and parameters.</p>

<p>Some information is set in request_ref, notably - polished query_string - page number (page) - api version and api_method - requested page (text) - some boolean for routing : search / taxonomy / mission / product / tag / points - parameters for products, mission, tags, etc.</p>

<p>It handles redirect for renamed texts or products, .well-known/change-password</p>

<p>Sometimes we modify request parameters (param) to correspond to request_ref: - parameters for response format : json, jsonp, xml, ... - code parameter</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_error_(_$error_message,_$status_)"
>display_error ( $error_message, $status )</a></h2>

<p>Display an error message using the site template.</p>

<p>The request is not terminated by this function, it will continue to run.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_error_and_exit_(_$error_message,_$status_)"
>display_error_and_exit ( $error_message, $status )</a></h2>

<p>Display an error message using the site template, and terminate the request immediately.</p>

<p>Any code after the call to display_error_and_exit() will not be executed.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_tag_(_$request_ref_)"
>display_tag ( $request_ref )</a></h2>

<p>This function is called to display either:</p>

<p>1. Products that have a specific tag: /category/cakes or that don&#39;t have a specific tag /category/-cakes or that have 2 specific tags /category/cake/brand/oreo 2. List of tags of a given type: /labels possibly for products that have a specific tag: /category/cakes/labels or 2 specific tags: /category/cakes/label/organic/additives</p>

<p>When displaying products for a tag, the function generates tag type specific HTML that is displayed at the top of the page: - tag parents and children - maps for tag types that have a location (e.g. packaging codes) - special properties for some tag types (e.g. additives)</p>

<p>The function then calls search_and_display_products() to display the paginated list of products.</p>

<p>When displaying a list of tags, the function calls display_list_of_tags().</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_search_results_(_$request_ref_)"
>display_search_results ( $request_ref )</a></h2>

<p>This function builds the HTML returned by the /search endpoint.</p>

<p>The results can be displayed in different ways:</p>

<p>1. a paginated list of products (default) The function calls search_and_display_products() to display the paginated list of products.</p>

<p>2. results filtered and ranked on the client-side 2.1. according to user preferences that are locally saved on the client: &#38;user_preferences=1 2.2. according to preferences passed in the url: &#38;preferences=..</p>

<p>3. on a graph (histogram or scatter plot): &#38;graph=1 -- TODO: not supported yet</p>

<p>4. on a map &#38;map=1 -- TODO: not supported yet</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="add_params_to_query_(_$request_ref,_$query_ref_)"
>add_params_to_query ( $request_ref, $query_ref )</a></h2>

<p>This function is used to parse search query parameters that are passed to the API (/api/v?/search endpoint) or to the web site search (/search endpoint) either as query string parameters (e.g. ?labels_tags=en:organic) or POST parameters.</p>

<p>The function adds the corresponding query filters in the MongoDB query.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$request_ref_(output)"
>$request_ref (output)</a></h4>

<p>Reference to the internal request object.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$query_ref_(output)"
>$query_ref (output)</a></h4>

<p>Reference to the MongoDB query object.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="initialize_knowledge_panels_options(_$knowledge_panels_options_ref_)"
>initialize_knowledge_panels_options( $knowledge_panels_options_ref )</a></h2>

<p>Initialize the options for knowledge panels from parameters.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="customize_response_for_product_(_$request_ref,_$product_ref_)"
>customize_response_for_product ( $request_ref, $product_ref )</a></h2>

<p>Using the fields parameter, API product or search queries can request a specific set of fields to be returned.</p>

<p>This function filters the field to return only the requested fields, and computes requested fields that are not stored in the database but created on demand.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$request_ref_(input)"
>$request_ref (input)</a></h4>

<p>Reference to the request object.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$product_ref_(input)"
>$product_ref (input)</a></h4>

<p>Reference to the product object (retrieved from disk or from a MongoDB query)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>Reference to the customized product object.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_pagination(_$request_ref_,_$count_,_$limit_,_$page_)"
>display_pagination( $request_ref , $count , $limit , $page )</a></h2>

<p>This function is used for page navigation and gets called when there is more than one page of products. The URL can be different, either page=&#60;number&#62; , or /&#60;number&#62; . page=&#60;number&#62; is used for search queries. /&#60;number&#62; is used for facets.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_possible_improvement_description(_PRODUCT_REF,_TAGID_)"
>display_possible_improvement_description( PRODUCT_REF, TAGID )</a></h2>

<p>Display an explanation of the possible improvement, using the improvement data stored in $product_ref-&#62;{improvements_data}</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_nutriscore_calculation_details(_$nutriscore_data_ref_)"
>display_nutriscore_calculation_details( $nutriscore_data_ref )</a></h2>

<p>Generates HTML code with information on how the Nutri-Score was computed for a particular product.</p>

<p>For each component of the Nutri-Score (energy, sugars etc.) it shows the input value, the rounded value according to the Nutri-Score rules, and the corresponding points.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="data_to_display_nutrient_levels_(_$product_ref_)"
>data_to_display_nutrient_levels ( $product_ref )</a></h2>

<p>Generates a data structure to display the nutrient levels (food traffic lights).</p>

<p>The resulting data structure can be passed to a template to generate HTML or the JSON data for a knowledge panel.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Product_reference_$product_ref"
>Product reference $product_ref</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Reference to a data structure with needed data to display.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="data_to_display_nutriscore_(_$product_ref_)"
>data_to_display_nutriscore ( $product_ref )</a></h2>

<p>Generates a data structure to display the Nutri-Score.</p>

<p>The resulting data structure can be passed to a template to generate HTML or the JSON data for a knowledge panel.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Product_reference_$product_ref"
>Product reference $product_ref</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Reference to a data structure with needed data to display.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="compare_product_nutrition_facts_to_categories_($product_ref,_$target_cc,_$max_number_of_categories)"
>compare_product_nutrition_facts_to_categories ($product_ref, $target_cc, $max_number_of_categories)</a></h2>

<p>Compares a product nutrition facts to average nutrition facts of each of its categories.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Product_reference_$product_ref"
>Product reference $product_ref</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Target_country_code_$target_cc"
>Target country code $target_cc</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Max_number_of_categories_$max_number_of_categories"
>Max number of categories $max_number_of_categories</a></h4>

<p>If defined, we will limit the number of categories returned, and keep the most specific categories.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Reference to a comparisons data structure that can be passed to the data_to_display_nutrition_table() function.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="data_to_display_nutrition_table_(_$product_ref,_$comparisons_ref_)"
>data_to_display_nutrition_table ( $product_ref, $comparisons_ref )</a></h2>

<p>Generates a data structure to display a nutrition table.</p>

<p>The nutrition table can be the nutrition table of a product, or of a category (stats for the categories).</p>

<p>In the case of a product, extra columns can be added to compare the product nutrition facts to the average for its categories.</p>

<p>The resulting data structure can be passed to a template to generate HTML or the JSON data for a knowledge panel.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Product_reference_$product_ref"
>Product reference $product_ref</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Comparisons_reference_$product_ref"
>Comparisons reference $product_ref</a></h4>

<p>Reference to an array with nutrition facts for 1 or more categories.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Reference to a data structure with needed data to display.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_nutrition_table_(_$product_ref,_$comparisons_ref_)"
>display_nutrition_table ( $product_ref, $comparisons_ref )</a></h2>

<p>Generates HTML to display a nutrition table.</p>

<p>Use data produced by data_to_display_nutrition_table</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Product_reference_$product_ref"
>Product reference $product_ref</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Comparisons_reference_$product_ref"
>Comparisons reference $product_ref</a></h4>

<p>Reference to an array with nutrition facts for 1 or more categories.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>HTML for the nutrition table.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_preferences_api_(_$target_lc_)"
>display_preferences_api ( $target_lc )</a></h2>

<p>Return a JSON structure with all available preference values for attributes.</p>

<p>This is used by clients that ask for user preferences to personalize filtering and ranking based on product attributes.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="request_object_reference_$request_ref"
>request object reference $request_ref</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Sets the desired language for the user facing strings.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_attribute_groups_api_(_$request_ref,_$target_lc_)"
>display_attribute_groups_api ( $request_ref, $target_lc )</a></h2>

<p>Return a JSON structure with all available attribute groups and attributes, with strings (names, descriptions etc.) in a specific language, and return them in an array of attribute groups.</p>

<p>This is used in particular for clients of the API to know which preferences they can ask users for, and then use for personalized filtering and ranking.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="request_object_reference_$request_ref"
>request object reference $request_ref</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users. This parameter sets the desired language for the user facing strings.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_taxonomy_api_(_$request_ref_)"
>display_taxonomy_api ( $request_ref )</a></h2>

<p>Generate an extract of a taxonomy for specific tags, fields and languages, and return it as a JSON object.</p>

<p>Accessed through the /api/v2/taxonomy API</p>

<p>e.g. https://world.openfoodfacts.org/api/v2/taxonomy?type=labels&#38;tags=en:organic,en:fair-trade&#38;fields=name,description,children&#38;include_children=1&#38;lc=en,fr</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="request_object_reference_$request_ref"
>request object reference $request_ref</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_icon_(_$icon_)"
>display_icon ( $icon )</a></h2>

<p>Displays icons (e.g., the camera icon &#34;Picture with barcode&#34;, the graph and maps button, etc)</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_nested_list_of_ingredients_(_$ingredients_ref,_$ingredients_text_ref,_$ingredients_list_ref_)"
>display_nested_list_of_ingredients ( $ingredients_ref, $ingredients_text_ref, $ingredients_list_ref )</a></h2>

<p>Recursive function to display how the ingredients were analyzed. This function calls itself to display sub-ingredients of ingredients.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$ingredients_ref_(input)"
>$ingredients_ref (input)</a></h4>

<p>Reference to the product&#39;s ingredients array or the ingredients array of an ingredient.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$ingredients_text_ref_(output)"
>$ingredients_text_ref (output)</a></h4>

<p>Reference to a list of ingredients in text format that we will reconstruct from the ingredients array.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$ingredients_list_ref_(output)"
>$ingredients_list_ref (output)</a></h4>

<p>Reference to an HTML list of ingredients in ordered nested list format that corresponds to the ingredients array.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_list_of_specific_ingredients_(_$product_ref_)"
>display_list_of_specific_ingredients ( $product_ref )</a></h2>

<p>Generate HTML to display how the specific ingredients (e.g. mentions like &#34;Total milk content: 90%&#34;) were analyzed.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$product_ref"
>$product_ref</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>Empty string if no specific ingredients were detected, or HTML describing the specific ingredients.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="data_to_display_ingredients_analysis_details_(_$product_ref_)"
>data_to_display_ingredients_analysis_details ( $product_ref )</a></h2>

<p>Generates a data structure to display the details of ingredients analysis.</p>

<p>The resulting data structure can be passed to a template to generate HTML or the JSON data for a knowledge panel.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Product_reference_$product_ref"
>Product reference $product_ref</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Reference to a data structure with needed data to display.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_ingredients_analysis_details_(_$product_ref_)"
>display_ingredients_analysis_details ( $product_ref )</a></h2>

<p>Generates HTML code with information on how the ingredient list was parsed and mapped to the ingredients taxonomy.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="data_to_display_ingredients_analysis_(_$product_ref_)"
>data_to_display_ingredients_analysis ( $product_ref )</a></h2>

<p>Generates a data structure to display the results of ingredients analysis.</p>

<p>The resulting data structure can be passed to a template to generate HTML or the JSON data for a knowledge panel.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Product_reference_$product_ref"
>Product reference $product_ref</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Reference to a data structure with needed data to display.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_ingredients_analysis_(_$product_ref_)"
>display_ingredients_analysis ( $product_ref )</a></h2>

<p>Generates HTML code with icons that show if the product is vegetarian, vegan and without palm oil.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_ecoscore_calculation_details(_$cc,_$ecoscore_data_ref_)"
>display_ecoscore_calculation_details( $cc, $ecoscore_data_ref )</a></h2>

<p>Generates HTML code with information on how the Eco-score was computed for a particular product.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="country_code_$cc"
>country code $cc</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="ecoscore_data_$ecoscore_data_ref"
>ecoscore data $ecoscore_data_ref</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_ecoscore_calculation_details_simple_html(_$ecoscore_cc,_$ecoscore_data_ref_)"
>display_ecoscore_calculation_details_simple_html( $ecoscore_cc, $ecoscore_data_ref )</a></h2>

<p>Generates simple HTML code (to display in a mobile app) with information on how the Eco-score was computed for a particular product.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="search_and_analyze_recipes_($request_ref,_$query_ref)"
>search_and_analyze_recipes ($request_ref, $query_ref)</a></h2>

<p>Analyze the distribution of selected parent ingredients in the searched products</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="display_properties(_$cc,_$ecoscore_data_ref_)"
>display_properties( $cc, $ecoscore_data_ref )</a></h2>

<p>Load the Folksonomy Engine properties script</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
