language: perl
perl:
  - "system"
env: COVERAGE=1
addons:
  apt:
    packages:
    - libimage-magick-perl
    - libbarcode-zbar-perl
    - tesseract-ocr
    - graphviz
sudo: false
before_install:
  - npm install -g bower
  - cpanm --local-lib=~/perl5 local::lib && eval $(perl -I ~/perl5/lib/perl5/ -Mlocal::lib)
install:
  - cpanm --quiet --installdeps --notest --skip-satisfied .
  - bower install
  - ln -s lib/ProductOpener/Config_off.pm lib/ProductOpener/Config.pm
  - ln -s lib/ProductOpener/Config2_sample.pm lib/ProductOpener/Config2.pm
  - ln -s lib/ProductOpener/SiteLang_off.pm lib/ProductOpener/SiteLang.pm
script:
  - prove -l
  - perl -c -CS -Ilib lib/startup_apache2.pl
notifications:
  slack: openfoodfacts:Pre9ZXKFH1CYtix8DeJAaFi2
