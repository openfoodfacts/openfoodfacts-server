<html><head><title>ProductOpener::GS1</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.35,
  using Pod::Simple::PullParser v3.35,
  under Perl v5.030000 at Wed Oct  6 12:51:10 2021 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#GS1_MAPS'>GS1 MAPS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#%25unknown_entries_in_gs1_maps'>%unknown_entries_in_gs1_maps</a>
    <li class='indexItem indexItem2'><a href='#%25gs1_maps'>%gs1_maps</a>
    <li class='indexItem indexItem2'><a href='#%25gs1_to_off'>%gs1_to_off</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#init_csv_fields_()'>init_csv_fields ()</a>
    <li class='indexItem indexItem2'><a href='#assign_field_(_%24results_ref_%24target_field_%24target_value)'>assign_field ( $results_ref $target_field $target_value)</a>
    <li class='indexItem indexItem2'><a href='#gs1_to_off_(%24gs1_to_off_ref%2C_%24json_ref%2C_%24results_ref)'>gs1_to_off ($gs1_to_off_ref, $json_ref, $results_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#%24gs1_to_off_ref_-_Mapping_configuration_from_GS1_to_off_for_the_current_level'>$gs1_to_off_ref - Mapping configuration from GS1 to off for the current level</a>
        <li class='indexItem indexItem4'><a href='#%24json_ref_-_JSON_structure_for_the_current_level'>$json_ref - JSON structure for the current level</a>
        <li class='indexItem indexItem4'><a href='#%24results_ref_-_Hash_of_key_%2F_value_pairs_to_store_the_complete_output_of_the_mapping'>$results_ref - Hash of key / value pairs to store the complete output of the mapping</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#convert_gs1_json_to_off_csv_fields_(%24json)'>convert_gs1_json_to_off_csv_fields ($json)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#json_text'>json text</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Reference_to_a_hash_of_fields'>Reference to a hash of fields</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#read_gs1_json_file_(%24json_file%2C_%24products_ref)'>read_gs1_json_file ($json_file, $products_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#input_json_file_path_and_name_%24json_file'>input json file path and name $json_file</a>
        <li class='indexItem indexItem4'><a href='#reference_to_output_products_array_%24products_ref'>reference to output products array $products_ref</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#write_off_csv_file_(%24csv_file%2C_%24products_ref)'>write_off_csv_file ($csv_file, $products_ref)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#output_CSV_file_path_and_name'>output CSV file path and name</a>
        <li class='indexItem indexItem4'><a href='#reference_to_output_products_array_%24products_ref'>reference to output products array $products_ref</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#print_unknown_entries_in_gs1_maps_()'>print_unknown_entries_in_gs1_maps ()</a>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>ProductOpener::GS1 - convert data from GS1 Global Data Synchronization Network (GDSN) to the Open Food Facts format.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This module converts GDSN data that has previously been converted to JSON (either from XML with xml2json (e.g.
Equadis data),
or from JSON provided by a GDSN partner (e.g.
CodeOnline) to the Open Food Facts CSV format.</p>

<p>The conversion is configured through the %gs1_to_off structure to indicate which source field maps to which target field.</p>

<p>And the %gs1_maps translate the GS1 specific identifiers (e.g.
for allergens or units) to OFF identifiers.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="GS1_MAPS"
>GS1 MAPS</a></h1>

<p>GS1 uses many different codes for allergens,
packaging etc.
We need to map the different values to the values we use in the taxonomies.</p>

<p>The GS1 standards are evolving,
so new values may be introduced over time.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="%unknown_entries_in_gs1_maps"
>%unknown_entries_in_gs1_maps</a></h2>

<p>Used to keep track of values we encounter in GS1 data for which we do not have a mapping.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="%gs1_maps"
>%gs1_maps</a></h2>

<p>Maps from GS1 to OFF</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="%gs1_to_off"
>%gs1_to_off</a></h2>

<p>Defines the structure of the GS1 data and how it maps to the OFF data.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="init_csv_fields_()"
>init_csv_fields ()</a></h2>

<p>%seen_fields and @fields are used to output the fields in the order of the GS1 to OFF mapping configuration</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="assign_field_(_$results_ref_$target_field_$target_value)"
>assign_field ( $results_ref $target_field $target_value)</a></h2>

<p>Used to assign a value to a field,
and keep track of the order of the fields we are matching,
so that we can output the fields in the same order when we export a CSV.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="gs1_to_off_($gs1_to_off_ref,_$json_ref,_$results_ref)"
>gs1_to_off ($gs1_to_off_ref,
$json_ref,
$results_ref)</a></h2>

<p>Recursive function to go through all first level keys of the $gs1_to_off_ref mapping.
All values that can be assigned at that level are assigned,
and if we need to go into a nested level,
the function calls itself again.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$gs1_to_off_ref_-_Mapping_configuration_from_GS1_to_off_for_the_current_level"
>$gs1_to_off_ref - Mapping configuration from GS1 to off for the current level</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$json_ref_-_JSON_structure_for_the_current_level"
>$json_ref - JSON structure for the current level</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="$results_ref_-_Hash_of_key_/_value_pairs_to_store_the_complete_output_of_the_mapping"
>$results_ref - Hash of key / value pairs to store the complete output of the mapping</a></h4>

<p>The same hash reference is passed to recursive calls to the gs1_to_off function.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="convert_gs1_json_to_off_csv_fields_($json)"
>convert_gs1_json_to_off_csv_fields ($json)</a></h2>

<p>Thus function converts the data for one product in the GS1 format converted to JSON.
GS1 format is in XML,
it needs to be transformed to JSON with xml2json first.
In some cases,
the conversion to JSON has already be done by a third party (e.g.
the CodeOnline database from GS1 France).</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="json_text"
>json text</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Reference_to_a_hash_of_fields"
>Reference to a hash of fields</a></h4>

<p>The function returns a reference to a hash.</p>

<p>Each key is the name of the OFF csv field,
and it is associated with the corresponding value for the product.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="read_gs1_json_file_($json_file,_$products_ref)"
>read_gs1_json_file ($json_file,
$products_ref)</a></h2>

<p>Read a GS1 file on json format,
convert it to the OFF format,
return the result,
and store the result in the $products_ref array (if not undef)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="input_json_file_path_and_name_$json_file"
>input json file path and name $json_file</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="reference_to_output_products_array_$products_ref"
>reference to output products array $products_ref</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="write_off_csv_file_($csv_file,_$products_ref)"
>write_off_csv_file ($csv_file,
$products_ref)</a></h2>

<p>Write all product data from the $products_ref array to a CSV file in OFF format.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="output_CSV_file_path_and_name"
>output CSV file path and name</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="reference_to_output_products_array_$products_ref"
>reference to output products array $products_ref</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="print_unknown_entries_in_gs1_maps_()"
>print_unknown_entries_in_gs1_maps ()</a></h2>

<p>Prints the entries for GS1 data types for which we do not have a corresponding OFF match,
ordered by the number of occurences in the GS1 data</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
