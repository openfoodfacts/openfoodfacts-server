<html><head><title>ProductOpener::KnowledgePanels</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.35,
  using Pod::Simple::PullParser v3.35,
  under Perl v5.030000 at Wed Oct  6 21:56:30 2021 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#create_knowledge_panels(_%24product_ref%2C_%24target_lc%2C_%24target_cc%2C_%24options_ref_)'>create_knowledge_panels( $product_ref, $target_lc, $target_cc, $options_ref )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#product_reference_%24product_ref'>product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc_(or_%22data%22)'>language code $target_lc (or &#34;data&#34;)</a>
        <li class='indexItem indexItem4'><a href='#country_code_%24target_cc'>country code $target_cc</a>
        <li class='indexItem indexItem4'><a href='#options_%24options_ref'>options $options_ref</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_values'>Return values</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#convert_multiline_string_to_singleline(%24line)'>convert_multiline_string_to_singleline($line)</a>
    <li class='indexItem indexItem2'><a href='#create_panel_from_json_template_(_%24panel_id%2C_%24panel_template%2C_%24panel_data_ref%2C_%24product_ref%2C_%24target_lc%2C_%24target_cc_)'>create_panel_from_json_template ( $panel_id, $panel_template, $panel_data_ref, $product_ref, $target_lc, $target_cc )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#panel_id_%24panel_id'>panel id $panel_id</a>
        <li class='indexItem indexItem4'><a href='#panel_template_%24panel_template'>panel template $panel_template</a>
        <li class='indexItem indexItem4'><a href='#panel_data_reference_%24panel_data_ref_(optional%2C_can_be_an_empty_hash)'>panel data reference $panel_data_ref (optional, can be an empty hash)</a>
        <li class='indexItem indexItem4'><a href='#product_reference_%24product_ref'>product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
        <li class='indexItem indexItem4'><a href='#country_code_%24target_cc'>country code $target_cc</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#create_ecoscore_panel_(_%24product_ref%2C_%24target_lc%2C_%24target_cc_)'>create_ecoscore_panel ( $product_ref, $target_lc, $target_cc )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Arguments'>Arguments</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#product_reference_%24product_ref'>product reference $product_ref</a>
        <li class='indexItem indexItem4'><a href='#language_code_%24target_lc'>language code $target_lc</a>
        <li class='indexItem indexItem4'><a href='#country_code_%24target_cc'>country code $target_cc</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Return_value'>Return value</a>
    </ul>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>ProductOpener::KnowledgePanels - Generate product knowledge panels that can be requested through the API</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p>Apps can request through the API knowledge panels for one product.
They are returned in the same structured format for all panels.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>See https://docs.google.com/document/d/1vJ9gatmv8pCXxyOERmYD16jOKRWJpz1RaQQ5MEcTxms/edit</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="create_knowledge_panels(_$product_ref,_$target_lc,_$target_cc,_$options_ref_)"
>create_knowledge_panels( $product_ref,
$target_lc,
$target_cc,
$options_ref )</a></h2>

<p>Create all knowledge panels for a product,
with strings (descriptions,
recommendations etc.) in a specific language,
and return them in an array of panels.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_reference_$product_ref"
>product reference $product_ref</a></h4>

<p>Loaded from the MongoDB database,
Storable files,
or the OFF API.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc_(or_&#34;data&#34;)"
>language code $target_lc (or &#34;data&#34;)</a></h4>

<p>Returned panels contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<p>If $target_lc is equal to &#34;data&#34;,
no strings are returned.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="country_code_$target_cc"
>country code $target_cc</a></h4>

<p>Needed for some country specific panels like the Eco-Score.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="options_$options_ref"
>options $options_ref</a></h4>

<p>Defines how some panels should be created (or not created)</p>

<p>- skip_[panel_id] : do not create a specific panel</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_values"
>Return values</a></h3>

<p>Panels are returned in the &#34;knowledge_panels_[$target_lc]&#34; hash of the product reference passed as input.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="convert_multiline_string_to_singleline($line)"
>convert_multiline_string_to_singleline($line)</a></h2>

<p>Helper function to allow to enter multiline strings in JSON templates.
The function converts the multiline string into a single line string.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="create_panel_from_json_template_(_$panel_id,_$panel_template,_$panel_data_ref,_$product_ref,_$target_lc,_$target_cc_)"
>create_panel_from_json_template ( $panel_id,
$panel_template,
$panel_data_ref,
$product_ref,
$target_lc,
$target_cc )</a></h2>

<p>Creates a knowledge panel from a JSON template.
The template is passed both the full product data + optional panel specific data.
The template is thus responsible for all the display logic (what to display and how to display it).</p>

<p>Some special features that are not included in the JSON format are supported:</p>

<p>1.
Multiline strings can be included using backticks ` at the start and end of the multinine strings.
- The multiline strings will be converted to a single string.
- Quotes &#34; are automatically escaped unless they are already escaped</p>

<p>2.
Comments can be included by starting a line with // - Comments will be removed in the resulting JSON,
they are only intended to make the source template easier to understand.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="panel_id_$panel_id"
>panel id $panel_id</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="panel_template_$panel_template"
>panel template $panel_template</a></h4>

<p>Relative path to the the template panel file,
from the &#34;/templates&#34; directory.
e.g.
&#34;api/knowledge-panels/ecoscore/agribalyse.tt.json&#34;</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="panel_data_reference_$panel_data_ref_(optional,_can_be_an_empty_hash)"
>panel data reference $panel_data_ref (optional,
can be an empty hash)</a></h4>

<p>Used to pass data that is necessary for the panel but is not contained in the product data.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_reference_$product_ref"
>product reference $product_ref</a></h4>

<p>Loaded from the MongoDB database,
Storable files,
or the OFF API.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="country_code_$target_cc"
>country code $target_cc</a></h4>

<p>The Eco-Score depends on the country of the consumer (as the transport bonus/malus depends on it)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>The return value is a reference to the resulting knowledge panel data structure.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="create_ecoscore_panel_(_$product_ref,_$target_lc,_$target_cc_)"
>create_ecoscore_panel ( $product_ref,
$target_lc,
$target_cc )</a></h2>

<p>Creates a knowledge panel to describe the Eco-Score,
including sub-panels for the different components of the Eco-Score.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Arguments"
>Arguments</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="product_reference_$product_ref"
>product reference $product_ref</a></h4>

<p>Loaded from the MongoDB database,
Storable files,
or the OFF API.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="language_code_$target_lc"
>language code $target_lc</a></h4>

<p>Returned attributes contain both data and strings intended to be displayed to users.
This parameter sets the desired language for the user facing strings.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="country_code_$target_cc"
>country code $target_cc</a></h4>

<p>The Eco-Score depends on the country of the consumer (as the transport bonus/malus depends on it)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Return_value"
>Return value</a></h3>

<p>The return value is a reference to the resulting knowledge panel data structure.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
