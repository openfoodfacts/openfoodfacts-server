!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./vendor/jquery.ui.widget","./jquery.iframe-transport"],e):e(window.jQuery)}(function(e){"use strict";e.widget("blueimp.fileupload",{options:{namespace:void 0,dropZone:e(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,formData:function(e){return e.serializeArray()},add:function(e,t){t.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:["namespace","dropZone","fileInput"],_isXHRUpload:function(e){var t="undefined";return!(e.forceIframeTransport||typeof XMLHttpRequestUpload===t||typeof File===t||e.multipart&&typeof FormData===t)},_getFormData:function(t){var i;return"function"==typeof t.formData?t.formData(t.form):e.isArray(t.formData)?t.formData:t.formData?(i=[],e.each(t.formData,function(e,t){i.push({name:e,value:t})}),i):[]},_getTotal:function(t){var i=0;return e.each(t,function(e,t){i+=t.size||1}),i},_onProgress:function(e,t){if(e.lengthComputable){var i=t.total||this._getTotal(t.files),n=parseInt(e.loaded/e.total*(t.chunkSize||i),10)+(t.uploadedBytes||0);this._loaded+=n-(t.loaded||t.uploadedBytes||0),t.lengthComputable=!0,t.loaded=n,t.total=i,this._trigger("progress",e,t),this._trigger("progressall",e,{lengthComputable:!0,loaded:this._loaded,total:this._total})}},_initProgressListener:function(t){var i=this,n=t.xhr?t.xhr():e.ajaxSettings.xhr();n.upload&&(e(n.upload).bind("progress",function(e){var n=e.originalEvent;e.lengthComputable=n.lengthComputable,e.loaded=n.loaded,e.total=n.total,i._onProgress(e,t)}),t.xhr=function(){return n})},_initXHRData:function(t){var i,n=t.files[0];(!t.multipart||t.blob)&&(t.headers=e.extend(t.headers,{"X-File-Name":n.name,"X-File-Type":n.type,"X-File-Size":n.size}),t.blob?t.multipart||(t.contentType="application/octet-stream",t.data=t.blob):(t.contentType=n.type,t.data=n)),t.multipart&&"undefined"!=typeof FormData&&(t.postMessage?(i=this._getFormData(t),t.blob?i.push({name:t.paramName,value:t.blob}):e.each(t.files,function(e,n){i.push({name:t.paramName,value:n})})):(t.formData instanceof FormData?i=t.formData:(i=new FormData,e.each(this._getFormData(t),function(e,t){i.append(t.name,t.value)})),t.blob?i.append(t.paramName,t.blob,n.name):e.each(t.files,function(e,n){n instanceof Blob&&i.append(t.paramName,n,n.name)})),t.data=i),t.blob=null},_initIframeSettings:function(e){e.dataType="iframe "+(e.dataType||""),e.formData=this._getFormData(e)},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e,"iframe")},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form"))),t.paramName||(t.paramName=t.fileInput.prop("name")||"files[]"),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&(t.type="POST")},_getAJAXSettings:function(t){var i=e.extend({},this.options,t);return this._initFormSettings(i),this._initDataSettings(i),i},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,i,n){var o=e.Deferred(),a=o.promise();return i=i||this.options.context||a,t===!0?o.resolveWith(i,n):t===!1&&o.rejectWith(i,n),a.abort=o.promise,this._enhancePromise(a)},_chunkedUpload:function(t,i){var n,o,a,r,s=this,l=t.files[0],d=l.size,p=t.uploadedBytes=t.uploadedBytes||0,u=t.maxChunkSize||d,f=l.webkitSlice||l.mozSlice||l.slice;return this._isXHRUpload(t)&&f&&(p||d>u)&&!t.data?i?!0:p>=d?(l.error="uploadedBytes",this._getXHRPromise(!1,t.context,[null,"error",l.error])):(o=Math.ceil((d-p)/u),n=function(i){return i?n(i-=1).pipe(function(){var n=e.extend({},t);return n.blob=f.call(l,p+i*u,p+(i+1)*u),n.chunkSize=n.blob.size,s._initXHRData(n),s._initProgressListener(n),a=(e.ajax(n)||s._getXHRPromise(!1,n.context)).done(function(){n.loaded||s._onProgress(e.Event("progress",{lengthComputable:!0,loaded:n.chunkSize,total:n.chunkSize}),n),t.uploadedBytes=n.uploadedBytes+=n.chunkSize})}):s._getXHRPromise(!0,t.context)},r=n(o),r.abort=function(){return a.abort()},this._enhancePromise(r)):!1},_beforeSend:function(e,t){0===this._active&&this._trigger("start"),this._active+=1,this._loaded+=t.uploadedBytes||0,this._total+=this._getTotal(t.files)},_onDone:function(t,i,n,o){this._isXHRUpload(o)||this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:1,total:1}),o),o.result=t,o.textStatus=i,o.jqXHR=n,this._trigger("done",null,o)},_onFail:function(e,t,i,n){n.jqXHR=e,n.textStatus=t,n.errorThrown=i,this._trigger("fail",null,n),n.recalculateProgress&&(this._loaded-=n.loaded||n.uploadedBytes||0,this._total-=n.total||this._getTotal(n.files))},_onAlways:function(e,t,i,n){this._active-=1,n.textStatus=t,i&&i.always?(n.jqXHR=i,n.result=e):(n.jqXHR=e,n.errorThrown=i),this._trigger("always",null,n),0===this._active&&(this._trigger("stop"),this._loaded=this._total=0)},_onSend:function(t,i){var n,o,a,r=this,s=r._getAJAXSettings(i),l=function(i,o){return r._sending+=1,n=n||(i!==!1&&r._trigger("send",t,s)!==!1&&(r._chunkedUpload(s)||e.ajax(s))||r._getXHRPromise(!1,s.context,o)).done(function(e,t,i){r._onDone(e,t,i,s)}).fail(function(e,t,i){r._onFail(e,t,i,s)}).always(function(e,t,i){if(r._sending-=1,r._onAlways(e,t,i,s),s.limitConcurrentUploads&&s.limitConcurrentUploads>r._sending)for(var n=r._slots.shift();n;){if(!n.isRejected()){n.resolve();break}n=r._slots.shift()}})};return this._beforeSend(t,s),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(o=e.Deferred(),this._slots.push(o),a=o.pipe(l)):a=this._sequence=this._sequence.pipe(l,l),a.abort=function(){var e=[void 0,"abort","abort"];return n?n.abort():(o&&o.rejectWith(e),l(!1,e))},this._enhancePromise(a)):l()},_onAdd:function(t,i){var n,o,a=this,r=!0,s=e.extend({},this.options,i),l=s.limitMultiFileUploads;if((s.singleFileUploads||l)&&this._isXHRUpload(s)){if(!s.singleFileUploads&&l)for(n=[],o=0;o<i.files.length;o+=l)n.push(i.files.slice(o,o+l))}else n=[i.files];return i.originalFiles=i.files,e.each(n||i.files,function(o,s){var l=n?s:[s],d=e.extend({},i,{files:l});return d.submit=function(){return d.jqXHR=this.jqXHR=a._trigger("submit",t,this)!==!1&&a._onSend(t,this),this.jqXHR},r=a._trigger("add",t,d)}),r},_normalizeFile:function(e,t){void 0===t.name&&void 0===t.size&&(t.name=t.fileName,t.size=t.fileSize)},_replaceFileInput:function(t){var i=t.clone(!0);e("<form></form>").append(i)[0].reset(),t.after(i).detach(),e.cleanData(t.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,n){return n===t[0]?i[0]:n}),t[0]===this.element[0]&&(this.element=i)},_onChange:function(t){var i=t.data.fileupload,n={files:e.each(e.makeArray(t.target.files),i._normalizeFile),fileInput:e(t.target),form:e(t.target.form)};return n.files.length||(n.files=[{name:t.target.value.replace(/^.*\\/,"")}]),i.options.replaceFileInput&&i._replaceFileInput(n.fileInput),i._trigger("change",t,n)===!1||i._onAdd(t,n)===!1?!1:void 0},_onPaste:function(t){var i=t.data.fileupload,n=t.originalEvent.clipboardData,o=n&&n.items||[],a={files:[]};return e.each(o,function(e,t){var i=t.getAsFile&&t.getAsFile();i&&a.files.push(i)}),i._trigger("paste",t,a)===!1||i._onAdd(t,a)===!1?!1:void 0},_onDrop:function(t){var i=t.data.fileupload,n=t.dataTransfer=t.originalEvent.dataTransfer,o={files:e.each(e.makeArray(n&&n.files),i._normalizeFile)};return i._trigger("drop",t,o)===!1||i._onAdd(t,o)===!1?!1:void t.preventDefault()},_onDragOver:function(e){var t=e.data.fileupload,i=e.dataTransfer=e.originalEvent.dataTransfer;return t._trigger("dragover",e)===!1?!1:(i&&(i.dropEffect=i.effectAllowed="copy"),void e.preventDefault())},_initEventHandlers:function(){var e=this.options.namespace;this.options.dropZone.bind("dragover."+e,{fileupload:this},this._onDragOver).bind("drop."+e,{fileupload:this},this._onDrop).bind("paste."+e,{fileupload:this},this._onPaste),this.options.fileInput.bind("change."+e,{fileupload:this},this._onChange)},_destroyEventHandlers:function(){var e=this.options.namespace;this.options.dropZone.unbind("dragover."+e,this._onDragOver).unbind("drop."+e,this._onDrop).unbind("paste."+e,this._onPaste),this.options.fileInput.unbind("change."+e,this._onChange)},_beforeSetOption:function(e,t){this._destroyEventHandlers()},_afterSetOption:function(t,i){var n=this.options;n.fileInput||(n.fileInput=e()),n.dropZone||(n.dropZone=e()),this._initEventHandlers()},_setOption:function(t,i){var n=-1!==e.inArray(t,this._refreshOptionsList);n&&this._beforeSetOption(t,i),e.Widget.prototype._setOption.call(this,t,i),n&&this._afterSetOption(t,i)},_create:function(){var t=this.options;t.namespace=t.namespace||this.widgetName,void 0===t.fileInput?t.fileInput=this.element.is("input:file")?this.element:this.element.find("input:file"):t.fileInput||(t.fileInput=e()),t.dropZone||(t.dropZone=e()),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=this._loaded=this._total=0,this._initEventHandlers()},destroy:function(){this._destroyEventHandlers(),e.Widget.prototype.destroy.call(this)},enable:function(){e.Widget.prototype.enable.call(this),this._initEventHandlers()},disable:function(){this._destroyEventHandlers(),e.Widget.prototype.disable.call(this)},add:function(t){t&&!this.options.disabled&&(t.files=e.each(e.makeArray(t.files),this._normalizeFile),this._onAdd(null,t))},send:function(t){return t&&!this.options.disabled&&(t.files=e.each(e.makeArray(t.files),this._normalizeFile),t.files.length)?this._onSend(null,t):this._getXHRPromise(!1,t&&t.context)}})});