!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./load-image.js","./canvas-to-blob.js","./jquery.fileupload.min.js"],e):e(window.jQuery,window.loadImage,window.canvasToBlob)}(function(e,i,s){"use strict";e.widget("blueimpIP.fileupload",e.blueimp.fileupload,{options:{resizeSourceFileTypes:/^image\/(gif|jpeg|png)$/,resizeSourceMaxFileSize:2e7,resizeMaxWidth:void 0,resizeMaxHeight:void 0,resizeMinWidth:void 0,resizeMinHeight:void 0,add:function(i,s){e(this).fileupload("resize",s).done(function(){s.submit()})}},_resizeImage:function(t,n){var r,o=this.options,a=t[n],u=e.Deferred();return i(a,function(e){var p=e.width,c=e.height;r=i.scale(e,{maxWidth:o.resizeMaxWidth,maxHeight:o.resizeMaxHeight,minWidth:o.resizeMinWidth,minHeight:o.resizeMinHeight,canvas:!0}),p!==r.width||c!==r.height?s(r,function(e){e.name||(a.type===e.type?e.name=a.name:a.name&&(e.name=a.name.replace(/\..+$/,"."+e.type.substr(6)))),t[n]=e,u.resolve()},a):u.resolve()}),u.promise()},resize:function(i){var s=this,t=e.extend({},this.options,i),n="number"!==e.type(t.resizeSourceMaxFileSize);return e.each(i.files,function(r,o){s._resizeSupport&&(t.resizeMaxWidth||t.resizeMaxHeight||t.resizeMinWidth||t.resizeMinHeight)&&(n||o.size<t.resizeSourceMaxFileSize)&&t.resizeSourceFileTypes.test(o.type)&&(s._processing+=1,1===s._processing&&s.element.addClass("fileupload-processing"),s._processingQueue=s._processingQueue.pipe(function(){var t=e.Deferred();return s._resizeImage(i.files,r).done(function(){s._processing-=1,0===s._processing&&s.element.removeClass("fileupload-processing"),t.resolve()}),t.promise()}))}),this._processingQueue},_create:function(){e.blueimp.fileupload.prototype._create.call(this),this._processing=0,this._processingQueue=e.Deferred().resolveWith(this).promise(),this._resizeSupport=s(document.createElement("canvas"),e.noop)}})});
